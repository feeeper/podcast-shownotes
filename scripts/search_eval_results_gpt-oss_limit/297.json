[
  {
    "segment_id": "004b3f22-4a8e-4960-8b0c-eb46bec41706",
    "episode_id": "08512337-cfc8-4b26-b17c-6909b1d1d472",
    "episode_number": 297,
    "segment_number": 5,
    "text": "Прости, пожалуйста, я тебя немножечко прерву. У тебя что-то со звуком, то ли бьется в угол гарнитуры, то ли что-то такое, как будто что-то обо что-то ударяется, но я не очень понимаю. Секундочку. А я пока трену. Я нашел предыдущую проблему с BGP, которую мы обсуждали, это было в выпуске 248, и в тот раз накосячил Verizon, который тоже также сказал, ребят, мы сейчас немножечко оптимизируем, как внутри у нас все работает кластеры, и они заставили всех ходить на все сайты через свои роутеры. Примерно та же беда. Ссылочка на этот выпуск будет в шоунотах, а вы уж там сами найдите новости. Ссылку добавил, и пока Алекс молчит, хочу сказать, что по-настоящему, по-правильному, эту проблему решить чрезвычайно сложно. У нас было уже несколько подходов, постморцамов, на подобную проблему, и мы пришли к выводу, что единственный способ, и это я тоже говорил в подкасте, единственный способ решать подобную проблему, а именно проблему конфигурации, проверки конфигурации только с помощью того, что надо рассматривать конфигурацию как код. И возможно даже готовить конфигурационные файлы на всю компанию в виде артефактов, и иметь быструю возможность откатываться с артефакта на артефакт, с версии на версию, просто, не знаю, как rollback делать, я не знаю. То есть, если у вас рассматривается конфиг по-другому, у вас чаще всего бывает либо большой blast radius, либо тяжелая работа с откаткой, либо еще что-нибудь такое. Соответственно, если у вас есть возможность протестировать данный отгренный... Саша, ну не шути там, я не могу вот на это говорить. Я шучу, потому что я услышал фразу рассматривать конфигурацию как код. Да, а у тебя два кота, и поэтому это хорошая идея, рассматривать конфигурацию как два кота. И поэтому надо именно так действовать, тестировать и... И мяукать. Да, я хочу поддержать Ваню здесь. Один для наиболее критических систем, которые у нас на работе есть, мы на самом деле стали упаковывать конфигурацию в точно такие же пакеты как бинарники и раскатывать их по тому же самому процессу, как мы раскатываем бинарники, там один кластер за раз и все такое. И теоретически это уменьшило количество атомий, которые у нас стали случаться из-за поломанных конфигов. А слушай, Алекс, а у вас конфиги это какая-то отдельная команда ими занимается или как это работает? Потому что конфиги, понимаешь, есть такие, которые глобальные, есть такие, которые не всего команд в одной группе используют, есть те, которые исключительно для какой-то внутренней команды. А как это работает? То есть ты сказал, что вот у вас команда с РИ раскатывает, правильно ли я понимаю, что это именно глобальные конфиги? Ну ладно, я попробую объяснить. Во-первых, у нас есть много команд с РИ, каждая команда смотрит за своим продуктом. Вот, в частности, наша команда смотрит за нашим продуктом с большим количеством датапайплайнов. И теоретически люди, которые делают изменения в конфигах, это в основном разработчики, но с РИ в свое время построили процесс раскатки и пуша этих конфигов. И процесс, к которому мы в конце концов приспелим, практически один в один повторяет процесс, который мы используем для раскатки бинарников. Грубо говоря, кто-то изменяет конфиг, коммитит это в репозиторий, после этого автоматизация собирает из этого релиз и начинает раскатывать один кластер за раз. Спасибо. Но у этого есть на самом деле одна большая проблема, что это занимает много времени, и люди от этого дико берется. И периодически плюют на все и пушат, и иногда это выстреливает в ногу. Я так понимаю, что никто не знает, как это сделать правильно у всех свои подходы, как минимизировать количество проблем. При этом, каждая компания ищет способы постоянно. В принципе, да. На самом деле это упражнение в менеджменте рисков. Ты смотришь на каждый конкретный продукт и понимаешь, что тебе важно иметь возможность быстро делать изменения, итерировать и пушить в продакшен, или тебе нужно обеспечить гарантированный аптайм, надежность и отсутствие багов. И где-то на этой шкале ты находишь удобное для себя место. Причем со временем оно, скорее всего, будет плавать в одну или другую сторону. Кстати, интересным результатом у нас Cloudflare тоже вызвал кучу проблем. Один из результатов Outage, который весь мир видел, для нашей внутренней команды, было то, что мы зря написали настолько хороший сервис, который в течение не последних несколько лет ни разу не ломался. И когда пришла проблема и внезапно все сломалось, все забыли, как вносить изменения, рестартить, где смотреть, как оно работает. Не пишите хорошие сервисы, это тоже иногда бывает плохо. Есть еще другое средство, еще можно периодически производить учения и что-то специально ломать. Да, у меня это записано, мы это делаем регулярно, но вот для этого сервиса, к сожалению, не проводилось. Но так-то да, это очень хороший результат, мы используем эту практику. А ранбуки у вас есть всякие? Конечно. И там не помогли для тех сервисов, которые сломались? Да, они помогли, потому что у нас за последние два года произошло несколько разных миграций внутреннего толка, с одних систем на другие и так далее.",
    "result": {
      "query": "конфигурация как код BGP проблемы"
    }
  }
]