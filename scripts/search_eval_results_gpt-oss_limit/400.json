[
  {
    "segment_id": "e0cd4603-c9bc-42b6-9990-753d4c7f3a44",
    "episode_id": "aa70cab5-fd4c-493b-8f85-ab8f26d7d090",
    "episode_number": 400,
    "segment_number": 6,
    "text": "А если мне нужно страничку сохранить, то приходится drag-and-drop странички в соседнее окно. И последнее. Ко мне обратился коллега с просьбой помочь ему написать запрос в Postgres, там был большой кусок JSON-B, ну точнее таблицы, где хранится JSON-B, по которой нужно было небольшой отчётик построить. Идея в том, что у тебя есть документ, там несколько уровней вложности в нём, а в нём, вот в этом уровне вложности, ключ значения. То есть строковый ключ и значение циферкой. И вот эту штуку, её нужно как-то преобразовать во что-то похожее на колонки, чтобы потом уже сделать там normal var, грубая, всё как обычно. Я, если что, совсем не эксперт в SQL, потому что не так часто вот прям пишу запросы. И вот эта штука, она вызвала некоторые затруднения. В поисковой системе была найдена функция, она называется JSON-B.Each. Она вот как раз понимает JSON-документы и возвращает пары ключ значения. При этом у неё возвращаемый тип set of record. С рекордом в Postgres работает достаточно просто. Это как структура, ты берёшь имя, точка, значение, получаешь значение структуры. Логично. Теперь то же самое, только у тебя set of record, и тебе нужно вот как бы у этого set of сделать ему получается map, чтобы получить, например, key. Или сделать map, чтобы получить value. И было очень неочевидно, как это делается. Оказалось, нужно, чтобы с множеством рекордов делать операции, которые ты делаешь над рекордом, нужно взять в скобочки твой set of. Вот просто если ты напишешь точка key, нифига не работает. Если ты берёшь в скобочки и точка key, сразу всё просто, ну, образом работает. Очень неочевидная штука. То есть, в скобочке и точке key можно в from клойдзе написать? Давай я прям в чатик... Ты же скидывал свой letter. join полного вида запроса. На самом деле нужно в чатик сбросить, наверное, старый запрос и новый. С твоего позволения, могу я твой старый запостить, который с letter.join? Старый лучше не надо, потому что так неправильно. То есть, изначально, да, я действительно исхитрился и сделал через letter.join. Вот. Я скинул в чатик кусок запроса. Я думаю, что у меня в psql возможно... Нет, это ты скидывал. Я вот хотел спросить, куда это писать? Это from или select? Или где это написано? Давай я целиком запрос начну. Вот это целиком запрос. И я могу даже скинуть, что у нас в таблице. Вот это таблица тестовая. Мне просто очень странно видеть jsonb.each в select стороне. В select? Почему? А где ты его ещё хочешь использовать? Прости. Сейчас. Ич, он получается перебирает все ql пары, да? У него на вход документ, который предположительно не сильно вложенный, и он возвращает пары ключ значения. Где ключ — это текст, а значение — jsonb. В общем, если кому-то интересно, я скинул, ну потому что я понимаю, голосом это не очень понятно, я в чат скинул схему, я скинул пример данных, я скинул запрос. Если вам это интересно... Если честно, только у тебя сделано через letterl, это более интуитивно для меня.",
    "result": {
      "query": "PostgreSQL JSONB each key value conversion"
    }
  }
]