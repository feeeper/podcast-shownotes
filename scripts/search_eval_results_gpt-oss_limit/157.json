[
  {
    "segment_id": "e26ac642-174b-4019-b52e-32d0ee565a66",
    "episode_id": "31d53b6d-9ec9-492a-9c88-3419919d6884",
    "episode_number": 157,
    "segment_number": 4,
    "text": "И в какой-то момент мы так сделали вывод, что переборы делать вообще не нужно, и нужно просто оценить, сделать перебор глубиной ровно в один шаг. То есть оценить все свои ходы, посмотреть на все свои ходы, оценить каждый, и выбрать какой-то самый лучший из них. И в целом тут два таких направления, либо ты перебираешь, либо ты просто оцениваешь все ходы и выбираешь самый лучший. Сразу вспоминается нейроночка, которая победила на ГО, которая состояла из двух частей, одна часть оценивала первые ходы, а вторая часть из этих прошедших первый отбор уже более глубоко смотрела и выбирала. Да, да, да. Монте-Карло Триссер, по-моему, да, был? Да, перебор там Монте-Карло Триссер, а до этого нейроночка, да, там как-то странно. Да, прикольно. Ну на самом деле, да, в этом контексте еще была такая особенность для того, что участие предполагается в трех раундах последовательных. То есть первый раунд на очень маленьких картах, и глядя на них, кажется, что переборные алгоритмы-то вообще там должны решать. Я даже хотел броситься писать туда минимакс, но меня ребята отговорили, потому что правила такие. Первый раунд очень маленькие карты, но во второй раунд проходят по медиане команды. То есть все они играют на них, турниры как-то распределяются в этой турнирной таблице, и нижняя половина отбрасывается. И ребята убедили меня, что не нужно писать никакой переборный алгоритм, потому что мы и с простым каким-то алгоритмом по-любому эту медиану преодолеем. В принципе, они оказались правы. Подожди, подожди, а такая уверенность? Я не совсем понял насчет минимакса, он предполагает наличие оппонента в игре? А, я вполне описал задачу. Да, конечно. История такая, вот эта карта, и ходят по очереди игроки. Игроки ходят по очереди. На маленьких картах играют 2 игрока, на средних картах до 8 игроков играют, а на гигантских картах играют до 16. И до 16 игроков может играть. Все просто ходят по очереди. Если кто-то занял какую-то дорогу, то другой уже не может, только с использованием опциона. То есть, да, есть много-много команд, допустим, 200 было, сколько раз была команда? Около того. Они все играют в турнире, как-то они сеются. В этом турнире играют против друга сначала на маленьких картах, зарабатывают какие-то очки за победу, за второе место. Понятно, за третье, четвертое. И распределяются в таблице, и все. Нижняя часть таблицы программируется, и верхняя часть таблицы, верхняя половина, уходит во второй раунд и играет на средних картах, на которых уже никакие переборные алгоритмы, по крайней мере, из тех, которые я не программировал, работать бы не стали. Так, и что вы использовали на втором раунде? На втором раунде, на самом деле, мы использовали фактически один алгоритм, мы его просто написали, и он у нас играл, я сейчас про лайтнинг говорю, то есть, лайтнинг за 24 часа. Нужна была какая-то достаточно простая идея, которую достаточно легко запрограммировать, и чтобы она работала. А еще, этот был контест, наверное, первый, в котором мы в лайтнинге хоть что-то показали. Да, да. В общем, вот. И идея была такая. Мы обратили внимание на следующую особенность. Если какая-то точка одновременно соединена с двумя шахтами, то ты получаешь за нее больше существенных очков. То есть, она соединена с одной шахтой, ты получаешь квадрат расстояния от этой точки до шахты, а если она еще с одной шахтой, ты получаешь квадрат расстояния и до этой точки, и до этой шахты тоже. Поэтому нам показалось, что выглядит достаточно простым искать самые близко расположенные шахты и просто их между собой соединять. Ты получаешь сразу много очков. Каждая точка на этом пути получает много очков, потому что она соединена сразу с двумя шахтами. Ну и так далее, можно вот этот компонент связанности продолжать расширять. Две шахты мы соединили каким-то самым коротким путем. Ищем к этому компоненту самую близкую шахту и ее пытаемся. В ее сторону двигаем, строим дороги в ее сторону, чтобы с ней соединиться. Ну и вот это наш был первый алгоритм, который работал в Лайтнинге в точности так. То есть, он искал максимально близкие шахты, строил из них компонент связанности, потом пытался его расширять. Как только он терял возможность расширять, например, соперник перекрыл всевозможные ходы, он начинал строить новый компонент связанности. Ну и как только уже нельзя было построить ни одного нового компонента связанности, тогда он играл просто жадно. То есть, он выбирал ход и считал, сколько конкретно очков добавляет прямо сейчас этот ход, без какого-нибудь перебора вглубь. Прямо сейчас этот ход выгодный. Метрика только количество очков, сколько он добавляет. Никаких других фич на картах мы не считали, только это. Такой вот был алгоритм. Он хорошо прошел, естественно, первый раунд Родких, и он там был у нас первым, да? Вторым. Ну, там, первое и второе место в лайтинге. В зависимости от отыгрыша, который организаторы почему-то дважды играли по какой-то причине. Они написали, что у них была ошибка в распределении первых ходов, и поэтому там получалось не вполне честно. Поэтому они эту ошибку исправили, все переиграли, и мы вышли в первый, в первом раунде лайтинга, вышли на первое место. Обогнали даже знаменитых японцев команду Унаги, что вообще для нас нетипично. Игорь тут в чатике подсказывает, что вас за это сразу забанили. Нет, нет, нет. Забанили нас за другое, и мы еще про это расскажем, если речь дойдет. Если вы нас не обогните. Вы заняли первое место в лайтинге? Не в лайтинге, а в первом раунде лайтинга, то есть на маленьких картах. На средних картах Тим Унаги нас обогнал, и они там на первом месте, на средних картах в лайтинге, а мы там на втором месте находимся. Ну и, соответственно, финальный раунд в лайтинге, игра на больших картах, он еще не состоялся. Видимо, организаторы его уже провели, просто держат в секрете, там такая особенность этого соревнования, что результаты объявляют на конференции по функциональному программированию. Собственно, ACFP – это как раз есть международная конференция по функциональному программированию, а ACFPC – это, соответственно, соревнование, приуроченное к этой конференции. И вот результаты будут на этой конференции когда-то в сентябре, то есть на днях. На следующей неделе. Вроде бы. Мы обещали 6 числа, что будет финал лайтинга проведен, и вот мы наконец узнаем, насколько хорошо мы выступили. После этого все, лайтинг закончился, можно расслабиться и начать уже писать что-то более сложное. За это время ребята написали тоже очень простые алгоритмы. Они там назывались «лох киллер один», а другой, не знаю, можно ли это слово в эфире произносить. Идея была такая – надо максимально-максимально пакостить. Пытаться занять все шахты, занять все дороги, ведущие к каждой шахте. И если ты так сделаешь, соперник не сможет до этой шахты добраться и не заработает очков. Ну, кинетически мы отбросили все эти идеи в конце концов, просто потому что они позволяют кому-то подгадить основательно, но сами они очевидно зарабатывают очень мало очков, потому что дорога рядом с шахтой приносит одно очко, дорога, для category 2 очка уже 4 очка приносит. Этот рейтинг – очень много ходов, чтобы это делать. У нас было много алгоритмов разных. В конце концов, мы их просто сделали в штуку, которая их всех соединяет между собой и пытается выбирать правильную последовательность. Первая стратегия пытается принять решение, не справилась. Вторая стратегия пытается принять решение, не справился. Третья и так далее. И вот мы выбирали такую правильную проследовательность, правильную цепочку стратегий. И в нашей цепочке победителей ни одна из этих пакостных стратегий не поучаствовала. Ну просто потому, что очевидно, что наши стратегии умели хорошо этому противостоять. Это вообще был интересный такой этап соревнования, когда уже было несколько стратегий напрограммированы. Мы поняли, что их нужно объединять, и нам пришлось все отрефакторить так, чтобы вообще можно было объединять. И это вообще так всегда замечательно и волнующе, когда в середине контеста ты делаешь глобальный рефакторинг в команде из 15 человек, которые одновременно тоже что-то делают. И у меня по опыту участия в CFPC примерно каждый раз нужно сделать такой рефакторинг где-то в середине, когда ты что-то понял про задачу уже. Это довольно забавно было. А можно вот такой вопрос? Во-первых, здесь вопрос из чата, и вы в чате уже ответили, что соревнование это получает на то, кто придумает лучшую эвристику. И у меня более такой общий вопрос. Что бы вы сказали здесь было ключевым в этом соревновании? Мы бы победили, если бы у нас, и вот дальше закончите это предложение. Если бы мы лучше тестировали, мы бы победили, наверное. Вообще, мне кажется, это не совсем верно про лучшую эвристику. Тут, мне кажется, ключевая вещь это умение оценивать, насколько твоя эвристика, которую ты придумал, хорошо играет. И у нас мы, короче, проделали довольно большую работу в этом направлении, и все еще недостаточно. У нас была такая штуковина, в которую можно было загрузить все наши искусственные интеллекты, сколько есть, и сказать, играй все со всеми, и покажи мне, кто лучше. И в последний день, чтобы было понимание, масштаба проблемна, в последний день количество стратегий, с учетом всех этих комбинаций наших подстратегий, количество искусственных интеллектов, которые нужно было протестировать, было где-то за две сотни. 280, что ли, у нас было. Там было полтора десятка стратегий, плюс они все комбинируются друг с другом, и получалось 280 комбинаций, которые имеют смысл. Их нужно было выбрать из 280 одну. И как? То есть придумать эвристику это легко, а вот как понять, что именно эту эвристику нужно отправить организаторам, а не какую-то другую, это как бы челлендж. И в частности у нас была такая прикольная штуковина, она играла всех со всеми, и показывала кто сколько очков набирает, плюс доверительные интервалы у этих очков. И мы понимали, а вот в чатике сейчас есть скриншотик этой нашей штуковины, и мы понимали, достаточно ли игр мы наиграли, чтобы быть уверенными, что первое место действительно лучше. А в последние несколько часов ребята сделали так, чтобы вот этот вот брутал тестер, мы его так называли, чтобы эта штуковина, которая все тестирует, чтобы ее можно было запустить на нашем супер-кластере, потому что на одной машине это слишком долго было бы. И вот в последние несколько часов кластер работал, чтобы выбрать из 280 стратегий лучшую. Слышали, что у вас есть стратегии лучшую? Слушай, ну то есть чтобы участвовать в контексте, нужен большой-большой кластер, я правильно понимаю? Или, там, не знаю, или какая-то очень крутая интуиция в голове, большая голова. Большая-большая голова, да. Отлично. У нас больших голов нет, поэтому у нас есть кластер. А у меня и кластера нет, мне нечего участвовать, да? Кластер берется на любом Амазоне. То есть надо там взять... Я точно знаю, что некоторые команды по опыту прошлых контестов к этому контесту просто взяли несколько машин на Амазоне, чтобы было на чем считать считалки сложные. Слушай, ну это вообще жестко. Ну то есть, извини, Саш, для того, чтобы участвовать в соревновании, нужно первое подготовить себе полностью CI, команду, договориться, какой канал для общения, то есть какой-нибудь слэг, договориться про Skype или Google Hangout, договориться про Git, про репозитории, про тот, кто как взаимодействует, кто когда спит, не спит. Блин, это реально, я не знаю, два года подготовки нужно, чтобы один контест провести. А все нормально. Если играешь первый раз, то ты всего этого не знаешь и просто приходишь с чистой головой на контест и участвуешь как получается. А потом, после контеста, на ретроспективе приходят умные мысли, типа, ой, надо было CI заранее настроить, ой, надо кластер. И вот так, к третьему году участия у тебя уже все готово к началу. Вот как-то так. Я хочу услышать кулсторию про то, как вас забанили. А, тут было все довольно... Во всех таких соревнованиях, на самом деле, чтобы вместо кластера, вместо кластера если соревнование организовано хорошо, то ты можешь отправлять своего бота куда-нибудь, в какую-нибудь онлайн штуковину, где тусуются все остальные игроки, и смотреть, насколько она там классно всех побеждает. И это будет вместо брутал тестера. И в этот раз вроде бы было так же. У организаторов был какой-то онлайн сервер, куда можно было прийти и начать играть. И мы быстро... Одни из первых команд была, которая написала штуку, которая ходит и играет, и выяснилось, что там есть... Можно подконнектиться к любой из карт, и там есть сотни карт, и совсем немного ботов, которые готовы играть. Поэтому мы, естественно, написали штуку, которая коннектится ко всем картам и ждет, где накопится достаточное количество игроков, чтобы начать играть. Но дальше нас ждала такая, не знаю, баг, не баг, особенность этого сервера, что если ты... Если кто-то подсоединился к карте и начал ждать игроков, а потом решил, что все, ему надоело ждать и отсоединился, то вместо него остался зомби, который будет все время пасовать. Тоже будет играть, но все время пасовать. Это, в общем, странное решение организаторов было так сделать. Но в итоге получалось так, что ты соединяешься к карте, долго ждешь, и после этого играешь с одними зомби, которые только пасуют. Естественно, их выигрываешь, и тебе это не дает никакой информации о том, хорошо ты играешь или нет. Поэтому мы написали какую-то логику, чтобы везде умно коннектиться, везде ждать, в общем, чтобы попытаться по максимуму играть с живыми игроками, везде в каждое место залезть, везде всех подождать. Естественно, тоже это сделали на кластере, и ждали, и накапливали статистику. До тех пор, пока не увидели, что наш бот почему-то перестал играть вообще с кем-либо. После этого мы начали узнавать, оказалось, что наш кластер круче кластера организаторов, и мы просто создаем слишком большую нагрузку на инфраструктуру организаторов. И организаторы честно попытались с нами связаться, но мы в это время фигачили код, они почту читали, поэтому пропустили все их попытки, после чего организаторы просто нас забанили. Ну, понятно, что они нас разбанили, как только мы все поняли, с ними связались, сказали, да, да, хорошо, мы ограничим количество, не вопрос, и с этого момента нас разбанили. Вы использовали тоже инфраструктуру, что и организаторы? Нет, почему? Вы начали конфликтовать, как это вышло? Не конфликтовать, мы начали просто слишком забивать, не знаю, видимо, слишком... Задосили в их серверах. Да, да, что-то в этом духе. Вы были очень интенсивны по вычислениям, и вы их кластер задосили. Да нет, даже не алгоритмы. Я думаю, что они заняли все свободные места и теперь могли играть все только с ними. Не совсем даже так. Там хитрее было. Мы ведь создали им не решение, а по сути ты со своей машины подцепляешься, и тебе по сети передают состояние игры, а ты в ответ даешь ход. Там ведь так, вычислениями занимались наши, наш кластер. Идея была такая, что мы подключались, ждали, отключались, и мы забивали все-все-все-все-все игры своими зомби. То есть мы подключались, не находили себе соперника, отключались, потом снова подключались, возможно даже в ту же игру, где наш зомби и сидит, и вот таким вот образом все и происходило. То есть мы забивали все-все игры своими собственными зомби. То есть это с одной стороны не очень аккуратное наше поведение было, но с другой стороны, в общем, это не очень доработанная именно инфраструктура от организаторов, поскольку одна команда может испортить геймплей всем, это не очень удачная, очевидно, не очень удачная архитектура. Да, действительно, а они об этом писали в документации, либо сообщали об этом предварительно? Еще раз что-что? А сообщали они предварительно о том, что вот такое поведение не следует использовать? Нет, нет, нет, не сообщали. Это скорее было как раз то, о чем я говорил, шероховатость организаторов связана с тем, что они в первый раз такое организуют и еще не очень хорошо сами, наверное, понимали, как могут неверно использовать их возможности, чтобы испортить геймплей. Вот, еще интересно, еще интересный такой факт, забавный просто, я расскажу, как в итоге остальные участники выкручивались, чтобы все-таки с кем-то поиграть, кроме нас. Был такой общий IRC канал, посвященный контесту, где можно было всем чатиться. И, значит, другие участники договаривались в чатике такие, о, давайте все придем на такой порт и поиграем там. Готовы? Готовы. Я подконнектился. И все как раз подконнектятся, моментально коннектятся к одному порту и играют. То есть была инфраструктура, чтобы автоматически коннектиться и играть, но она работала только через IRC-чатик. Так получилось. Забавно. Я предлагаю на этой ноте, если у вас только нет там чего-нибудь последнее сказать, просто мы вас уже почти час мучаем. Вопрос такой, у вас есть где-нибудь отчет? У нас есть как такового прям отчетика мы не писали, но мы написали очень подробный readme файл к своему git-репозиторию. Git-репозиторий там... За отчетик заходит, да? Да, он вполне заходит за отчетик. Именно там впечатлений каких-то там нет, но что мы делали, как у нас все сделано и кто что делал, там есть. Отлично. На самом деле, Игорь по ходу все впечатления писал в канал телеграммный. Ну там контур тех наш канал, вот он в него писал о том, что мы чувствовали в процессе игры. Мы, наверное, перейдем к остальным темам нашего выпуска, надеюсь, что вы на них останетесь, поддержите. Да, нет? Да, останемся. Наверное, попробуем поддержать. Отлично. И я предлагаю Ване выбери какую-нибудь тему, которую тебе не лень обсудить. Отлично. Тогда я предлагаю на... Слушайте, вот у нас очень много тем, которые тянутся очень давно. Вот одна из них мы с тобой как раз и обсудим. О, это отличная тема. Только я ее плохо помню, поэтому я надеюсь, что ты ее... Ты начнешь, а я поддержу. Я подскажу. Подожди, сейчас сначала заметочки свои найдут, а ты пока расскажи.",
    "result": {
      "query": "оптимизация эвристик для турнира ACFPC"
    }
  }
]