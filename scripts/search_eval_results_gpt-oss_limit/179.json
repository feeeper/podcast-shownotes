[
  {
    "segment_id": "afbb2420-5b25-4b5e-ab9b-517163081fc6",
    "episode_id": "b235609c-f74f-40a7-b38a-467ac66ee3ad",
    "episode_number": 179,
    "segment_number": 9,
    "text": "Если у них у кого больше нет ничего добавить. Среди тем слушателей есть довольно много всякого интересного. И, наверное, самое интересное и тема, которая набрала больше всего глазов, это про то, что инженеры из Фейсбука переходили с Python 2.7 на 3.6, и нагрузка на CPU уменьшилась в 4 раза. Вообще, довольно удивительно, что они так поздно переходили с Python 2 на Python 3. Хотя, с другой стороны, чем больше кода, тем сложнее перейти. Я проводил подобные попытки на маленьких кусочках кода. У меня не получалось 4 раза, но значительное увеличение в 2-2,5 раза у меня получалось практически везде. Я не ожидал, что так будет сильно, что так будет мощно. А еще я однажды... Какая-то была машинка, что ли, гоняли. Помните, надо было написать бота, который бы гонял машину. Какой-то наш он был Russian iCub, что ли, что-то такого. Я там тоже свой код запускал, который у меня не полностью работал, но что работал, запускал на Python 2.7 и Python 3.6. И там чуть не в 10 раз у меня получилось ускорение. Бывают случаи, когда это значительно сильно влияет. Так что да, оно поможет переходить, конечно, на третий Python. Если вы стартуете что-то новое, второй даже рассматривать не стоит. По крайней мере, я так делаю сейчас. Все работает. Интересно, есть еще люди, которые серьезно рассматривают второй? Да. Серьезно? Ну, то есть, ты таких знаешь, потому что я не встречал. Много библиотек все еще не портировано полностью на третий или портировано, но в состоянии находится не в Production Ready. И у нас поэтому есть куски кода, которые... Ну, не то чтобы пишутся с нуля, но, скажем, мы будем использовать эту и эту библиотеку, поэтому мы будем пока еще на втором. Я сейчас детально не скажу, какие именно библиотеки и что там, чего не хватает. В том числе, скажем, наши собственные библиотеки, которые работают на втором. То есть работа по переходу на третий, для того, чтобы новые проекты перевести, значит, надо все библиотеки, которые у нас есть, делать поддержку третьего Python. Было бы клево, если бы в третьем Python была бы какой-нибудь такой режим обратной совместимости. Ну, типа, пишешь одну строчку, это второй Python, и все. Не уверен, что это возможно. Я думаю, это возможно, но с точки зрения разработчиков компилятора непрактично. Ну, скажем, в Python втором была такая классная штука, типа, print, потом делай, что хочешь, без скобок. А в Python третьем более правильная проверка более правильного синтексиса. Если ты в Python третьем скажешь, работай как во втором, то получается, ты синтексис перестанешь проверять. Ну, ты говоришь о том, что пользователи по старой привычке будут все писать только так. Да, да. Так, из тем слушателей, которые набрали довольно много голосов, это статья инженеров из Twilio, которые нашли интересные проблемы в HTTP 2.0. Давай я расскажу. Вперед. Дело в чем. Twilio — это люди, которые работают с коммуникацией практически во всем мире. Всякие смски, телефонные звонки, раутинг и вот это все. У них внутренняя инструктура, я так понял, по статье, все время была на HTTP 1. И тут они начали переходить на HTTP 2.0 и заметили проблему во время какого-то тестирования, что иногда лейтенси взлетает до небес. Причем, казалось бы, это вообще нереально, потому что HTTP 2.0 гораздо лучше архитектура, она там умеет то, то, то и то, и теоретически он должен выигрывать HTTP 1.0 вообще в любом тестировании. Но оказалось, что это не так, и они начали исследовать в чем дело, начали полное тестирование. И есть отличные графики, которые показывают, что к чему. На этих графиках указано лейтенси при разных нагрузках, что они как запускали. И они не могли обнаружить проблему до тех пор, пока не ввели искусственно потери пакетов. То есть HTTP 2.0 работает отлично и выигрывает HTTP 1.0, и все хорошо, пока не появляется в сети. В данном случае у них была искусственная компонента, но на продакшене у них там была она естественная. Потери всего 3%. То есть 3% и при этом лейтенси увеличивается в тысячу раз, грубо говоря. Казалось бы, невероятно, но они начали расследование, и оказалось следующее, что HTTP 2.0, у него много стримов поддерживается внутри одного соединения, и когда возникает какая-то внезапная потеря пакетов, то страдает целиком соединение и все стримы. При этом получается так, что... Так, сейчас я открою. Здесь у них много графиков, интересных, поясняющих, где, как они, в какую сторону копали. То есть у них расследование показывает постепенно. То есть мы сначала попробовали это, все то же самое, потом это, все то же самое, а потом добавили вот это и стало хуже. То есть получается, что когда происходит потеря пакета, все стримы внутри TCP соединения, у них получается два дополнительных пенальти. Первое. Во-первых, все стримы на время останавливаются, пока происходит ретрансмит того самого потерянного пакета. И во-вторых, уменьшается размер окна, и все стримы получают большую задержку. При этом из-за того, что во время работы на TCP у них было много коннектов, то вот эти пенальти получали только те коннекты, у которых были потери пакета. Все остальные каналы продолжали работать, как работали. Из-за этого получается, что большой плюс HTTP 2 является одновременно большим минусом. То есть в случае потери пакета страдает целиком соединение, соответственно все стримы, которые работают на этом соединении. В конце они говорят, конечно же, из-за того, что мы вводили искусственно эту потерю во время тестов, чаще всего мы ее не будем видеть на реальном железе, и мы нашли граничные условия, что именно эти 3% добавляют, и поэтому мы теперь следим, что если даже небольшое количество пакетов начинает теряться, у нас сразу взрываются алерты наши, которые сигнализируют, что происходит какая-то проблема. Изначально мы не проверяли, что эти 1-2% пакетов теряются. Сейчас мы начинаем проверять, и поэтому это нам поможет в дальнейшем работать с HTTP 2. И в-третьих, они все равно будут переходить на Envoy. Они это все делали в рамках перехода на Envoy, потому что Envoy позволяет... Это серый смеш. Он позволяет работать как с HTTP 1, так и с HTTP 2, и нам без разницы, нам все равно на него переходить, просто мы сейчас будем внимательнее. Но в целом статья интересная. Посмотрите, потому что там проводилось вот это расследование, они показывают графики, очень показали хорошо, что цифры, которые вы получаете в результате тестирования, 20%, 30% latency, миллисекунд 95%, персентиль равняется тому-то, он вообще ни о чем. А когда они начали рисовать это в виде графика, где видно сразу эти всплески, в зависимости от времени, получается информация становится наглядной, и гораздо быстрее приходишь к правильному ответу. У меня тоже на моей практике получается так, что пока ты видишь все в виде логов или в виде цифр, голых цифр, ты не так хорошо воспринимаешь информацию. Стоит их только вывести, эти же самые цифры в виде графиков, каких-то любых, прям мгновенно ты приходишь, ну как-то намного быстрее приходишь к правильному ответу, или по крайней мере направлению, где искать этот правильный ответ. Пошли дальше. Ну ладно, а следующая тема? Меня вообще слышно, нет? Да, все хорошо. Отлично. Да, ты меня выбрасывала. А следующая тема? Говори. Отлично. Это кодов контакт на гитхабе. И вопрос довольно интересный. То есть ссылка ведет на репозиторию Ansible на гитхабе, а точнее на ish.io, в котором человек зашел и по-русски создал, ну в смысле не то, что по русской привычке, а на русском языке создал ish.io, в котором матом спросил мол, да коли, и привел ссылку на код, в который для того, чтобы, я не понимаю, что там сделать, они получали, в общем, работали с адресом DNS в Google. То есть маршруты DNS в Google вы вытаскивали. При этом как бы суть становится понятна, что в принципе так сделать не стоит, ай-яй-яй, и давайте это исправим. Но из-за того, что по факту ничего, кроме строчки, указаний на строчку кода и темы ish.io, в которой только два слова, одно из которых матом, в итоге получается, что на GitHub это ish.io закрыли, сославшись на кодов контакт, что ребята, так делать не нужно, если вы хотите, то пожалуйста сделайте новый ish.io, в котором правильно и по-доброму все опишите. При этом там кто-то дополнительно спрашивает, а как бы ведь ish.io корректный, и в целом закрытие ish.io это неправильная концепция, потому что у нас она все еще есть, на что ему тот человек, который закрыл ish.io говорит, что да, все верно, но как бы по коду в контакт я закрываю все равно. Ну там он не совсем так, он говорит, что извините, ребят, но даже если кому-то тут понятно, это open source, люди здесь не телепат, если вы хотите, чтобы что-то фиксили, говорите, формулируйте ваши проблемы словами, а не абстрактным матом.",
    "result": {
      "query": "Python 3 улучшает производительность"
    }
  }
]