[
  {
    "segment_id": "40c1cc76-9cdf-4c1e-8260-4112a82b3311",
    "episode_id": "88ab6104-8c49-44e5-a324-af88c39a7515",
    "episode_number": 168,
    "segment_number": 3,
    "text": "Ну там, в эту самую, в ручку спрячь. Тема себя очевидно исчерпала. А вот тема, которая является абсолютно неисчерпаемой, это Прометеус 2.0. Я вообще не знаю, что в ней совершенно неисчерпаемое, но тем не менее Прометеус 2.0 вышел. Вышел 8 ноября, вот это большой релиз, первый релиз сверстки 2.0, как можно догадаться по названию. Два самое большое изменения это новый стораж, который был целиком переписан и предыдущая вторая версия заброшена и окончательно. Новая третья версия она лежит в отдельной библиотеке и потенциально может использоваться независимо от Прометеуса. Хотя сейчас это конечно довольно сложно, потому что там количество комментариев в коде и его структура оставляет желать лучшего, но она точно лучше чем была до этого. До этого стораж от Прометеуса было отдельно использовать практически невозможно. То есть меньше потребления CPU, меньше потребления места на диске и очень сильный выигрыш по дисковому I.O. Теперь она сильно эффективнее работает. Второе существенное изменение это то, что изменилась обработка серии, которые пропали. До этого была проблема, что если у вас какая-то серия исчезла, то есть экспортер положили или еще что-то изменилось, то она из последнего скрейпа пропадет через фиксированный интервал, который по умолчанию был 5 минут. Теперь она пропадает, как только она из последнего скрейпа пропала. Что очевидно и казалось бы логично, но раньше при таком техническом проблеме это было сложно сделать. Теперь это... подчинили эту проблему. Соответственно формат конфигурации поменялся, формат флагов поменялся, формат правил поменялся, поэтому это ломающее изменение. К сожалению они не выпилили все то, что было депликатено до этого, не все до конца. И лично мне самая большая боль то, что write.api до сих пор не сделали. То есть оно было экспериментально, мы в 2.0 его все-таки решили убрать и немного еще экспериментировать и потом добавить. Но remote storage есть, все так же можно использовать их, read.api есть и... не знаю, что еще. Инструменты для миграции есть. Да, то есть в самой статье здесь написано, что официально рекомендуемый способ это запустить старый и новый рядом и сделать так, чтобы новый читал старый, когда ему нужен. Я тут прошлую неделю практически все провел в перелетах и путешествиях. И там в одном из самолетов во время пересадки, долгой, в Минске кстати, я набросал тулзу для миграции данных. Я закинул ее в mail.list, там возникло такое довольно большое оживление и в итоге один из авторов Prometheus сделал альтернативную версию.",
    "result": {
      "query": "Prometheus 2.0 storage changes"
    }
  }
]