[
  {
    "segment_id": "5dc21961-18e2-4402-a275-b31e47f36e8c",
    "episode_id": "3056aedc-a54e-4580-8d6e-bfc214db0f2e",
    "episode_number": 127,
    "segment_number": 7,
    "text": "То есть мы можем либо увеличивать, ещё больше увеличивать факторы репликации, но это очень дорого. Либо перестать добрасывать машины, но это может быть не очень как-то, не очень нужно тогда вообще в распределённый образ данных, если мы не можем набрасывать машины. Либо уменьшать число партий, что тоже довольно странно, потому что мы тогда ими свободно рулить не можем. Это там довольно жёсткая такая формула получается, в том смысле, что жёсткая, ну не в том смысле, что она сложная, а в том смысле, что она даёт очень такую страшную картину, что у нас возрастание идёт практически линейное. И это прям очень страшно выглядит, то есть там, не знаю, там не алгебраично, там как это, пробабилистично. Это я чё-то... Что-то точно. Да, Барлок пишет, что статья очень математичная, и у меня в связи с этим вопрос, ты реально так селил? Да. Я честно в выкладке посмотрел, я понимаю, что он там говорит, и я с этим целиком согласен. Ну то есть, на самом деле, я, кажется, уже рассказывал, у меня такая анекдотовая история про то, что, ну как это анекдот, типа по опыту, который я слышал на словах других людей, что в больших кластерах, ну то есть я когда работал в платформах, у нас была бездисковая загрузка, и у нас была куча других проблем, но у нас конкретно такой проблемы не было. У нас была как бы, ну скажем, портеры, которые рассказывали прикольную историю про то, что у них был дисковый кластер, там, чуть больше тысячи узлов, и он дисковый, потому что загрузка производилась с диском. То есть в платформах заморочились, была система, которая умела там DHCP поднять, IPXE, вот это всё загрузить, и как бы, ну, IPXE кажется просто, типа, что там думать? На самом деле, когда вам нужно загрузить одновременно 5 тысяч узлов, это становится сложно, потому что они должны вам не положить ваш DHCP сервер. Вот, там ребята сделали проще, и у них был такой, типа, мастер образ, который они клонировали на все диски, и потом с него грузились. Одна проблема, как бы, перезагрузка кластера могла не дать подняться примерно 10% узлам, потому что у них диск, с диском проблемы. И вот такие вот истории, то есть это действительно проблема на больших масштабах, больше всего наши админы говорят, что это тоже проблема в больших кластерах, даже когда на счёт на несколько сотен машин. То есть, всё это, в общем-то, правда. И там так получается, что вероятность потерять все три реплики одной партиции, в кластере там, типа, 5 тысяч машин, она становится довольно существенной, то есть обычно всем кажется, что, типа, потерять три реплики, это, типа, вероятность падения метеорита. Ничего подобного. Она там существенно возрастает, и... А можешь ещё раз объяснить, за счёт чего? Ну смотри, у тебя... Как бы это так объяснить, чтобы не сложно. Суть в том, что у тебя... Если у тебя много партиций и много машин, то есть у тебя шанс того, что... То есть смотри, шанс того, что вылетит диск, он как бы... Не даже так. Шанс того, что вылетит три диска, он меньше того, что... Очевидно, меньше шанса, что вылетит один диск. Но когда у тебя просто очень много машин, шанс, что вылетит три диска, он всё ещё большой. То есть там, что на них будет крыниться одна и та же партиция. Да, дальше интересно. Чем больше у тебя число партиций, тем получается выше шанс, что... Там важные условия. Вся это моделирование производится при... При рандомном распределении партиций. И вот если у нас распределение партиций и реплика там, оно рандомное, то шанс того, что вылетит три узла... Ну то есть чувак просто подставил численно какие формулы. Там, как чат верно заметил, там формулы, на самом деле, они выглядят страшно. Там никакой сложной математики нет. В математической школе такие как бы... Беноминальное распределение проходит там в 10-ом, 11-ом классе. Там просто беноминальное распределение, и как бы несколько раз друг на друга наверчено, плюс немножко условная вероятность. И это всё, что там используется. И вот на основе этих выкладок там получается, что шанс того, что у нас все три реплики одной партиции окажутся вот на этих четырёх... как бы, типа трёх этих же машинах, она довольно высокая получается. И по поводу того, что чат спрашивает, что шанс потерять... шанс 0,0025, много или нет? Ну, во-первых, да, это много, потому что точно уже невероятное впадение материи. Это вполне себе такая вероятная вероятность. Тем более, что если у тебя эта вероятность, она, типа, каждый год, каждый день такая вероятность. Это раз. Во-вторых, числа в статье совершенно рандомные. Просто там страшно, как бы, страшно не на конкретные цифры смотреть, а страшно смотреть на просто то, как растёт график. Вот. К чему это всё следует? То есть, ну, очевидный вывод, на самом деле, из этого всего, что в больших кластерах ни в коем случае нельзя полагаться на рендом реплика placement. Там реплика placement должна быть, очевидно, умнее. Больше того, есть работы, я не знаю, в комментах или... по-моему, в комментах в Твиттере к этой заметке, и, может быть, даже и в комментах к статье, я уже не помню, были ссылки на довольно свежие работы о том, что... как рассовывать реплики по узлам, чтобы... как это... чтобы, в общем, эта формула просто не работала, на самом деле. То есть, минимизировать отказ. Даже не то, что минимизировать отказ, ты минимизируешь вероятность того, что у тебя реплики одного куска данных окажутся на тех машинах, которые одновременно откажут. Больше того, на самом деле, можно даже не думать головой, ну, то есть, делать вещи, которые... Ну, то есть, что бы попытался сделать я просто первым, вообще не читая никого другого в ресерче, я бы просто смотрел... как это... Ну, то есть, вероятность отказа машины ее можно считать просто по тем же формулам. Ты просто берешь для каждой машины и начинаешь считать вероятность. Каждый раз, когда машина фейлится, ты ее сбрасываешь. Дальше ты следишь, как бы, какие у тебя группы узлов имеют сейчас примерно одинаковую вероятность. И если на группы узлов с одинаковой вероятностью, не важно, высокая она или маленькая, есть реплики одной и той же партиции, ты их просто перебрасываешь на узлы с другой вероятностью. Я, конечно, понимаю, что подобная перетасовка, она может привести к занятному парадоксу. Есть другая забавная история про то, что был какой-то станок, который там узлы, ну, не узлы, эти палки делал, железные прутья металлические нужного диаметра. И вот у него была какая-то погрешность. И там была какая-то штука, которая с мере этой погрешности подстаревала станок. В общем, выяснилось, что когда этот какой-то настройка, настраиватель погрешности выкидываем, то станок на самом деле точнее работает. Я не исключаю, что предложенная у меня схема имеет такую же проблему. Но вот просто вот сходу я бы делал именно так. Но опять-таки, как я уже сказал, что там есть ссылки то ли в Твиттере, то ли в комментариях к статье, есть ссылки на более новый ресерч о том, как правильно делать реплика-плейсмент в очень больших кластерах. Но это серьезная проблема, с которой не сталкивается, может быть, например, Google. Вот. Тут еще в чате вспоминают парадокс с Дней рождения. Мне это кажется немножко не то. Ну, почему? Если мы возьмем какой-то фиксированный интервал, скажем, 5 лет, да? Ну, допустим, все сервера ломаются один раз в 5 лет. И потом проводим аналогию с парадоксом Дней рождения на большем интервале. Ну, то есть, зависит от твоей модели и насколько она соответствует действительности, но почему нет? Парадокс с Дней рождения немножко другой, да. Он про то, что он контринтуитивный, то есть у тебя в обоих случаях контринтуитивные выводы получаются. Я не знаю, почему вывод... Ты намьёте. Для меня неочевидно, почему эта штука с данным центром, почему она кому-то кажется контринтуитивной, потому что для меня достаточно естественное наблюдение, что если дисков много, то есть в принципе просто много, очень много, то вероятность того, что упадёт достаточно большое количество всего, она велика. И это ещё не говоря о том, что у нас фейлеры, на самом деле, бывают, как у нас бывают correlated failures, например, диски из одной партии. То есть, когда мы обсуждали Dropbox, как они запиливали свою новую систему хранения, у них там был важный момент, они в серверы напихивают диски из разных партий, чтобы ни в коем случае не было так, что у нас диски не варьируются, потому что они просто из одной партии с одинаковым дефектом. Вот. И вот, как бы, ну просто из наблюдения крупных дат-центров становится понятно, что диски ломаются, ломаются часто, и шанс того, что диски сломаются одновременно, они довольно высокие. И дальше, как только ты понимаешь, что шанс того, что сломается больше одного диска одновременно высокий, понять, что в принципе есть хороший шанс, что там могли быть все реплики одного, от одних данных, он как бы не нулевой уже сразу. То есть, и мне нужно, как бы, то есть, не важно, низкие или нет, как только мы добиваем кластер до размера того, что у нас вероятность события три одновременных дисковых сбоя, это типа, вещь, которая происходит, например, раз в год, то сразу же нельзя больше ни в коем случае отмахиваться от того, что на этих трех дисках могут быть данные об одном и том же. Есть мнение, что тема себя исчерпала. Да, я предлагаю пойти дальше. Я считаю, что да, пора идти дальше. Дальше со что тема, поэтому вот, черпай свою. Саш, а можно тему про самопаяльную паяльную станцию, меня она прямо очень интересует. Хорошо, почему нет. Самопальная паяльная станция, нашел да, ой, сейчас только ссылка прилетит. В общем, на Geek Times был пост одной компании, которая делает разную электронику прикольную. То есть, как я понимаю идею, ребята и девушки занимаются следующим, что они находят технику, которая стоит дороже, чем она должна стоить, и пытаются сделать такую же, только дешевле, и конструктор сделает сам. То есть у них в магазине, магазин называется Custom Electronics.ru У них есть паяльная станция, очень красивая, в прозрачном корпусе. У них есть, что еще, а, сверлельный станок, для сравнения, у них сверлельный станок стоит 2400 рублей. Очень удобная штука, когда нужно делать, например, те же печатные платы, почему, потому что сверло всегда идет прямо. Большая проблема, когда ты сверлишь руками, что у тебя не получается идеально прямой угол, сверло идет под небольшим углом, и когда оно проходит через толщу стеклотекстолита, оно выходит не там, где должно. То есть можно повредить дорожку на другой стороне, например. Не говоря уже о том, что когда у тебя в плате 200 отверстий, у меня уже была плата, в которой 250 отверстий, это не так уж много, это обычный кейс. У тебя просто встают руки, я под конец не чувствовал кончиков пальцев. Очень полезная штука, и если покупать ее, просто поискать по индекс маркету, сверлильный станок, то ближайший аналог стоил 7500 рублей, то есть там типа в 4, ну хорошо, в 3 раза дороже, и весил 18 килограмм. Эта штука, она такая маленькая картонная штучка на столе с моторчиком. Все это они отправляют почтой. Тут есть маленькая проблема, что у них магазин открылся сравнительно недавно, и они отправляют это почтой России из Екатеринбурга, и оплату они принимают в виде, что ты через сайт делаешь заказ, они тебе присылают там номер карты, и ты должен на номер банковской карты сделать перевод. Но это сейчас в любом интернет-банке элементарно делается, но небольшое неугодство. В общем, я не удержался, заказал себе паяльную станцию и станок, вот жду. А, ну еще у них в магазине есть разные другие прикольные вещи, не все сделаны у них, например, вот известный программатор USB ASP можно у них заказать, чтобы не ждать из Китая. Собственно, вроде это все. Очень интересные статьи у них в блоге, на GitHub, и вроде я рассказал все, что хотел. Вопросы? Вот ты, Вань, тебе уже заказал станок? Слушай, нет, станок я не хочу заказать, а паяльную станцию очень хочу. А зачем? Ну, я понимаю, на самом деле, вообще замечательная идея для новых изобретений, вот берем все, что угодно и делаем прозрачным. Вот смотрим, не знаю, на что я смотрю, на лампу. Сделать настольную лампу только прозрачную, чтобы там внутри были проводочки. Слушай, да, да, часы наручные с прозрачным этим, чтобы было видно, как шестеренка крутится. Они офигенно выглядят, да? И я хочу еще ноутбук прозрачный, чтобы было видно внутри все. А тебе, зачем тебе паяльник, и тем более прозрачный? То есть у тебя реально потребность или так? Ну, я паять иногда паяю, то есть как бы схемы не то, чтобы, знаешь, там, конденсаторы перепаять, что-нибудь выпаять, запаять там и так далее. А вот схемы сверлить мне не надо, поэтому сверлельный станок мне, в принципе, наверное, не нужен. Мне тут намного больше энтузиазма, как раз. Паяльник я скорее так в коллекцию как запасной, ну, например, у меня китайский паяльник дешевый, очень быстро сломался, когда ты лудишь плату. Ну, то есть когда он долго включённый, он быстро запоролся. Поэтому вот как запасной паяльник, на всякий случай, не самая плохая вещь. А вот сверлельный станок у меня прям вызывает массу энтузиазма, потому что это вот прям очень нужно. Он тебе нужен только для платы, да? Ну, пока да. Но я думаю, ему ещё что-то можно сверлить, я просто пока не знаю что. Но я же найду обязательно. Ну, у него просто, я смотрю на размер, у него максимальный размер, то есть как бы ты не подсунешь туда ничего широкого, он посередине какой-нибудь плиты просверлить уже не сможет. То есть где-то что-то с крышкой, либо маленькое, и сверло небольшого диаметра. Диаметр сверла это как-то он не особо зависит от размера станка. У него там этот, как патрон, он не очень большой, то есть он просто не расширит достаточно. Ну, то есть как бы я понимаю, что если делать ручные поделки, это выше крыши, но у меня не так много всего, что я делаю руками, так вот прям. Поэтому мне, наверное, не очень полезно. Знаешь, что я хотел уточнить? Я думал, просто ты уже купил, и хотел прям вот как личный опыт по пользованию. А, ну нет, он же будет там доставка типа несколько дней. Почта России, мы понимаем. Его в пятницу только отправили. Если вообще дойдет. Нет, ну вот из Китая, тут, кстати, есть соседняя тема, она короткая, поэтому могу сразу бомбнуть. Первый раз заказывал что-то на Алиэкспресс. Тут заказал себе, ну поскольку это был первый заказ, то так, ради эксперимента такие на макетную плату микро-USB разъемчики именно для прототипирования. Хотя, в принципе, их можно выпаять и использовать в готовых устройствах. Ну, ехал ровно два месяца. Вот прям ровно 26 ноября заказал, 26 января приехала. Это я к тому, что да, оно в том числе, то есть доставлялась обычной почтой, сначала там оно через Китай идет, вот почта России по России, ну, то есть доехала. Вот кому в самом деле нужен этот разобранный станок? На самом деле? Нет, я прям вот, я думаю заказать. Я прям хочу заказать. Ну вот, можешь подождать, пока ко мне кто-то доедет и услышит отзыв. А, кстати, на Geek Times они обещают, что в следующей модели будет еще и фен. То есть будет и станция, и фен. Я только не понял, там нужен внешний источник питания? От ноутбука, как я понял. Ну, то есть там стандартный разъем, ноутбучный, ну, в смысле, да, у тебя Mac, у тебя нет такого понятия, как стандартный ноутбучный разъем, а вот у меня Toshiba, ну, в смысле, у меня в Fujitsu и до этого были Toshiba, и у них одинаковые разъемы, поэтому у меня такой проблемы. Ну, короче, в любом магазине купишь. Все, понял. Вот. Я хочу на секунду вернуться к сочерпавшей на себя теме. Я почитал немножко комменты, но, в принципе, я упустил этот момент. Что на самом-то деле, когда у нас очень много очень маленьких партиций, все-таки шанс того, что диски выйдут совсем одновременно невысок, и очень маленькие партиции, они могут быть просто реаплицированы. Это еще один способ борьбы с вот такими проблемами. Если у нас очень много очень маленьких партиций, то после вылета диска у нас все, что на нем лежало, будет еще раз реаплицировано куда-нибудь в течение буквально пары, ну, в общем, меньше, чем за минуту. Если у нас в течение минуты не выйдет что-нибудь еще, то, в общем-то, у нас данные довольно хорошо себя будут чувствовать. Тут в чате пишет Вадим Велокодный, я извиняюсь, если неправильно произнесу, что это SMD Roulette. SMD действительно Roulette, но у меня, правда, с ним не всегда получается делать платы лутом, чтобы не слепались дорожки, то есть, если передержал утюг, то потом сидишь и шилом проковыриваешь эти дорожки. Сомнительное удовольствие. Классная шутка. Вы прислушали пример Aventual Consistency, это про слова Валеры. Не сразу дошли. Спасибо. Да, у меня все. Я могу еще одну тему про электронику. Давай, давай, давай. Понравился, но я подписан на блок чипы DEEP, и они туда иногда постят анонсы новых девайсов, которые не продаются. И тут девайс от известной компании Amperka, которые они разные делают, то есть у них есть свои макетные платы, у них есть свои клоны Arduino, потому что Arduino, она открытая, только ленивые не делают клоны. У них что важнее, у них есть еще очень прикольные ардуино-шилды. Вот, ладно, клоны Arduino, в принципе, в Европе можно купить ту же самую Arduino. А вот, чего в Европе купить нельзя, и мне прямо очень обидно, у них был очень здоровский шилд, который был одновременно и мотор-шилд, и еще с такими дополнительными майон, и вот это прям настолько круто, что я ничего такого больше не видел. Главное преимущество в том, что, во-первых, не нужно самому себе паять, во-вторых, он очень компактный, то есть он размером с саму Arduino. На самом деле, эта новость, она почти что об этом. Но я не согласен насчет купить Arduino в Европе, потому что стоит намного дороже, чем произведено в России. Здесь и клонов дофига, я вот к чему. То есть купить что-нибудь ардуинообразное в Европе не проблема и не дорого. А вот такую штуку просто я не находил. Ага, окей, ну да, и здесь, собственно, пост про названные шилды один из, и вот мне всегда было интересно, что за тройка модулей и зачем они нужны. Вот они очень удобно вставляются в этот самый шилд, а потом всё это заворачивается в очень клёвый корпус. И у тебя на самом деле получается, что ты вот взял корпус, вставил в него Arduino Leonardo, на неё поставил шилд, на неё там, не знаю, до 6 модулей, ну они разного размера, то есть смотря сколько и какие. Корпусов ещё не было, когда я последний раз смотрел. Вот, а новость, собственно, про корпус. И у тебя получилось нормальное, удобное устройство вообще без спайки. Вот, это, по-моему, совершенно потрясающая идея. Вот, да, вот я про это и говорю, что вот это настолько здорово, что мы берём просто из, ну практически буквально говно и палок, собираем как это... устройство. Оно, конечно, получается больше, чем то, что вы спаяете сами. Потому что сами вы можете гораздо компактнее, вы можете взять Arduino, как называется, то ли Nano, то ли как-то ещё, которое даже без USB, которое нужно в программатор вставлять. Ты можешь спаять в микроконтроллер, он... это делается элементарно и занимает ничьего места. Да, в общем, потому что пайка и вот это всё даст вам гораздо более компактную и штуку, которую можно засунуть в какой-нибудь совсем практически супер-пупер микрокорпус. Но вот все эти тройка и так далее, они дают вам другую здоровскую возможность, они дают вам собрать прототип в самом буквальном смысле из конструктора. И это будет работающий прототип. Вот, ну, тут есть, конечно, нюанс в том, что там один светодиодик продаётся за 150 рублей, но с другой стороны, их не надо слишком много, и если вы будете делать сами этот модуль, он на столько же вам обойдётся. Ну, там, кусок стекла, текстолита, время и так далее. Ну, скажем так, тройка Shield это ещё просто удобняшка, ну, то есть там действительно ничего такого кардинального нет. Какой-нибудь MotorShield спаять свой собственный, это уже непросто. То есть, как бы, я наблюдал процесс спайки управления, схему управления моторами, там сложность в том, что там две цепи, одна цепь идёт на то, чтобы, собственно, с Ардуиной общаться, и там маленькие токи. Другая цепь идёт на то, чтобы моторы крутить. И там она запитывается от вообще другого источника питания, там гораздо больше ток, чтобы моторы питать. И там стоят, я не помню, как компонент называется, но в общем суть в том, что у него он как бы переключается в цепи с малым током, а через себя пропускает или не пропускает больше ток. И вот я наблюдал, как на самодельную пайку вот этого извели денег и этих компонентов больше, чем стоил бы мультисерва Shield. Что довольно смешно. То есть, это, конечно, потрясающее упражнение, но как бы не отменяет того, что готовая деталь будет работать, просто работать. У меня было желание сделать такой таймер, и вот чисто для подкаста, то есть берём текстовый JkDisplay и он, на нём выводят время, и можно ещё число слушателей онлайн выводить. Очень удобно держать на столе, потому что не нужно постоянно переключаться между окнами, айфон всё время гаснет. Я сделал себе такую штуку. Выводить в трей. Выводить в трей – лень. Но потом это не спортивно. Смысл в том, что я сделал в итоге такие часы, но они как-то и выглядели некрасиво, и так далее. А вот будь у меня такой корпус и вот эти шолды, то он собирается, и у тебя получается готовое устройство. Прям красота. Ну и давайте я, наверное, добью ещё одну. Напоминаю, что каждую первую пятницу месяца проходят встречи 2600. Проходит это в Москве в пабе, который называется LaraCraft, как LaraCraft, только обыгранная. Это рядом с Китай-город, на чистой пруды в этом районе. И там, собственно, проходят вот эти встречи, дефоны и так далее. И на ближайшие встречи есть два момента. Во-первых, Олег Купреев как-то говорил, что попытается показать пайку SMD-компонентов, говоря о хакатонах, кстати, вот этих матрёшек, которых на конференции Zero Knights раздавали бейджики в виде матрёшек. И на её примере, если он не забудет, то покажет. Ну, кстати, я своё уже спаял. И второй момент... Что такое SMD? Скажите, дурочка. Surface Mount Device. То есть, это когда ты не в дырочке паяешь, а поверхностно. Поверхностным монтажом. Окей. Плюс в том, что не нужно сверлить дырочки, да? И компонентов намного меньше, их больше помещается. Ну, ты если компьютер откроешь, на материнку посмотришь, а там всё с Surface Mount, да, я понимаю. Ну, на самом деле там комбинируется, но преимущественно. Да, и второй момент, что там в чатике DevCon'а зашёл как-то разговор про всякие неиспользуемые электронные компоненты, но они копятся со временем. И я решил некоторые раздать, из которых я уже вырос. Ну, там, знаете, счётчики 555, некоторые микросхемы стандартной логики, там, 7-4 HEC вот эти вот. Потому что их у меня реально много, они занимают место, и они мне уже не очень нужны, а кто-то только изучает, им пригодится. Так что приходите, либо за этим, либо просто пиво попьете. Тема слушателей? Да, я думаю, проём уже. Я хочу, у меня очередную тему слушателей. Тут слушатель Виктор Мишин занёс, ну, она не набрала голосов, но мне просто интересно, я сам поразился, что оказывается у ретинга, которым успешно похоронили уже дважды в нашем подкасте, он, оказывается, продолжает жить. То есть в него контрибьюдят, и тут расшарили ссылки на какой-то roadmap, и даже что планируются релизы вот в феврале будет релиз, и ещё дальше версии ещё не запланированы, но планируют определённые улучшения по части перформанса и всяких других штук. Это довольно здорово, потому что вот, как я уже говорил, что это на данный момент одна из немногих баз, которая хорошая. Вот, я очень рад. Но это была мне очередная тема. А очередная тема, она, кстати, по-моему, я даже заносил её в основные темы. Не уверен. Да, да, заносил. Троллологово и Скала. В общем, суть в том, что тут компания, по-моему, да, movio.com написали пост о том, как им хорошо живётся на Скале. Ой, сорри, ногой. И как они долго мучались со Скалой, а потом взяли, сбежали ногой, практически не жалеют. В общем-то, история, как обычно, Скала сложная, долго компилируется, и вот это всё. Но, с одной стороны, не могу с ним поспорить, потому что, если так, с другой стороны, ну, ребята описывают то, как у них не идеально. Я не уверен, что это в этой статье было, но я тоже читал, что у них там выходы интенсив стеки всё не очень идеально с good-драйверами или чем-то таким. Я не уверен, в этой статье было ли это ещё, как уже сказал. Но суть в том, что они просто подпилили гошный драйвер. Вот мне кажется, что всё-таки, если речь идёт о каком-то какой-то big data, Скала стеку и Джава стеку сейчас, мне кажется, практически нечего противопоставить, потому что, даже если мы берём Go, то нам там придётся допиливать, буквально сегодня, в одном из около девизеновых чатов всплывала тема, что драйвер для Кассандры в Go как-то там с ними всё не очень, ну, вроде хорошо, но можно лучше. Вот. Очевидно, что в Скале и Джаве с драйверами к Кассандре всё хорошо. То же самое обычно касается драйверов к Кафке и всяких других таких вещей. Но, с другой стороны, трудно отрицать, что в Скале можно писать, как Бог на душу положит и, в общем, страдать. И там отдельно выделяется пункт, про который, по-моему, говорит 2 или 3 выпуска недат, про то, что мне очень нравится, что в Go и Erlang есть подход к concurrency, который в языке сразу есть, и это вот подход к concurrency, которым надо пользоваться. А в Скале подход к concurrency, он как бы весь в библиотеках, и на самом деле имплементации разные, и там даже если это актер, то они через футуры, если это футуры, то они могут быть стандартные, нестандартные и ещё какие-нибудь. И с одной стороны писать можно, с другой стороны чёрт-ногу сломит, и учиться этому может быть тяжелее, чем нужно. Вот. Ну, как бы, всё так. Чё смешно шутят. Там постой, ну, пишет это Вадим Великол... Великол... Ну, я извиняюсь, если что. Так что, получается, рисинка ДБ заживо похоронили. Смотрите в кинотеатры заживо погребённые 3. Ну, всё так, видимо. Там ещё шутят про то, что мальчик, один из... Ну, мы уже сказали про хп, он из дурки вышел. Ну, на самом деле, там да, там ещё есть такая история в этой же статье, что ребята, на самом деле, пришли из каких-то довольно странных языков, потом они все вместе как-то пришли в скалу, потом они из неё ушли в го. Странная история, потому что обычно в скалу приходят люди, которые раньше, я не знаю, которые хотели на хаски, но им не дали. Вот. А тут люди, короче, пришли даже, кто-то вышел из хп, и у них там чуть ли не любимый язык, раньше до этого был бейзик. Я ничего не хочу плохого сказать, но для меня это довольно как-то необычно слышать про людей, которые пришли в скалу с таким бэграундом. Чё мы слышали? Так мы это уже... Это уже было 5-й первый раз, когда мы это слушали. То есть просто я её тоже занёс, но это и есть тема слушателей, это та самая наголосованная. Угу. Тут ещё говорят, что Линкерник тут комментирует, наш регулярный слушатель, что он регулярно слышит, что симпл инвиды было от гошников, а в то время как сишники... C тоже достаточно простой язык, и джава тут посложнее, но тоже не космос, но почему-то подобно не говорят, что за искажение сознания. Ну вот что я хочу сказать, что C он... Я ничего не понял, ты не мог бы объяснить, в чём тема? Это комментарий к предыдущей теме, который мне кажется стоит упоминания, что вот почему симпл therefore readable, почему это правда, что мол вроде как... Ну что гоферы всё время так говорят, но в тот же время это должен быть правда и про C, и про джаву, а тем не менее они такого не говорят. Вот я лично считаю, что C он симпл в плане того, что там мало движущихся частей, но там очень много нужно держать в голове из-за того, что происходит на самом деле. А джава... Ну много хуже него. А джава, она просто не симпл, ни в каком месте. Ну то есть, просто чтобы прочитать джаву и нужно очень много кода просто пролистать, чтобы просто понять, что происходит. В смысле, не просто даже в странице... Не правда. Не правда, смотря как напишешь. Ну да. Из джавы и с C можно написать прекрасно читаемый код. Да, но всё равно джава многословная, она даже более многословная, чем го. Соответственно, нужно гораздо больше кода прочитать. Тогда проблема и не только с многословностью, а с тем, что ты ещё должен живым хорошо знать. Ну, слушай, с го там такая же проблема, нужно понимать, как гошный рантайм работает. Ну положай руку на сердце, когда писать под что-то, что имеет рантайм, виртуальную машину или ещё что-то ещё такое, и не знать, как она работает. Согласен. Много обычно знают гошный рантайм. Насколько сильно гошники знают гошный рантайм по сравнению с джавой, которую должны знать джавы? Те, с которыми я общался, мне такое ощущение, что гошники знают чаще, во-первых, потому что он проще, там меньше магии. Вот-вот-вот, я про то же. То есть в итоге получаем мы к тому, что рантайм проще, его знают больше, да. Ну это ещё, знаешь, ещё от того, что в гофиске люди, им чуть больше интересно программирование, чем ну, как мне кажется, у меня такое сложное впечатление, что им чуть больше интересно программирование, чем просто написать какую-нибудь фигню, тяп-ляп и пойти домой, потому что вот такое ощущение, что в джаве очень много собирается людей, вот то, что называется в бодишопах, которые пишут какую-то интерпрайзную джаву совершенно без радости, без вкусок жизни, и они не знают, зачем они за этим занимаются. А как назвать вот это вот, когда ты расист, но только применительно к языкам программированиям? А вот знаешь, нет, понимаешь, я не хочу ничего плохого сказать про джаву, я видел очень много хорошего джава-кода, хороших джава-разработчиков, просто у меня сложилось впечатление, что есть какие-то вот такие вот отдельные гетто, вот Света на какой-то момент про такое рассказывала, что, и я тоже про такое слышал больше одного раза, что люди оттуда просто сбегают адекватно, потому что там очень тяжёлая атмосфера, люди сидят, страдают, пишут какой-то страшный интерпрайзный код, но он плохой не потому, что он интерпрайзный, а потому что они пишут для интерпрайза, но почему-то вот именно так. И... Это очень грустно, такое. И плюс ещё, отвечая на этот же вопрос, когда говорят про окружение, то есть мы говорим не только про язык, но и про JVM с точки зрения джавы или гошный рантайм, если на го, то для C надо точно так же хорошо знать все библиотеки, которые вокруг крутятся, вашего приложения, в частности, или Psy, и, возможно, ещё знать операционную систему. То есть как бы все приложения низкоуровневые или Embedded, которые пишутся на C, они обязаны хорошо взаимодействовать с железом. Поэтому очень тяжело сказать, что это вот прям простой, simple и понятный. Окей, следующая тема про то, как Discord. Discord это такая платформа, это как слэк, только для геймеров. Вот, как я могу вкратце сформулировать, это реально примерно то же самое, что слэк, но в нём сидят в основном геймеры. Я так понимаю, там он от слэка в своё время отличался тем, что там голосовое... Какое-то голосовое общение уже было, а в слэке его гораздо позже завезли и не для всех. Или уже для всех, не помню. Точно знаю, что в платных темах голос в слэке есть. Вот, ребята рассказывают про то, как они выбросили Монгу, поставили Кассандру для хранения сообщений. Ну то есть как бы я ни разу не удивлён тем, что у них Монга не очень хорошо работала, потому что для этого use case, потому что она вообще ни к чему не работает. Да ладно. По поводу Кассандры, в целом для этого применения, мне кажется, довольно адекватно, потому что она на самом деле хорошо подходит. Там как раз удобно сделано, что там одновременно и... То есть, в отличие от какой-нибудь реака, до недавнего времени, там сейчас реака есть, это уже функционал, в Кассандре всегда можно ключ делиться на ту часть ключа, по которой происходит роутинг на узел, и другую часть ключа, которая позволяет внутри одного узла хранить вот, что называется, колонки. Это позволяет сообщение, например, в довольно крупном промежутке времени хранить на одном узле, и получается, что запрос на рядом как это... как бы сообщения, которые были написаны примерно в одно и то же время, их можно выгласить сравнительно компактной пачкой. И в отличие от реака, дописывать в эту коллекцию сообщений можно, не считывая её всю. Что довольно здорово. В общем-то, статью я оставляю вам на прочитать, я не буду её сейчас пересказывать. Вкратце, там из того, что мне конкретно показалось странным, ребята... То, как ребята сделали обновление сообщения, это, знаешь, вот типичная ошибка людей, которые раньше не работали с АПСистемами, они пытаются обновлять сообщение, притом, по довольно странным правилам, вместо того, чтобы просто редактирование сообщения или удаление сообщения записывать как следующее сообщение, и потом на клиенте это резолвить. То есть, мне это кажется гораздо более... или даже на клиенте, она... там у них в любом случае какая-то АПишка вокруг Кассандры есть. Это гораздо более хорошо работает. И там даже проблемы, которые они описывают, не возникают. Просто потому, что оно как бы более надёжно. Таким образом. У вас не возникает никаких проблем с конфликтами и так далее. Просто потому, что вы можете записать, что у вас вот сообщение 2, оно имеет как-то причинно-следственную связь там с сообщением 0. Casual. Козл. Не casual, а козл. Козл. Окей. Я всё время раньше делаю эту ошибку, я вот постараюсь её не делать. А я у тебя научился. Да, но на самом деле, козл, потому что casual это как-то... стиль одежды, или как-то повседневный, а козл это от слова cause, типа причинно-следственная. И я всё время раньше оговаривался. То есть, я головой понимаю, что я оговариваюсь, но всё время оговариваюсь. Поэтому решил по-русски сказать. Вот. В общем, ты можешь сказать, что у тебя сообщение 2, оно зависит от сообщения 0, и сообщение 2, оно на самом деле никак на сообщение... не является физическим сообщением, оно, например, может быть просто версией другого и того же сообщения, или оно может вообще быть сигналом того, что предыдущее сообщение должно быть видно. Дальше при чтении, ну да, нужно немножко присесть и из вычисленных кус... То есть, вначале вычитываем просто по времени, потом из того, что мы вычитали, делаем топологическую сортировку. Если у нас есть какие-то незарезованные depend, возможно, нужно прочитать ещё один кусок, потому что у нас сообщение создаётся что-то более старое. Но чаще всего это делать не нужно, потому что у нас, например, это просто новая версия, или сообщение о том, что какое-то предыдущее сообщение удалено, поэтому можно всё равно дальше в историю не смотреть. И после этого просто показываем уже готовый кусок. Это хорошо тем, что, в принципе, edge-кейсы, которые они описывают, не возникают. Больше того, не возникает проблемы, которая у них возникла, связанная с тем, что если мы наудалили много, то там начинается взрыв томстонов, потому что с таким подходом вместо того, чтобы удалять каждое индивидуальное сообщение, можно написать сообщение, которое говорит, удали всё предыдущее. То есть там можно делать офигенные оптимизации, завязанные на то, что мы понимаем, что манипулируем, на самом деле, просто частично упорядоченным логом, и лог читает клиент, который всё равно потом материализует в какое-то визуальное представление чата, и во время этой материализации в этом логе мог быть кроме сообщения ещё просто командой, самому материализатору. Вот. И ребята просто вот... Они, конечно, молодцы, что Монгу взяли Кассандру, но им ещё как-то учиться и учиться это готовить. Я... Всё. Кто-нибудь ещё это читал? Н-а. Ты ожидаешь, что вот прям будет лес рук, да? Да. Кто-то читает тему. Ну, то есть, понимаешь, мы, видимо, к выпуску, что ли, готовиться отменяли, я вот вам в гости привёл, тему слушали, прочитал. Видишь, какой я молодец? Ха-ха. Я как-то исправляюсь. У меня не было двух выпусков подряд, по разным причинам, а вот теперь исправился. Хороший годный Валера. Да. Вообще себя не похвалишь, как обиженный стоишь. Дальше тема с меньшим числом... Да, там уже всё с меньшим числом голосов. Ну, единственное, что хочу сказать, что там забросили тему ГОГО с Эликсир. Я её читал, эту штуку, и я утверждаю, что она статья дурацкая, бессмысленная, её можно было не писать. Слушай, а есть предложение уже давным-давно забанить тему язык против язык, база против базы, операционная система против операционной системы. Вот предыдущее, то, что я рассказывал, потому что они перейтили на Кассандру, это довольно интересная история, потому что там всё-таки не против, там просто именно переезд и опыт переезда. Я так вот предлагаю оставить. И действительно, вот темы типа А против Б, именно просто ВС, вот это действительно предлагаю просто больше никогда не обсуждать. Не, подожди, но тут как бы, если ты говоришь, что лучше, то это да. Если ты сравниваешь плюсы и минусы каждой технологии, ты понимаешь, для чего они предназначены? Они становятся всегда дико субъективными, все эти штуки, и я не вижу смысла тратить каждый раз время на обсуждение какого-нибудь чудного ВС, кроме случаев, когда там реально хороший бенчмарк. То есть знаешь, когда вот сейчас буквально, наверное, неделю или полторы назад всплывала статья на блоге Перконе, где там они MySQL с Кодвисом меряют, но там интересно даже не результаты, там интересно, как они к этому подходят, чтобы у них реально получился одинаковый бенчмарк. Это интересно просто хотя бы потому, как они это делают. Это действительно интересно, очтиво. Но мы пока это не обсуждаем, просто у них там очень in-progress. А просто вот эта поверхностная статья на кодэшипе про ВС Алексеев, это даже хуже, чем то, как они валили со скалы на ГО, потому что статья сразу видно, что она написана просто для того, чтобы люди пришли на блог кодэшипа. Это чисто маркетинговая статья, которая содержит ноль полезного смысла. Я так и говорил, то есть маркетинговые статьи давайте просто не рассматривать. То есть это даже не маркетинг языка, это просто самое страшное, что можно делать. Это реально маркетинг кодэшипа. Написали статью в блок кодэшипа, чтобы в блок кодэшипа пришли люди и потом пользовались кодэшипом. Вы понимаете, что эти сволочи делают? Да, удаляем. Ты пять раз повторил это слово, не говори его больше. Мне еще понравилась ссылка на... как это... вероятностный программный язык. Мне тоже понравился, но я... Надо прочитать обязательно. Я прямо хочу. Я себе такой же внук положил в закладку, не знаю, когда я прочитаю, потому что у меня уже какая-то стопка из трех пейперов лежит. И я все... У меня все время более интересное занятие находится. For Honor вышел, я в прогон играю, вот это все. Я на работе работаю, работаю, а домой прихожу и мечтаю на столько день становится. Я другими вещами занимаюсь. Я пейперы люблю читать. Здесь вот прям мне понравилась статья вводная. Ты тоже? Я тоже читаю. Ну это же надо сесть и прочитать. До конца даже дочитать, чтобы обсуждать. Спасибо, Викторию Мишину. Кстати, от того же Викторию Мишину небольшая ссылка на еще одну вещь, которая набрала всего один голос, но тем не менее хочу это обсудить, тем более там вопрос, спрашивая на который мне лень текстом отвечать. Там бенчмарк, куча баз друг против друга, где в частности подгрест ниже эластика. Я там уже в комментариях ответил, что подгрест там мерили странно, ему дали мало памяти. Его мерили в двух конфигурациях, из которых Suboptimal. Его гоняют на нагрузки, а у AllApp, при том что подгрест на самом деле большего LTP база, и вот всякие такие еще поправочки. Вот как я работаю сейчас в компании, где подгрест используют для AllApp, у нас к нему куча пределов на кастомных расширений, некоторые из которых даже open-source, и все они абсолютно направлены на то, чтобы было как можно меньше I.O. Кроме того, компания Подгрест Профессионал, в которой работает Александр, они выпустили например такую штуку, которая я не знаю, по-моему это платная версия, которая позволяет делать сжатие на диске. Это платная у вас фича, да? По-моему это часть IE, последний раз когда я ее добавил, но это инфа не 100%. Ну короче, в любом случае, можно занести небольшое число денег за IE, и у вас будет эта фича, которая позволит вам делать сжатие на диске. Большинство, Саша в open-source выкладывал штуку, которая JSON жмет в Postgres. В общем, есть больше одного способа уменьшить I.O. с диском, когда у вас данные в Postgres, этим надо пользоваться, это раз. Во-вторых, Postgres с настройками по умолчанию, у него настолько маленькие буферы всего, что он и так много в диск ходит, просто потому что он так написан, он писался давно. Так он еще, если ему дать мало памяти, он будет еще чаще ходить. Ему можно, во-первых, оптимизатору сказать, что у нас много памяти под кэши, чисто под кэши ОС. Во-вторых, можно просто в Postgres дать WorkMem большой, а там у нас такой workload, который в WorkMem, ну, как вы видите в бенчмарке, который в WorkMem пользоваться не попрезгует. То есть там даже без распарлельвания и даже без приседания с уменьшением IO, просто прокрутив настройки Postgres, можно, скорее всего, выжать сильно больше. Наконец, там была такая тема, что ха-ха-ха, эластик выше, и я начал отвечать на вопрос, что мы там такое с эластиком делаем. В общем, у нас очень, ну, я не знаю, это вроде, это не секрет, что мы логи храним в эластике, как это подписалось в нашем блоге. В общем, у нас очень большие объемы логов, потому что мы логируем, у нас есть наши данные, с которыми мы работаем, они как-то обработаны, их разумное количество. Логируем мы много всего, потому что дебажиться как-то нужно, нужно на вопросы клиентов отвечать. И вот этот объем этих логов для отладочных, он уже очень большой, существенно больше нашего рабочего объема. Я не уверен, что могу называть какие-то цифры, но суть в том, что оно сейчас лежит в эластике, и эластик не справляется. И вот мы конкретно хотим это заменять подгрессом, это пока такая, как бы, work in progress, не факт, что там в итоге будет подгресс, но тем не менее это факт, что мы эластик выбрасываем и ставим подгресс. Главная причина в том, что эластик, он так написан, что он весь такой, типа, распределенный, и когда нужно увеличивать количество данных, которые он прожевывает, ну, просто его нужно закидать большим количеством машин. Утилизовывать одну машину в какой-то момент перестает мочь, если я правильно понимаю, в чем там проблема. Опять-таки я с этим сам не работаю лично, это я рассказываю ощущения соседнего отдела, можно сказать. И начиная с какого-то количества узлов, примерно сотни, оно просто уже не могет дальше, там уже начинается проблема кластеризации, которая вот в пластике написана, она и так не идеальная, но там еще и на сути такая показательное число, мне кажется, сходу только Кассандра имеет дипломенты больше сотни узлов, у всего остального начинаются проблемы. То есть это показательное число узлов, после которого мало какая система дальше выходит. Мне кажется, у Ряка тоже проблем больше, чем сотня машин. Правда, Ваня? Да. И Postgres, он хорош тем, что он в этом плане написан хорошо, особенно начиная с 9.6, где есть параллелизация запросов, ему просто можно дать очень большую машину, там полтерабайта или терабайт памяти, огромную дисковую полку и это машина уже будет модчиком, не знаю, пол-кластера этого Эластика. Я уутрирую сейчас очень сильно, но реально Postgres может много, если ему дать много. Он просто горизонтально хорошо, ой, не, сори, вертикально хорошо масштабируется. Во-вторых, для задач хранения логов, код кластеризации написать тривиально, про это еще все время говорили, по-моему, в WhatsApp было доклад, как они делали свое хранение логов на Erlang и Mnozzi, и просто Google.file, там Mnozzi, по-моему, для метаданных, не важно. Дело в том, что и логи, их очень легко побить на временные отрезки, там уже не важно, какое партиционирование использовать, по таблицам, по схимам, по чему-то еще, мы берем просто каждый интервал времени, зарисовываем там вот этим единицам отрабления, настраиваем репликацию, дальше нам не нужно не решардить ничего, потому что это логи. У них есть срок давности. Допустим, ну я сейчас не знаю число от башки, например, каждый, не знаю, скажем, 3 недели, после 3-х минут, там, наш retention логов, например, 3 недели, или 4 недели, или 5 недель, после этого retention периода мы просто логи берем и выбрасываем. Соответственно, вместо того, чтобы решардить, мы просто, ну, у нас где-то место будет освобождаться, а где-то будет наоборот забиваться. И единственное, что нужно сделать, нам нужен алгоритм плейсмента новых кусков данных, так, чтобы, с одной стороны, у нас была немножко параллельная запись, уж точно параллельное чтение, для кусков, которые скорее всего будут запрашиваться вместе, для них желательно иметь параллельное чтение в итоге. Вот. И ваш решальник заключается в том, что вы просто ставите новых машин, а на старых мест освободится за счет того, что у вас просто экспирация произойдет старых логов. Притом, что поскольку позгресу можно скармливать очень мощные машины, и там нет необходимости поддерживать полную симметрию в кластере, то подход с тем, чтобы просто дождаться, когда у вас старые логи заэкспарятся на очень мощной машине, когда вы поставили другую очень мощную, он будет, скорее всего, работать для масштабирования. Вот это, как бы, текущее соображение, по которому мы заменяем власти, точнее, планируем заменять власти от позгреса. И мне кажется, это довольно здравое соображение. Единственное, что меня об этом всем смущает, в позгресе сейчас нет никакого сжатия, ну, вот где-то в open-source-ном позгресе, и все наши кастомные расширения, они ни одно не про то, чтобы сжимать plain-text. С другой стороны... Возьмите файл его системы с сожатием. Это раз. Во-вторых, можно пойти тем путем, который ты пошел в своем засоне, взять... Притом, что мы там, на самом деле, будем хранить plain-text, будем хранить cross-json, можно вполне себе, действительно, твой засон порекомендовать, и оно будет пожатое. То есть, в принципе, проблемы не до чего бы нерешаемые. Что здесь можно, так скажем, fair point, что, действительно, в позгресе все эти вещи, это не какая-то встроенная в позгрес вещь, то есть, ну, не знаю, из коробочной эластик действительно работает... Из коробочной наивной эластик действительно работает все еще лучше, чем из коробочной наивной позгрес, но позгрес хорош именно тем, что он очень ковкий. Из него можно собрать гораздо более интересную штуку, а эластик, даже имея там контрибутор в эластик, двигать можно только до некоторого момента, потому что он все-таки в первую очередь для другого. Обратил внимание, что если, ну, поскольку вы иммигрируете логи, это у вас, скорее всего, текст, текст в позгресе жмется из коробки, жмется гзипом. А, разве? Я, кстати, не знал, вообще не знал. Жмется, это называется toast. Там в том числе сжатие, не только перенос в табличке. Я, кстати, не знал, что весь toast жмется, я вот этого совсем не знал. Все текстовые, строковые типы... Нет, подожди, это не текст, если это бинарный JSON, он будет жметься? Не готов ответить, я думаю, что он жмется, потому что обычно он большой. То есть я точно знаю, что весь текст жмется, ну, то всякие JSON, которые без B, JSON, XML, текст, варчары, они точно жмутся. То есть вот это вот постороничное сжатие, которое ты упомянул в ЕЕ, оно для другого кейса, когда у тебя, например, много повторяющихся int.",
    "result": {
      "query": "Postgres vs Elasticsearch for logs"
    }
  }
]