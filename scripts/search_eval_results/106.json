[
  {
    "segment_id": "5777ee05-2232-4467-b827-0a4149d1fd28",
    "episode_id": "3bfefcff-43ed-4e8b-bbc2-595265ae5303",
    "episode_number": 106,
    "segment_number": 6,
    "text": "С другой стороны, он не делает сильных выводов из этого. И ты правильно заметил, что всё это свойственно не только для распределённых систем, но и просто concurrency, то есть у тебя может быть какой-то state, который нужно синхронизировать. И вот это, кстати, может быть очень полезно в конкурентной педотехнике, просто это понимание. Потому что это позволяет тебе делать какие-то операции, ну, грубо говоря, как CRDT, проведём аналогию. То есть ты можешь делать операции локально, а потом это всё срастается более-менее предсказуемым образом. Это позволяет тебе, соответственно, меньше лочить и тому подобное. Ну, это моё понимание, по крайней мере. Тем временем в чате Barlog-M интересуется, кому вообще в голову приходит писать такие вирусы передиусу. Ну, как бы, если хочется замайнить биткоинов за чужой счёт, вот таким вот ушлым ребятам хочется. А то, что они это ногой пишут, вопрос десятый. Просто на чём удобно, на чём пишут. У меня есть более удобный способ майнинга биткоинов. Один из первых самых проблемных моментов в Cloud Foundry, то есть несколько лет назад, это ограничение по использованию ресурсов. Не-не, ограничение по использованию ресурсов. И у нас был юзер, который пользовался бесплатным тиром, бесплатным планом, который майнинг биткоин. И мы со временем заметили, что у некоторых инстанций приложения CPU всегда в районе 100%. Посмотрели, соответственно, что он делает, поизучали, посмотрели на снапшот, на слаг его приложения и поняли, что происходит. И, соответственно, начали новый экзекьюшн энджин делать более устойчивым к такого роду товарищам. Так что, если честно, если вы хотите майнить биткоин, зачем вам Redis? Деплойте на Heroku, на Cloud Foundry, куда угодно. На фришный план, пока вас не выбрут майники себе. Я ни к чему не призываю, просто проще же. Ну так с Heroku выбрут, а с чужого Redis'а поди не заметят. Окей, но на Heroku проще начать, а на чужом Redis... Сложнее закончить. Мне кажется, на Heroku есть такая проблема, что тебе даже на бесскладном аккаунте, когда регистрируешь, тебе не нужно случайно персональные данные указать, кредитную карту, вот это всё. По-моему, не нужно. По-моему, тоже, раньше не было нужно. Так что все идём на Heroku. Дело в том, что тебе нужно что-то указать и тебя не будут сразу чажить, по-моему, тем не менее. Тебя выбрут достаточно быстро, потому что у людей есть мониторинг, понятное дело, но до определенной степени они просто не смогут ничего с тобой сделать. Ну то есть максимум они заблокируют себе аккаунт. Ну берём новый Gmail-адрес, берём... Если у вас карточка одного из банков из бывшего СССР, то вы для них недосягаемы по большому счёту. Вот барлок минус м, пишут, что 2 часа работает бесплатный план на Heroku. Как объяснить такое несоответствие? Дисклеймер, я ни разу не специалист по Heroku. Я тоже не специалист. Опять же, мы сейчас говорим о людях, которые майнут биткоины за чужой счёт, то есть по определению не ищут лёгких путей в жизни, да? Или таких конвеншионал, более-менее стандартных. Ну разберутся как-нибудь, автоматизируют, они же Go используют, ну море по колено. Ты так говоришь, Go используют, как будто там есть что-то плохое. Нет, в этом ничего нет плохого, просто есть люди, которые считают, что если вы скажите Go, то у вас просто это... Можно костюм Супермена одевать. Прекрасно, а кто эти люди? Которые пишут на Go и надевают очень обтягивающее трико. Я думаю, что они скрываются, потому что в России за пропаганду уже сажают теперь. А мне хочется добавить одночайку, бампнуть, потому что мы говорили про распределёнщину, и я хочу добавить пару ссылок про курс от Университета Королевского университета в Швеции про распределённые системы. И список тем выглядит весьма интересно, и что самое занятное, и почему мне больше всего нравится этот курс, там будут задачки на скале. Так что сейчас я добавлю ссылки. Можно я добавлю тебе... Я потом тебе пришлю ссылку, где там нет университетов и нет скалы, но есть overview алгоритмов, которые используются в реальных системах. То есть, грубо говоря, то, что вы найдёте в Cassandra, в HPACE, в Reddit MQ и так далее. MongoDB. Мне он показался на редкость таким... С одной стороны, простым для понимания, с другой — не совсем тривиальный. То есть они покрывают достаточно большое количество тем. Почему бы такие посты обычно... Ну, чаще всего найти. Хорошо, я тогда добавлю в вашу ноту, что ты найдёшь эту ссылку. Продолжая тему эпичных багов, тут некие чуваки нашли эпичный баг. Про то, что... Ну вот представьте, у вас какая-нибудь физическая машина, на ней крутятся виртуалки, скажем, в Xenia. И там есть некая страница, которая только на чтение, и она в... Ну, поскольку только на чтение, она мапится во все виртуалки. Представили? Мы знаем, что оперативная память, она ненадёжна. И там есть разные баги. Например, что если постоянно читать из определённого кусочка памяти, то у тебя в Айтике они иногда, редко-редко, но могут портиться. Ну вот. И ушлые ребята, они вот нашли способ подменять урлы на D-пакет, и вот это всё. То есть идея в том, что ты в своей виртуалке там постоянно-постоянно читаешь какие-то кусочки памяти, портишь там один битик, например, в доменном имени, и таким образом портишь битик в ссылках во всех виртуалах на этой машине. Как вам идея? Меня всегда удивляет, что есть люди, которые вот... Они настолько упороты, что им не лень вот такими вещами интересоваться, заниматься, и такие они находят такого рода баги. Что не сделать, чтобы помайнить биткоины на чьём-то хостинге. Я не думаю, что дело в майнинге биткоинов, то есть у них работа такая. Ну то есть они как QA, только безопасненькие. Нет, ну я, естественно, совсем серьезно это говорил. Я считаю, что если посмотрите, как человек, который не занимается секьюрити больше, чем среднестатистический там девелопер, порой поражаюсь, до какой степени у нас будет ссылка дальше в этом эпизоде, доходит security researcher'ы и некоторые люди, которые защищают эти системы. Потому что уровень понимания того, как на самом деле работают компьютеры, ну он прям очень-очень сильный должен быть. Так что мне кажется, это характеристика вот этой вот части профессии, то, что терпение и дикое внимание к малачам, это просто без этого никак. Нет, без чего ещё никак. Это без краткой истории консенсуса. Да, недавно нашлась, ну как, может быть, второй-третий раз попала на глаза ссылка, которая не является новой, она после 2007 года, в котором показывается история самых известных консенсус-алгоритмов, по-моему, даже не всех, но не суть. Я тут в этом году интервьюировал в какой-то период очень много людей и задаешь сильные вопросы, чтобы понять, где у человека сильный и слабый стороны, и рассказываешь про, в том числе, консенсус, как один из примеров каких-то распределённых проблем. И мне все рассказывают, что вот есть RAFT, есть PAXES, и они, грубо говоря, вот PAXES невозможно понять, а RAFT новый, круче, гораздо прочее. Ну, честно, вот 4 из 5 NAV-кандидатов делают следующее. Ну, это не совсем так. Подожди, подожди, подожди, они PAXES вообще базовый смотрели, или они просто говорят так? Они ничего не знают, они не могут объяснить даже to face commit. Давайте, если уж мы про это заговорили, смотрите, ключевая вещь, которую нужно понимать в сравнении PAXES и RAFT, это то, что это apples to oranges. То есть, RAFT решает, пардон, PAXES решает один круг консенсуса. То есть, грубо говоря… Подожди, подожди, подожди, я хочу ещё немножко такой дисклеймер сделать. О каком PAXES мы говорим? Об обычном, классическом, не multi PAXES, а обычном. Single and equip PAXES. Да, то есть, он решает один раунд консенсуса, ну это я так называю, у кого-то может быть… Есть другие термины, скажем так. То есть, грубо говоря, вы не как мы записываете подкасты в субботу вечером, а вы где-то ходите по городу, и вам нужно найти друзей, чтобы пойти в очередной паб, у вас паб кроу. И вам нужно договориться, где во сколько встречаться, так, чтобы не было слишком поздно, не было слишком рано, Вася не был слишком пьян и так далее. Вот это один раунд консенсуса. То есть, если вы договорились, все хорошо. А вот если вам это нужно сделать 10 раз за ночь, то это уже как бы лог операции. А еще есть такое усложнение, а если у вас группа по дороге меняется, хе-хе-хей! Да-да-да, и при этом нужно понять, что у вас есть люди, которых там жена позвала домой, люди, которые просто уже не могут, они слишком пьяны, люди, которые попали в провоку, люди, которые, я не знаю, познакомились с девочкой, решили срулить, и люди, которые просто тупо потерялись, потому что у них разрядился телефон. Все это есть. То есть, вся сложность этих алгоритмов исключительно в том, что и как может навернуться, пойти не так и так далее. Без этого все слишком просто. И мы бы сейчас жили с туфейсками. Так вот, давайте закончим про паксос и рафт. То есть, паксос классически решает одну проблему, один раунд консенсуса. И решает ее, надо сказать, довольно хорошо, по сравнению с тем, что было до него. Еще секундочку, еще такой маленький момент. На мой персональный взгляд, паксос, вот сингл декрипт паксос, для понимания намного проще рафта. Да, потому что он гораздо меньше, как бы скоп у него гораздо меньше. Я не могу сказать, что намного, но он проще просто потому, что он меньше. А теперь, почему у паксоса есть такая слава, что его невозможно понять? Потому что его автор, по-моему, в 97 или 98 году, ну, пейпер раньше был написан, опубликован в конце 90-х, решил приколоться и описать его, используя греческую демократию и то, как работает греческий парламент в своем пейпере «Part-time Parliament». Это не очень простой способ для объяснения вещей для большинства людей. И с тех пор пейперов на тему паксоса, которые его оптимизируют, упрощают и так далее, у меня у одного, наверное, только есть под десяток, где-то там в Google Drive. То есть, честно сказать, это все немножко раздуто. А теперь, что делает рафт? Рафт решает такую проблему как, у вас есть сервер, ну, EDCD классический пример, но не суть, у вас есть KVL-институт, там есть какие-то операции, да, записали, удалили и читаем между этим всем. Ну, нам интересно, в первую очередь, записали, удалили. То есть, что-то, что меняет стейт-системы. У вас есть несколько нод, клиенты подключаются к ним, и, соответственно, все это дело меняется. И у вас у этих нод, вот этот лог операций, должен быть консистентным. При этом ноды могут падать, терять там связь и так далее, тормозить дико и так далее, и тому подобное. Рафт решает, ну, наверное, большинство, я не буду утверждать, что все, проблемы тоже довольно хорошо, но его скоуп несравним абсолютно. Это как сравнить мотоцикл и грузовик, трейлер какой-нибудь. То есть, это не совсем одно и то же. Так вот, этот пейпер показывает вам эволюцию концепции алгоритмов, начиная с Two-Phase Commit, который, ну, просто, грубо говоря, координатор говорит всем нодам, ребята, вы готовы за коммит? Да. А потом мы говорим, все, коммичим. У этого есть определенная проблема, а именно, если после первого раунда координатор падает, то остальные ноды, как бы, все, у них задумка. У них дедлог. Поэтому умные люди подумали, сделали Three-Phase Commit, который работает по принципу спанчбоба. Он говорит там, ребята, вы готовы за коммитить? Те говорят, да. Точно готовы за коммитить? Я вас не слышу. Те говорят, да. Ну, тогда коммитим. То есть добавив одну стадию, они решили вот эту конкретную проблему. Но они не решили все. Потом появился Paxos, потом... Я не помню, кто появился раньше, Paxos или ViewStamped Replication, Barbara Liskov, которые редко почему-то упоминаются. Они одновременно появились. Да, в районе, наверное, на границе 80-90-х, а может даже нет, в 80-е. Короче говоря, Raft скорее похож на ViewStamped Replication до такой степени, что, во-первых, они одну проблему решают, ну плюс-минус. Во-вторых, если вы прочитаете первую страницу 2 и там, и там, вы подумаете, что это практически один пейпер. То есть они описывают практически идентичную проблему и примерно одинаковый набор решений. Да, и что поразительно, ViewStamped Replication долгое время оставался в тени. При том, что все носились с Paxos туда-сюда, а ViewStamped Replication имел достаточно хорошо описанный подход и мог решать многие проблемы, вокруг которых носились в Paxos, и потом, пока люди не сделали Raft, все носились с Paxos и пытались его куда-нибудь себе пристроить, как вот мартышка с очками. Да, и справедливости ради ViewStamped Replication меньше, проще. Я видел ирландковую реализацию, которая что-то в 220 шильстров укладывала с пробелами и комментариями. И я считаю, что опять же, не то чтобы Paxos не имеет места, он живет он себе в Кассандре прекрасно, живет в ReaCaMultipaxos. Это вариация Paxos, которая как раз лог событий вам делает консистент. Подожди, в ReaCa не Multipaxos? Там не совсем так. В ReaCaMultipaxos. Нет, я же его читал. Я читал этот код, там не Multipaxos. ReaConsamble? Да. Я потом там шепелил. Да, там не Multipaxos. Они где-то в какой-то момент писали, что это Multipaxos. Я не читал его сильно, но окей. Скажем так, там есть что-то похожее на Multipaxos, но это настолько самобытное решение, что я бы его не классифицировал, не как один из существующих Paxos'ов. Да, окей, я согласен. Вот самая большая проблема Paxos'а, что есть такое количество вариаций, диалектов, модификаций и так далее, что прежде чем вы решите, о каком Paxos'е речь, будет полезно обсуждать что-либо еще. Ну, суть в том, что тем не менее, Paxos'е есть свое применение. У Cassandra, я так понимаю, Per Operation исключительно Paxos, да? Внутри Lightweight Transactions они это называют. Ну, тут у React примерно так же, на самом деле. С точки зрения клиента, да. Просто я про реализацию. Я так понимаю, что в Cassandra Paxos такой, ближе к ванильному. Да, он ближе к ванильному, а в React они сделали так, чтобы... Там есть стабильный лидер у каждого ансамбля. То есть там по сути, каждая группа из трех... То есть у нас весь кластер разбит на какое-то количество винот. Да, да. И для каждого ключа, вот все возможные... Не все возможные тройки, а как это... Вот начиная с нулевой, заканчивая, допустим, 16, если у нас 16 винот, хотя их обычно больше, у нас там есть тройка 0,1,2,3, дальше тройка 1,2,3, дальше тройка 2,3,4 и так далее. На каждую такую тройку у нас свой ансамбль с своим лидером. Лидер выбирается по принципу Multipaxos, но при этом, в отличие от Multipaxos, там никакого лога нет. То есть у нас просто есть эпоха, которая сигнализирует о том, что у нас стабильный лидер такой-то эпохи. Внутри эпохи у каждого ключа существует независимое значение, и они договариваются... То есть происходит вместо классического Multipaxos, где пытаются договориться о логе, там просто договариваются об отдельном значении каждого ключа. Это уже не Multipaxos, потому что Multipaxos об одном логе, а здесь вроде бы стабильный лидер на весь ансамбль. При этом они договариваются о каких-то совершенно разных независимых ячейках, в которых нет никакого хронологического порядка, и просто у каждой ячейки есть своя история, которой потом сама история не хранится, просто договариваются о наиболее недавнем значении этого значения. Сами ансамбли, между собой, они архитектируются отдельным рутовым ансамблем, который... Это вообще уже кивок в сторону так называемого вертикальной Paxos, когда изменение в членстве одного Paxos менеджируется другим Paxos. Это работает, насколько я понимаю, несколько шустрее, чем в Cassandra, и это можно использовать в более широком круге ситуаций, но это добавляет не иллюзорные сложности. Да, и тут нужно понимать, что и то IRIA, как и Cassandra, это Dynamo, такие inspired системы, которые имеют вполне определенный набор, ну, как сказать, ожиданий от клиента, во-первых, а во-вторых, проблем, которые они очень сознательно отдают наутку приложению. Ну, то есть, consistency — это одна из них, и да, есть решение этого всего, абсолютно прекраснейший во многих смыслах дизайн у Dynamo, но когда вы пытаетесь прикрутить один набор алгоритмов, а Dynamo — это именно набор алгоритмов, с алгоритмом вроде Paxos, как бы у вас порой вы вынуждены отходить от оригинального пейпера. Да, ну в общем, я считаю, что иметь историческую перспективу — это очень-очень полезно в таких вещах, и учитывая, что вот когда я слушал про Reconsemble, некоторые идеи из этого всего, ну просто вот... Я не хочу сказать, что они были содраны из Raft'а, но они очень-очень близки к Raft'у, да и ViewStamp replication, я считаю. На самом деле там же история в том, что пока Gtuple, как его, Джозеф Бломстедт, писал Reconsemble, как раз за это время Diego Angara защитился, и в принципе в какой-то момент там даже... В одном из докладов, по-моему, даже Джозеф говорит, что конкретно это место мы посмотрели на Raft'а, поняли, что в Raft'е сделано понятнее, чем у нас, и просто реализацию сменили на более похожую на Raft. Что касается Join.com... Чтобы понимали, Джозеф это Джозеф Бломстедт, это человек, который разработал Reconsemble, пока не ушёл из башни. Хорошо, я думаю, что есть смысл двигаться дальше. Спасибо большое за дискуссию, кстати. Всегда спасибо. А дальше у нас идёт тема про... про лютый пиздец, простите. Я думаю, Саша добавил. Да, боюсь, это был снова я. Я, кстати, читала эту заметку. Здесь говорится про Inkscape, который векторный редактор на Nix-системах, да и на Windows тоже, и про то, как PVS Studio его анализирует. Но это они в преддверии релиза Linux-версии и PVS Studio анализирует разные Linux-проекты. И тут дичайшие баги. Я даже уже точно не помню, какие, но то есть... Один из запомнившихся багов – это инициализация матрицы.",
    "result": {
      "query": "Paxos vs Raft comparison"
    }
  }
]