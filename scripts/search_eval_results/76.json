[
  {
    "segment_id": "1f1083b6-d0dd-471c-bc58-30c2c8fe94de",
    "episode_id": "1edcb517-81bb-4871-b6ad-26ed8c901af1",
    "episode_number": 76,
    "segment_number": 15,
    "text": "И будет интересно, как все это выльется. Следующая тема? Следующая тема у нас про транзакции, про интересные и быстрые. Тема называется no compromises, так прям paper называется. Он про транзакции, которые и быстрые, и сериализуемые, и упираются вообще не в сетку и диск, а в CPU. Мне Саша эту тему подкинул с вопросом, а как они вообще этого добились? Что там такого, в чем подстава? На самом деле подстава в том, что система называется farm, и она работает по поверхности системы, которая называется farm. Что такое система farm? Это такой исследовательский проект Microsoft Research, где ребята взяли и собрали кластеры, такие кластеры будут у фейсбука, может быть, послезавтра. Ребята рассчитывают на то, что у нас либо очень много памяти, и к ней ко всей прицепили UPS, то есть бесперебойники. Либо что у нас вообще non-volatile memory, которое после выключения питания держит данные. Во-вторых, у них нет сети, у них есть RDMA через InfiniBand. Это тоже такая штука, которая, ну вот, ребят, кто из вас вообще видел RDMA реально в кластере? Я видел один раз, честно, в жизни. Я даже не знаю, о чем речь. Это когда у тебя машина может пойти, вот я машина, я могу пойти и сказать, эй, но да, вон та соседняя, дай мне пожалуйста данные, которые у тебя там по такому-то адресу в памяти лежат. И тебя другая машина послужит даже не CPU, а вот прям network controller на той машине. Я про такое слышала, опять же, это в онлайн рекламе, но у нас такого нет. Ну вот, то есть ребята рассчитывают вот на такое. Я на самом деле как бы обычно, когда я какой-то пейпер читаю, я обычно сделаю его обозревание. Я сразу скажу, что я пейпер даже не пошел читать, а просто обозрительную статью прочитал. И я не буду вдаваться в детали, потому что ребята делают вещи типа там пятифазный коммит. При том в пейпере я его полистал, я особо доказательства не нашел. То есть может он там есть, но просто обычно доказательства выделяют в отдельные блочки. Я его не нашел там. То есть возможно там нет даже такого доказательства, но он вроде как работает. В целом мне это по дизайну напомнило какую-то смесь CarFu с чем-то еще каким-то аддом. Основная идея в том, что мы берем и у нас координатор пишет в памяти просто всем там слайбам сразу. Потом от слайбов реально ждет. Потом слайбы такие опа, мне-то что-то в память написали. Шлют обратно подтверждение и вот так делается пять фаз такого вот странного туда-сюда гоняния данных. Фаз пять, но они все очень быстрые, потому что это RDMA и потому что это память. Транзакционный лог, что характерно тоже в памяти. Как они от сбоев восстанавливаются, это отдельная тема. Есть такая штука лидер-релиз. И лидер-релиз он требует, чтобы у нас был где-то таймер. Когда у нас лидер по таймеру понял, что он больше не лидер, он бы отвалился. Понятное дело, что если мы общаемся напрямую с никами другими, то он нам ничего особо не будет лидер-релиза держать. Он такого не умеет и едва ли научится. Он и так уже слишком много умеет. Поэтому не то чтобы лидер-релиз, если я правильно понял, мы говорим, что это похоже на вертикальный факсис. Или даже не вертикальный, не помню, как это называлось. Слушай, я не помню, как этот подход факси называется. Там факсы тоже есть такая вариация, когда мы говорим, что следующие пять транзакций, короче, вот этот чувак главный. Если он там отвалится, то у нас новый главный кто придет, он просто их забьет нопами. А вот в эти пять транзакций никто гарантированно другой записать не может. Ничего смысленного. И вот с этой стороны лиза идут по адресам памяти. И когда у нас система, которая координирует все это безобразие, там примерно такая же архитектура, как Слава рассказывала. Есть зоокипер, но вокруг него сидят какие-то ребята-мониторщики. Репликация просто внутри всей этой петрушки мастер слайф. Когда мониторщики замечают, что кто-то куда-то отвалился, они соображают, кто теперь должен быть мастером. И потом начинается протокол восстановления. И дальше просто, что если мастер в своих слотах, которые ему были выделены, не успел на всех-всех-всех реплицировать. И там довольно замороченный протокол восстановления. То в итоге через 60 миллисекунд примерно система придет в консистентное состояние. Но 60 миллисекунд для восстановления это довольно офигенно быстро. И в нормальном штатном режиме система просто резко, как ощущение боль в животе. Но там, грубо говоря, у них транзакции за какие-то миллисекунды отрабатывают. Ой, сой, сой, за микросекунды. Но опять-таки вся эта классная, офигенная штука, которая упирается в ЦПУ и сериализацию, она на железе, которое у нас будет, дай бог, там послезавтра у Фейсбука. То есть, ну в общем, нам это в ближайшем будущем не светит, к сожалению или к счастью. Такие дела. Забавно. А что еще забавно? Звучит фантастически, ты знаешь. Слав, есть какие-нибудь мысли по этому поводу? Нет, я вообще в последнее время, я где-то, наверное, 3 месяца работаю над этим проектом, о котором мы сейчас говорили, доступ базы данных из браузера. И мы очень сильно стараемся его выпустить как можно быстро, поэтому я за последние 3 месяца вообще ничего не читал, не делал, ничем не занимался, только вот этим. Поэтому на это мне добавить немножко тяжело. Нет, ну ты же все-таки на рынке баз данных. Я сейчас оценил, что такое железо послезавтра будет у Фейсбука. Может быть, я дико неправ и дурак. Сейчас вот все бегают в Слотно на volatile с Storage. Нет, ну это вопрос в том, как оно все работает на практике. Вот я когда слышу про такие все новые технологии, всегда у меня возникает вопрос, как оно будет на практике и когда оно попадет на рынок. И я стараюсь мнения об этом не создавать, пока я действительно глубоко так не посмотрю на это все. И не пойму, как оно работает. Ну так, звучит, конечно, фантастически, но нужно про это много почитать, я просто не читал еще. Мне лично кажется, есть некая еще специфика того, кто использует базу данных. То есть вот в прошлом выпуске Федор, если я не ошибаюсь, говорил, что там пользователи с 250 ядрами обычное дело. Я думаю, у Slav вы пользователи немного иные, они по-другому строят системы просто. У нас пользователи обычно используют комадити, такие машины, которые можно купить или можно запустить в квалд сервисах. То есть почти все, ну может не почти все, но наверное 50% пользователей сейчас на Амазоне, на EC2. И все, что на EC2, примерно они на этом все запускают. И scale у них горизонтальный, то есть добавляют все больше серверов. Такого кастом-хардвера почти никто не использует. Светлана? А что еще редко используется, это property-based-тесты.",
    "result": {
      "query": "фарм транзакционная система Microsoft"
    }
  }
]