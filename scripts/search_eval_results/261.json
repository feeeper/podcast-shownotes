[
  {
    "segment_id": "6e089b08-2423-49bd-8c00-cbc993ef08af",
    "episode_id": "e8e19618-fbac-4ff1-b61b-4eff5cd47d71",
    "episode_number": 261,
    "segment_number": 4,
    "text": "них линковка гораздо проще и быстрее, чем, опять же, могла быть LWB, но чисто за счёт того, что нет использования сих линков. Ну и плюс там некоторые знания, в том числе о языке, например, если все объектные файлы, которые вместе линкуются, не используют рефлексию, то можно там кучу всего другого выкидывать, чтобы на рэкет не было. А если где-то используется рефлексия, то там используется JSON, который использует рефлексию, то, соответственно, это выкидывать нельзя. Такое знание, как бы, в общий линкер нужно будет как-то отдельно утрамбовывать, и, как бы, на него очень хорошо работает. В общем, дальше в статье идут графики потребления памяти линкером, скорость его работы и так далее, но основное наблюдение то, что со временем, как Go развивается и развивается, как линкер и оперативно развивается, активно развивается, скорость активно развивается, линкер развивается медленнее всего и постепенно-постепенно он, по сути, стал ботлнэппингом. На самом деле, это очень хорошо заметно, если вы собираете программу хотя бы среднего размера, то компиляция активно параллелится, все быстро собирается, активно используется кэш компиляции, в линкере ничего такого нет. При этом, если ваша программа собирает несколько объектников, она пару секунд может линковаться. Если там есть сегой, это сейчас еще более долго, к сожалению. И, значит, профилирование провели, посмотрели, какие основные проблемы. Основные проблемы это высокое обеспечивание памяти из-за неэффективности структуры памяти, когда и там основные таблицы символов занимают больше места, чем хотелось бы. То, что объектный формат, Go объектный формат, о котором мы сейчас так говорили долго, он последовательный, в нем, в частности, нет особой поддержки для развивального чтения по оффсету, ну и мейнтейминс, о чем уже тоже сказали. Значит, какие планы на более хорошие линкеры? Во-первых, сдвинуть больше работы в компилятор. Компилятор может делать параллельно, компилятор может эффективно кэшировать. Чем больше будет делать компилятор, тем лучше будет для всех. Избегание строк в линкере, в структуре линкера, вместо того, чтобы использовать строки, будут использовать числовые индексы, я понимаю, и хитрые алгоритмы для дубликации этих символов. И как минимум загружать данных в память. Самая причина проблем в текущем линкере, то, что он загружает кучу всех данных в память и удерживает их. Как следствие, потребление памяти увеличивается, большая количество будет тратиться на уборку мусора и так далее. Дальше подробно описывается изменение символьной таблицы, как будут использоваться индексы и так далее. Ну, я не знаю, это наверное наименее интересная часть. Если кто-то хочет рассказать, то вопрос. Можно вопрос? Давай. Здесь рассказывается про какие-то linked-named символы и duploc символы. Можешь про это немножко рассказать? Ну, duploc я могу предположить исключительно, что это те символы, дубликаты которых могут быть, но надо тут читать, что имеется в виду, и так сходить и не скрыжать. Linked-named это такая возможность, когда вы пишете, ну, это для супер-супер специальных возможностей, и обычно такой не нужно, но можно переопределить имя символа, когда там пишется какая-то функция без тела, например, сверху пишется магический документальный linked-name. И считается, что этот символ есть в каком-то другом файле, и линковщик должен это найти. Обычно это используется для тех, кто оптимизации внутри рантайма, внутри сайта библиотеки, в целом это можно использовать в своем коде, но это конечно довольно такой хрупкий механизм. Можно использовать в центре того, чтобы на самом деле эту функцию написать или еще что-нибудь. Я тем временем погуглил про GO-плагины и не могу быстро найти информацию о том, что их деприкейтили, поэтому может быть мне это приснилось, это был очень хороший сон, но, к сожалению, пока их не деприкейтили, но для справки там все еще очень печально, то есть этот код, если вы используете GO-плагины, то этот код будет непереносимым, потому что под Windows-поддержки все еще нет, они невыгружаемые, там возникают всякие истории типа, что если ты пересобрал свое приложение, то оно не может загрузить GO-плагины, потому что они были собраны типа чуть-чуть с другими зависимости, или что-то такое, и в общем GO-плагины — это вот прям реально путь боли, поэтому я никому не рекомендую, мы на проекте их одно время использовали, сейчас поапелливали, где только можно, и мы живем более счастливо. Не используйте GO-плагины ни для чего никогда. Ну да, основная проблема с ним в том, что они довольно хрупкие, и получается, что их тоже мало кто может поддержать, то есть там была попытка хистокомьюнити сделать на Windows-поддержку, но просто нужно очень специализироваться на знаниях, то есть с одной стороны глубокие знания Windows, а с другой стороны глубокое знание блокчейна GO, в том числе линкера. Допрещение оказалось очень небольшим, мы не смогли источить. Из других вещей, которые хотят в новом линкере оптимизировать, это использовать новый DWARF-формат, к слову, просто стандартный формат, там сейчас используются старые DWARF относительно, новый DWARF позволяет добавлять кучу нужных интересных вещей, типа там position independent кодирование сим, и так далее, но опять же, я так понимаю, в основном это для дебага нужно в первую очередь, но всем будет хорошо и тепло. И соответственно, как можно больше работы делать конкурентов в новом линкере, и как можно больше вернуть их в компьютер. И дальше есть самый для меня лично интересный раздел, это типа, что мы будем делать дальше, после того, как этот линкер перепишем, какие могут быть следующие теоретические шаги. Они в частности предлагают, что бинарный код на GO должен иметь возможность напрямую загрузить гошный объектный файл, работающий по дому, и запустить его. Как раз как замена плагином, да, то есть с одной стороны это позволяет вам использовать, ну например, если вы делаете интерпретатор на GO какой-нибудь, то можете загрузить исходный код на GO, по сути, да, вызвать толчейнс, сделать объектный файл, загрузить его в память, как альтернатива плагину. Или можно использовать для джита, когда вы какой-нибудь кусочек своей программы интерпретатуры запускали, с несколькими раз увидели, что можно его джитить, изменили, допустим, гошный код, копировали, опять же, загрузили в память, без остановки, без перезагрузки, как альтернатива плагину. А другая идея, для чего это может пригодиться, это для тестирования быстрого, когда вы, у вас есть уже некий работающий процесс, вы не перезапускаете целиком весь процесс, не загружаете весь образ памяти, вы перекомпилировали пакет, перекомпилировали тесты, загрузили в этот объектный файл и запустили тесты. Это просто будет такое ускорение. Вот. Конечно, вот эта вот идея, как замена плагином, для меня, наверное, наиболее интересная, и для Саши тоже.",
    "result": {
      "query": "Go linker performance issues"
    }
  }
]