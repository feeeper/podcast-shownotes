[
  {
    "segment_id": "d24d64eb-8585-4804-a6c0-55570ec807a3",
    "episode_id": "15f7933a-ac2f-4b39-af5f-8e5dc39ac1a8",
    "episode_number": 467,
    "segment_number": 5,
    "text": "Это натуральный гипервизор. То есть, вот с чего они начали, это гипервизор. Что такое гипервизор? Ну, это, я думаю, это, я думаю, Саша с Ваней имеют представление, но вот я, короче, когда вот я эту статью читал, я такой, как бы, я вроде тоже имею представление. Но это кубернетес, да? Вот нет. Как бы гипервизор, это же не кубернетес. Это даже не вот, то есть, это вполне конкретный слой в стеке. То есть, это не какая-то, вот у нас есть, вот мы привыкли к тому, что есть виртуальные машины. Вот где вот этот вот гипервизор, вот он где? А вот он, как бы, вот этот вот тот кусок кода, который сидит между вашей гостевой операционной системой и вашей хостовой операционной системой. И он, может, немножко прочно будет устроен в зависимости оттого... Да, да. Во-первых, для начала у вас вообще не обязана быть, не гипервизор в общем случае не обязан запускаться на хостовой системе. То, что запускается поверх какой-то хостовой системы, называется гипервизор второго типа. В далёкие, стародавние времена у нас были мейнфреймы, где не было никакой хостовой системы, а там просто был гипервизор, на котором уже запускалось всякое разное. не тебе этот будильник. Вот. Но в данном случае мы говорим про гипервизоры второго типа. У нас есть хостовая операционная система, у нас есть какой-то кусок кода, который сидит между хостом и гостевой системой. Есть гостевая система. Дальше вот этот кусок, он может быть немножко по-разному устроен. У нас может быть паравертуализация, когда гостевая система специальным образом адаптирована, чтобы вместо того, чтобы, не знаю, в какой-то I.O. лезть, она будет вызывать какой-то функционал гипервизора. То есть на уровне I.O. должна быть адаптирована, видимо. Не знаю, я никогда не писал гипервизор. Я очень имею абстрактное представление, грубо говоря, Википедию прочитал. Еще пару статей, прежде чем выпуск идти. Есть, так скажем, аппаратно-ускоренный, аппаратно... аппаратно-ассистированный гипервизор, когда у вас ваше железо целевое, то есть, например, в данном случае процессор Intel или процессор AMD, они имеют набор инструкций, которые позволяют писать гипервизоры. И это, на сегодняшний день, несколько разных наборов инструкций, каждый из которых какие-то наборы инструкций отвечают за то, чтобы ваш гипервизор управлял страницами памяти, отдельный набор инструкций для того, чтобы там хорошо и эффективно I.O. всякое виртуализировать и так далее. И есть еще функции для того, что если в гостевой системе все-таки нужно взаимодействовать с гипервизором, если гостевая система знает, что она в гипервизоре, например, у вас какой-то драйвер, который, не знаю, драйвер-дисплей для того, чтобы запускаться в гипервизоре, там, для того, чтобы, типа, ваша, там, не знаю, изменяете размер окошка, у вас там динамически изменялась ваш, как бы, размер вашего рабочего стола в госте, ну, то есть это явно требует какого-то общения с гипервизором. Соответственно, у вас есть вызов, по-моему, EM-Call называется, который позволяет из гостевой системы прям позвать, сделать кастомный вызов в гипервизор. Вот. Мы определились с тем, что вы гипервизор, да? Ну, я повторю своими словами, а ты скажешь правильно, я все понял. То есть у нас в процессорах есть некий API-дроп-набор инструкций, изначально сделанный для KVM, Xen, вот этих вот штук. Вот Xen как раз-таки нет. Xen, ну, он же про виртуализацию, по-моему, во всяком случае, исторически был провиртуализированным. Хорошо, хорошо. Но смысл в том, чтобы у тебя виртуал, чтобы ты запускал виртуалки, они работали быстрее. Вот для этого изначально создавался этот API, но ты можешь его, я так предвижу по контексту, что ты можешь сделать такой гипервизор, который исполняет код детерминированно. Да. За основу был взят Behive, FreeBSD-шный, и из него было выкинуто все, что было можно выкинуть, и после этого они из него делали постепенно детерминированный гипервизор. Я не хочу пересказывать прям всю статью, потому что там много всего, если интересно, почитайте, плюс там есть какой-то видосик, где они там при помощи своего детерминированного гипервизора Mario проходят. Я его сейчас до конца не посмотрел. Отошлю вас туда. Я хочу просто перечислить какие-то такие, не знаю, вещи, которые мне показались интересными, и заодно поговорить про то, как таким вообще предполагается пользоваться. Вот. Это гипервизор действительно детерминированный, и то есть самое главное, что он делает, это, если у вас был какой-то прогон теста, который нашел баг, всегда этот баг можете найти, потому что он сможет точно так же, вот типа вот точно так же сможет прогнать. Они, например, время, они не дают вам настоящего времени, они его вычисляют хитрым образом на основе того, сколько инструкций выполнил ЦПУ, при том, даже с этим им пришлось намучиться, потому что со временем к ЦПУ нельзя надежно, можно спросить, сколько инструкций он выполнил. Они в раз иногда имеют свойство, типа, ошибаться, не точно считать, потому что все эти каунтеры — это перформанс, каунтеры, они никогда не были рассчитаны на точную точность. Во-вторых, оно умеет, очевидно, как бы все I.O. перехватывать, и тоже, типа, перешедуливать его. Чтобы уточнить, если у меня две виртуалки, я так понимаю, речь идет о виртуалках, которые, собственно, обмениваются. Они виртуалками с собой никогда не обмениваются по сети. Виртуалка никуда за пределы себя не может сходить недетерминированно. То есть я не могу... Я тебе поговорю, я к этому не приду. Хорошо, хорошо. Ну, потому что это основной юзкейс для Джобсин тестов. Да, я понимаю. Вот. И еще оно может манипулировать шедулером гостевой системы, и, собственно, и для I.O., и для, собственно, манипуляции шедулером гостевой системы происходит через fault injection. Ну, то есть, типа, это же может происходить с диском, потому что диск тоже I.O. То есть в любой точке, где у вас может произойти какой-то недетерминизм, он произойдет, но он произойдет контролируемо, и эта точка будет запомнена. Можно сразу вопрос? Какой пенальти по перформансу? Неизвестно. Я как бы очевидно... Очевидным образом я это не нашел, но он есть. Принимается. Вот. Но он мантигируется интересным способом, опять же, дальше будет сказано. Возвращаясь, да, постепенно приближаясь к тому, как это работает с много чем, да, вся эта история, она работает строго на одном ядре. Она прям, вот, скажем так, один экземпляр такой виртуалки, она привита к одному ядру, все переключение тредов и так далее, и весь этот fault injection, чтобы треды разным переключать, входит на одном ядре, и там детерминированность под того, какая инструкция за какой выполняется, и, соответственно, если есть какой-то детерминизм, можно проверить в случае, ну, как бы, если это покажется интересно, обе ветви. Вот. Как в такой... Ладно, я даже перейду к сети потом. И вот тут при перебирании ветвей, это то, где мы получаем перформансы с другого места. Они многоядерность используют не для того, чтобы многоядер симулировать внутри одного, но для того, чтобы по-другому выполнять все эти ветви. И, конечно, если они не будут выполнены, то они будут выполнены по путевыполнению. Это один путевыполнение всегда будет одним цепью перебираться. Точнее, не перебираться, а продолжаться. Вот как раз таки, если появляются какие-то интересные ветви, они как раз могут быть запущены в параллель, и как бы можно в параллели исследовать вот как раз таки пространство вариантов. Но каждый вариант будет детерминированно идти по какому-то пути, и детерминизм потом будет откладываться в какой-то... хранение того, какие состояния они прошли, они это как бы пока не раз как-то сделано, но она какая-то у них есть. И они могут... То есть, грубо говоря, есть какая-то очередь, они туда складывают все точки, в которых можно принимать разные решения. Да, да, да. И, соответственно, потом идут по всем этим очередям в эту сторону. Ну, я вот... Я так понимаю, не по всем, а по интересным. Опять же, про интерес, он может быть даже test-driven, то есть твой тест может говорить, что интересно, что нет. Или он может быть... То есть один из вариантов, который... Я сейчас прыгаю сильно вперед своего конспекта. В общем, у них есть такие варианты. У них есть, например, coverage-driven исследования. То есть, если ваш тест может репортить внутрь... Этому гипервизору coverage, то они могут на основе coverage исследовать эту историю. Ну, логично. Да. Я бы тоже так сделал. Опять же, соответственно, random тоже как бы... Они... Они в ваших тестах, которые в вашей тестовой сети, они предлагают использовать их random библиотечный, который как раз-таки будет тоже специальным образом манипулироваться системой. Да. И там также вы там в своих тестах можете говорить, типа, вот это... Там, по-моему, как раз-таки... Ты как раз там говорил про эти likely и unlikely вещи. Вот это как раз они тоже используют, по-моему, для того, чтобы принимать решения, что интереснее исследовать. Вот. Ну и, собственно, IO и вообще любые обращения к гипервизору считаются хорошими кандидатами для ветвления по умолчанию. Да. Теперь, собственно, как использовать... Как использовать... Как использовать... Как исследовать сеть, как сделать детерминированную сеть и так далее? У нас есть виртуалка. Она полностью детерминированная и живет на одном ядре. Но на виртуалке мы можем запустить контейнеры. И вот, короче, мы берем всю нашу сетевую систему, разворачиваем ее в контейнерах в этой детерминированной виртуалке, и она там полностью шаг за шагом детерминирована на одном процессоре. И, собственно, она как-то вот чух-чухает в направлении. Красиво. Вот. И, собственно, вместе с их гипервизором, я уже немножко на это, так скажем, подсветил, есть набор библиотек донецких языков. У них примеры, если я не ошибаюсь, на Go. Я полагаю, есть и для других вещей. У них, собственно, да. У них, собственно, да. У них, собственно, да. У них там есть рекомендации, как писать эти тесты, как их писать так, чтобы система перебирала какие-то более интересные случаи. Я так понимаю, что там в сторону JEPS они там тоже делают кивки, хотя напрямую это не называют, я думаю, потому что бы не иметь никаких случайных конфликтов. Вот. Но они также говорят, что некоторые кастомеры просто свою тестовую сьюиту запускают уже, как будто у них есть тестовая сьюита под их системой, и уже имеют очень хорошие результаты. То есть, опять же, если у вас уже был какой-то JEPS похожий, JEPS-нообразный какой-то набор тестов, очень может быть, что вам его может быть адаптировать довольно несложно, или даже не потребуется его дополнительно адаптировать, чтобы уже начать получать бенефит. Это просто от того, что у них есть возможность ваш какой-то сильно рандомизированный end-to-end тест надежно воспроизвести и надежно найти в нем места, которые с небольшой вероятностью бы стрельнули в реальной жизни. Вот. Еще у них есть... Еще у них из интересного есть свои ассерты, которые тоже, по-моему, да, позволяют управлять поиском интересного. И у них есть time-travel debugging, что вообще как бы... Я не видел, как им пользоваться, но вот в вашем детерминированном, короче, вот, супе из множества линий истории где-то нашлась бага, и вы можете это потом типа открутить в дебаггере и посмотреть, как эта бага случилась. Это просто охренеть как круто. В статье, к сожалению, нет ничего ни про то, как это сделано, ни про то, как этим пользоваться. Но эта фича заявлена. Как-то так. Теперь я чувствую, как бы, баланс в мире восстановлен. Подведем итог. То есть как бы... Да, можно, я хочу уточнить еще вопрос. У меня есть Jepson тесты, написанные на питоне с докером, которые иногда падают, но не детерминированы. Я беру антитезис, запускаю на нем вот эту его виртуалку, и в нем запускаю свои докер-контейнеры со своими Jepson тестами на питоне, и получаю тот же результат, но медленно и детерминированно. Это правильно? Да, если ты начнешь... Как бы у тебя самая первая будет задача научиться говорить антитези, что вот это падение, и она начнет как бы пытаться уметь это триггерить, а потом я бы второй, что бы сделал, это, наверное, код кавердж как-то скормил, чтобы оно с минимальными усилиями с твоей стороны пыталось найти куски кода, в которые твой Jepson еще пока не дошел, и триггерить твой Jepson так, чтобы он более вероятно туда зашел. И третье, что бы я делал, это как раз-таки уже брал бы все их остальные best practices, и, возможно, немножечко подкручивал бы вот этот тонячий Jepson, чтобы вызывать их рандомы, их ассерты и так далее. А чтобы уточнить... Что у них по лицензии и по деньгам? По лицензии это полностью проприетарный сервис, в который ты загружаешь свои контейнеры. По деньгам минималка что-то порядка 7000 килодолларов в год. 7000 килодолларов? Да, в год. Это прям минимальный-минимальный... Это 7000 килодолларов, это 7 миллионов. Сорри, я сказал тысячки, просто 7000 долларов. Это самое минимальное, что их можно, по-моему, зарезервировать. Это тебе даст, по-моему... Короче, какое-то количество... Они тарифицируют по как бы... Да, короче, 7000 долларов в год — это одно CPU-ядро, типа, зарезервировано на весь год. Вот одно CPU-ядро, которое будет просто крутить вот эту штуку. Очевидно, ты не хочешь одно CPU-ядро, то есть, скорее всего, 7000 долларов в год, скорее всего, бесконечно медленно. А для тебя... Ты, скорее всего, захочешь заплатить... Захочешь заплатить, ну, как минимум, не знаю, 70 тысяч долларов в год, чтобы это было реально полезно. А трайл есть? Сейчас вот... Ну, как бы... У них вообще нет сейчас селл-сервиса никакого. Ты можешь только нажать Let's Talk. Я уверен, что тебе дадут трайл, потому что, ну, как бы так всегда продажи работают. И тебе даже, скорее всего, продлят. Ну, опять же, у меня нет опыта конкретной антитезы. У меня есть опыт наблюдения за тем, как некоторые другие софтверные решения покупались в компании. Не буду говорить кем, когда и куда. Но, в целом, я наблюдал этот процесс, по-моему, даже больше одного раза. Ты можешь попросить трайл. Ты можешь даже его несколько раз продлять. И говорить, ну, все еще, типа, в процессе оценки вашей штуки. И, как бы, со стороны компании, им же важно тебе продукт продать. Они не дадут тебе его бесконечно бесплатно использовать. Например, если они видят, что, скажем, ну, ты его на самом деле не используешь, потому что твои инженеры еще ничего не переписали, то они как раз, наоборот, будут замотивированы пытаться тебе как-то помочь и дать больше бесплатных корректировок. Чтобы ты свои тесты, на самом деле, наконец-то депортировал. И таки запустил и увидел какой-то результат. А вот потом, конечно, от тебя захотят денег. Ну, опять же, я не могу ничего говорить за антитезис, но вот какой-то такой мой опыт в целом. Ну, я понял. У меня вопросы закончились. Иван, как у тебя? То есть, единственное отличие от... мощное отличие, самое мощное отличие от всех предыдущих продуктов, которые мы обсуждали до этого, включая бюджет в сфере, это, конечно, не только продукты, которые мы используем, но и продукты, которые мы используем. Это детерминистичность при работе с любыми точками ветвления. То есть ты говоришь, я проверю всё, что можно проверить за счёт того, что я это буду складывать в очередь, запоминать все точки ветвления. Вот опять же, я не уверен, верно ли говорится слово «все». Ну, понятно. Хорошо. Какая это часть? Да, и второе, что ты вот когда-то нашёл ошибку, ты её всегда можешь также воспроизвести. Хорошо. С точки зрения того, как бы семантики мы поняли, с точки зрения синтаксиса, как это работает? С точки зрения синтаксиса? В смысле, ну как бы у тебя... В смысле, что ты пишешь? Ты пишешь... В простейшем случае ты засылаешь докер-контейнер, в котором всё просто как обычно, он просто каким-то образом сообщает, что что-то упало с ошибкой. Я плохо себе это представляю. У меня в простейшей базе всегда будет тысяча операций при запуске маленького юнит-теста. И эта тысяча операций всегда будет... ну, как бы в два в десятый, просто если у меня две точки улетления в каждой операции, там, в ту сторону или в эту сторону... Ещё раз, оно не будет пытаться... я не знаю, как оно работает по дефолту, прямо скажу, вот я не знаю. Я знаю, какие у них рекомендации. Одна из рекомендаций — сообщать код кавердж-информацию, генерировать код кавердж-информацию. Тогда они могут на савередже смотреть, куда ты пришёл, а куда ты ещё не пришёл. Это первое. Второе — у них очевидно есть точки ветвления, которые они просто по дефолту считают интересными. Например, AIO. Ну, мы вообще заинтересованы фактически только в AIO. Ну, не только. У тебя могут быть ситуации, когда тебе там интересно на рандоме ветвиться. Ну, я думаю, что на дон proclaim, на вызовах рандома они будут ветвиться, в любом случае. У тебя могут быть, у тебя как ты верно заметил , может быть, куча всяких вещей, которые можно воспринять как неп indispensабельчик. Ну, опять же, вполне попадаются на что-то предыдущиеái чего-то, кстати. Но я Espero, казалось,你在 вопрос. Чрезвычный вопрос, продолжаю ваш вопрос. которые, ну, можно воспринять как точку ветвления. Но интересные, на самом деле, такие, ну, не знаю, когда ты явно ходишь в диск, например. Задержки свое самые интересные. Ну и задержки свое тоже, да, и там с шедулингом и всем таким. То есть они, это будут пытаться как-то этим манипулировать, ну, то есть просто чем больше информации ты общаешься с системой о своей программе, тем точнее она сможет манипулировать таймлайном, чтобы находить более интересные проблемы в твоей системе. И вот, собственно, их библиотеки, они шипят, они, ну, просто нужны и вот код-кавер-инструменты нужны для того, чтобы смочь как-то интересно происследовать твой workload. Ну, звучит логично. Интересно, сколько занимает запуск тестов. То есть, как бы, вот у меня есть докер с юнит-тестом и интеграционным тестом, скорее всего, им более интересно. И вот я хочу его запустить. Что это значит? Я бы ожидал, что это дохренище время занимает, но опять же, типа, у меня нету каких-то тестов, таких данных. Есть видосик, где там они Mario гоняют по уровню. Вот, можно его посмотреть, но я его еще не успел посмотреть. А вот еще интересно, есть ли какие-то программы для open-source проектов? Например, я хочу тестировать Postgres. А было бы круто. Я думаю, что они в какой-то момент, наверное, то есть, они пока прямо совсем стартап-стартап. Еще такой исторический экскурс. Это ребята, которые раньше делали FoundationDB. И FoundationDB, когда они стартанули, они писали и у них был самодельный актерный фреймворк. И одна из фичей этого актерного фреймворка была такая, что они могли его запускать по-настоящему, могли его запускать в режиме симуляции. Этот режим симуляции у них был полностью детерминированный. И вокруг этого они накрутили свою систему тестирования. И они в какой-то момент у них было такое покрытие, что их тесты, их детерминированная симуляция исследовала все поведения, которые могли быть в системе. После этого ты можешь итерироваться с бешеной скоростью. И это им позволило базу данных развивать, так как они ее развивали. Делать какие-то интервьюальные оптимизации, все такое. И часть команды, которая над тем работала, после того, как Apple купила FoundationDB, они отпочковались и в какой-то момент решили, почему бы нам не сделать вот это вот, возможность тестировать что угодно, это была нашей суперсилой, давайте ее дадим всем. Но никто же не будет писать код на вот этом специальном фреймворке, поэтому они решили это сделать на другом уровне абстракции, на гораздо более низком уровне абстракции. Вот так родилась антитеза. Но это прям совсем ранний стартап. То есть я думаю, что опять же я не знаю их таймлайна. Кажется, про покупку FoundationDB и Apple мы говорили в районе 16-18 года. Соответственно, допустим, когда они там отпочковались, и скажем вот, сколько сейчас, 24-й год, ну, считай, 8 лет они там находились в каком-то таком вообще стелс-режиме, сейчас вышли из шкафа. Ну, 8 лет для стартапа, на самом деле, бесконечно долго, но, с другой стороны, они очень нетривиальную технологию строили, возможно, опять же, наверняка у них были какие-то, в стелс-режиме у них наверняка были какие-то клиенты более ранние, опять же, я не уверен, на счет 8 лет, может быть, там, я бы думал, что скорее 6. Вот, и вот они только-только вышли из шкафа и публично ищут клиентов. Возможно, если они, дай бог, станут более успешными, они в какой-то момент начнут такие программы прятать. Но надо полагать, что для них самих это очень недешево, потому что они же арендуют вместе у Амазона, и, я думаю, самое безболезненное для себя, что они могут сделать, это запускать его в open source по цене Амазона, ну, или там какого-то другого клауд-провайдера, на котором они это запускают. Они, очевидно, не могут это сделать дешевле, не в ущерб, не в ущерб своему, своим финансам, потому что это же не, как это, это не какая-то маленькая нагрузка, это прям очень много ресурсов съедает, им нужно будет прям очень много ресурсов подарить этому open source проекту. Я бы предполагал, что если бы я был этим стартапом, я бы, наверное, дал какой-то tier, который не имеет upcharge за их услуги. Это было бы интересно, наверное, но это было бы не бесплатно. Вот. Но пока у них нет даже self-service модели, нам пока рано говорить, чтобы open source сделать бесплатно. То есть open source tier бесплатный. А можно, ну, как бы, не в тему, отвлеченный занимательный факт? Конечно, конечно. Тут в фоне, ну, мы тут заговорили за Erlang, за Perl, и что-то в фоне я открыл в Википедию про Perl, мне было интересно посмотреть, что там в новых, в последних версиях. Я узнал две занимательные вещи. Во-первых, помните, был такой каталог сайтов Demos, да? Я никогда не слышал. Ну, Mozilla каталог, или как он назывался. Но, в общем, в свое время было два популярных каталога. Это Яндекс каталог и Demos. Demos, он такой, типа, интернациональный, да? И если ты занимался SEO-сайтами, то считалось очень важным добавлять сайтов в Demos, потому что это учит вас при ранжировании. Но неважно. В какой-то момент этот каталог закрылся, потому что люди уже не пользуются каталогами сайтов, а пользуются поисковыми системами. И я узнал, что, похоже, Demos, его фарканули, он теперь называется Curly, потому что там вот в статье про Perl, там была ссылка на раздел про Perl, насколько я помню, я уже закрыл вкладку.",
    "result": {
      "query": "Antithesis гипервизор обзор"
    }
  }
]