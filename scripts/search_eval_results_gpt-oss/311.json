[
  {
    "segment_id": "54529a1c-477a-408d-9bf1-f8d530996025",
    "episode_id": "17263604-a920-43e3-8132-c833998a2ce5",
    "episode_number": 311,
    "segment_number": 4,
    "text": "Итак, возвращаемся к CDC. Идея CDC в том, чтобы хранить не изменение событий в модели системы. То есть если рассмотреть, что у нас есть модель системы, и мы генерируем в ивентсорсинг, мы генерируем события в этой модели. То есть пользователь добавлен, я не знаю, покупка создана или еще что-нибудь. А в модели CDC мы вместо этого сохраняем те изменения в концепции базы данных, которые мы делаем с самой базой данных. И идея в том, чтобы давайте-ка мы придумаем, каким образом построить ивентсорсинг на основе той базы данных, которую мы сейчас используем. Ну, насколько я понял по этой статье и по соседним статьям, которые я читал, если я ошибаюсь, то придите, пожалуйста, поправьте. То есть у нас есть база данных, которая состоит из 100 миллионов таблиц. Мы создаем какую-то специальную транзакцию, которую мы сделали для того, чтобы внести изменения. Как раз покрывая вопросу Валеры, что транзакции нет, здесь вот у нас есть транзакции. И вместо того, чтобы создавать вот этот ивентсорсинг события, мы смотрим, что мы делаем, какие изменения мы делаем в базу данных. И вот это вот изменение в базу данных мы говорим, а теперь вот это становится событием в нашей очереди. Мы это кладем в нашу очередь, будь то Кавка или что угодно еще. И соответственно, те другие подписчики на это событие, если они имеют точно такое же состояние базы данных, как имела наша база данных до принятия этого действия пользователя, соответственно, вот это вот изменение базы данных они точно также смогут тебе применить. И таким образом мы получим распространение события по другим базам. Мы получим автоматическое масштабирование, потому что если у нас очередь масштабируется, мы можем добавить кучу подписчиков, и у нас появится автоматически куча пользователей. Куча баз данных, которые сможет обрабатывать пользователей. Вот это основная идея CDZ, насколько я ее понял. Соответственно, сверху они накручивают модель, которая называется Outbox Pattern, то есть шаблон Outbox, шаблон выходного ящика. Я не знаю, как его правильно перевести. Это шаблон, когда в одной транзакции сохраняется не только изменение состояния приложения, но также сохраняется и вот это вот событие в рамках домена, доменное событие в рамках вашей системы. То есть мы изменяем базу данных, но плюс одновременно мы изменяем, мы посылаем в этой же, в одной транзакции, мы сохраняем еще и пользователь создан, грубо говоря, вот это событие. И таким образом мы внутри одной транзакции сохраняем не только состояние системы, но и какие-то вот концептуальные сущности. Вы можете накрутить сверху кучу концептуальных сущностей, но вы сможете засунуть их в одну транзакцию. И это автоматически гарантирует вам меньшее количество головной боли, когда эта же самая транзакция как событие приходит в другую реплику вашей базы данных. И автоматически меняется и база данных, и автоматически загружаются все события, которые внутри той реплики хранятся, и соответственно подписчики не имеют головной боли в связи с транзакциями и событиями. На основе этого шаблона они строят все остальную логику, и они говорят, что эта идея более правильная, чем ивентсорсинг, потому что часть проблем ивентсорсинга решить практически невозможно для каких-то больших и сложных систем. Вот насчет этого я как раз хотел бы подспрашивать Свету. Во-первых, проблема, которую они описывают, это в том, что нельзя добиться никак строгой консистентности, и в тех доменных областях, в которых она нужна, ивентсорсинг не подходит, и секьюр С не подходит автоматически, в то время как CDC с вот этим outbox pattern он подходит. У меня такой вопрос, а как понять вообще вам нужна строгая консистентность или нет? У меня есть такое предположение, я бы сказал это гипотеза, что теоретически любую систему, в которой необходима строгая консистентность, можно с помощью большого количества клея, палок и скотча превратить в какую-то модель с эвентуальной асинхронностью, когда мы применяем ивентсорсинг и секьюр С.",
    "result": {
      "query": "CDC outbox pattern database consistency"
    }
  }
]