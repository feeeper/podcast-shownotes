[
  {
    "segment_id": "33e3edd9-498e-461e-91bc-491c5382669e",
    "episode_id": "7ca4c918-6d3c-4df6-96aa-b9d7d2474cae",
    "episode_number": 433,
    "segment_number": 4,
    "text": "Я правильно тебя представил? Да, типа того как раз. Я себя в шутке называю разноработчиком. Это моя такая тайная позиция. У меня самого, кстати, в блоге, вообще тема мониторинга, из-за нее я начала интересовать, когда я был еще стеновым администратором в одной небольшой конторе. И у меня тогда была просто задача перевести такого мониторинга, кажется, E-Sync 2 назывался. И там надо было включить с него графит, настроить это все и так далее. Графит тогда был таким местным промитусом так вот в плане того, как было строить свой метрик. И того, что это было написано в Python, работало медленно, диски жрало как не в себя. Такая была история. Да, ну, кстати, у меня сравнительно теплые воспоминания о том периоде, потому что я не любил в Python'ячий софт очень сильно. Но в чем ему было не отказать, так это в том, что если ты, короче, если у тебя есть упакованный аккуратно в Docker контейнер весь этот питонячий зоопарк, ты его запускаешь. И оно работает. Справедливости ради, Prometheus заставить работать, ну, то есть как, что это называется заставить работать? Заставить Prometheus показать нужные тебе графики, это немножко более сложная задача, чем была, чем она с Graphite'ом. Есть одно но. Prometheus заставляет тебе делать более корректные вещи. И заставит распираться на то, что ты смотришь. Есть и минус. Если нужно просто, короче, нарисовать линию, метрика у тебя не какая-то сложная, она простая, и у тебя, ну, маленький диплой на твоей, не знаю, домашней машине, то, к сожалению, Prometheus не предлагает прям простых решений. Я имею сообщить тебе страшное. Вот эта история с Graphite'ом, когда он был в тренде, это, примерно до 2015 года, Docker никто не использовал вообще. Это неправда, его никто не использовал в продакшене. Я повторюсь, я говорю про разработку на личной домашней машине. Докер, может быть, он не был известен, но, может быть, это был даже не Докер, я помню, что запускал контейнер с преднастроенной вот этой всей, всем этим зоопарком, я никогда не умел его настраивать, и просто поливал туда данные, и оно как-то худо-бедно ехало. Опять же, мне много было не нужно. Утверждение только в том, что, скорее всего, это был не Докер, мне так кажется. Ну, то есть, это прям древняя технология, это до Докера. А я думаю, стоит вернуться к игре. Так вот, да, ты заинтересовался Graphite'ом. Да, Graphite'ом, ну, что-то покопал и покопал, настроил и настроил, работал и работал. Потом я перешел к Graphite'е, к логам и так далее. Вот про логи это вот интересно, там вот есть ссылка, вот про где-то вот вы... есть статья такая, и с переводом на Хабре, там можно ее поискать, я недавно выходил, на Хабре перевод. Там в основном говорилось про метрики, но и тоже упоминались логи, в частности, вот эти уровни логирования, что вот, и меня это самого очень сильно импонирует, эта тема, потому что разработчики любят пихать всякие debug println и так далее в логи, и никто не заработается про импланты, про инфо, про ворнинги и так далее. То есть, есть у нас два мира. Debug и есть мир Error. И вот где какая-то межмерно-огомная пропасть, которую непонятно, как заполнить, чем заполнить и какие критерии. Вот такое упоминается в своей статье. Ну, так сказать, интересно, мне кажется, я всегда старался разделять так, что типа Error это то, что мы алертим, а все остальное это просто что-то, что... это контекст. То есть, мне обычно нужно два уровня, ну, три уровня. Error, Info и Debug, если Debug включен, если Debug выключен, не нужно. Ворнинг абсолютно бесполезная концепция, потому что что такое Ворнинг? Кажется, что-то пошло не так, но наверное, не стоит об этом алертить. Вот инфо. Нет, это особенная инфа, потому что вот допустим, вот не знаю, в той же ITCNG2 там есть в уровень Ворнинг как раз. Там вот есть там, ну, короче, есть разные методы возврата ошибок, ну, кода от проверки скриптов. И вот один из них это как раз Ворнинг, это то, что может не прийти тебе алерт, но это может вызвать какой-то даже вроде мониторинга, что вот обратите на это внимание, когда будете дряжить какой-то баг на поде. Это вот такое назначение. Ну, просто понимаешь, это такая история, которая... когда ты разработчик, тебе нужно заименовать какой-то лог, очень сложно угадать, что реально полезно, полезный Ворнинг. То есть ты очевидно знаешь, что что-то пошло не так, то есть есть неожиданная ситуация, которая ты... Ладно, да, есть неожиданная ситуация, от которой вообще нету возврата, это критикал, по сути. Есть неожиданная ситуация, которая не должна была произойти, почему-то произошла, это эрр. И ты, наверное, сейчас просто откатишься, там, не знаю, следующий запрос откатаешь просто, ну, на чистом состоянии. Что такое Ворнинг? Ну, то есть, вот как я как разработчик, вот что должно быть в моей голове, чтобы что-то залейблить Ворнингом? Откуда я знаю, что это Ворнинг? Я думаю, все очень сильно зависит от предложения, которое ты разрабатываешь, потому что в Postgres разница между Ворнингом и эррором, она тебе хорошо известна, я думаю. Например? Ворнинг сообщает об ошибке, эррор сообщает об ошибке и откатывает транзакцию. Ну, да, но к тому, что, смотри, эм... Вот я разработчик расширения, да? В какой случай я хочу Ворнинг кинуть вместо инфы? Почему это Ворнинг? Потому что, если ты посмотришь на... Я, кстати, не помню, какие по умолчанию, какой логовый пользователь, но, по-моему, по умолчанию нотис из твоей функции не будет показан вообще. Слушай, да, согласен. Ну, это, знаешь... Это то же самое, что и Ворнинг, кстати. Нотис — это инфа. То, что называется инфа. В Postgres — инфа и нотис одно и то же. Ну, если в Postgres нет инфы. Я просто к чему, типа, да, в Postgres у тебя прям просто дофига дебагурований. Если очень сильно дебагурований включать, у тебя там будет уже прям вещи, которые очень сильно в внутренности Postgres'а. Если ты пишешь расширение, наверное, действительно, инфа — это такой контекст, который, может быть, не всем нужен, а Ворнинг тебе действительно просто даже... Некоторые SQL-консоли, если произошел Ворнинг по дороге, могут тебе показать. Ладно, думаю, можно проехать обсуждение уровней. Мы в этом... Ну, это одна из проблем. Нет такой спецификации по уровням, нет никаких примеров. Это просто вот... Извините, пожалуйста, не буду говорить это слово. Ну, короче, на отстань. Отвались. Сделано. Потом я начал изучать, как это все сделано в стороне логирования, как раз еще по стимулу хранения. Когда я был сабмином, это все делалось просто вот лог-ротейтом, там у нас JSON-GZ логи, точнее, TAR-GZ логи, там или просто XZIP-пожатые логи Nginx'ы, скажем, и PHP-FPM'а. И что с ними делать дальше — непонятно. Вот какой-то сервер, что ли, хранить потом централизованно и так далее. Тогда еще не был распространен S3, тогда был распространен более-менее S3, но не в России, скажем. Не в все сабминские времена. В России, кстати, S3 все же был популярен, вот что. И он все еще сейчас используется, но проблема, мне кажется, у Elastic'а в том, что он же по умолчанию все индексирует. Это бысковая система. — Он очень прожорливый. — В том числе. Но меня вот больше заботило то, что он прожорливый — это как следствие того, что он пытается все индексировать через бысковую систему, а не систему хранения логов. Там даже есть вот ESO, его сейчас установить просто, и когда он будет хранить, он тебе не скажет, что вот, эй, мне хочется настроить систему для хранения логов, вот тебе вот такие предназначенные дашборды, и так далее. Нет, там тебе нужно пройти через целый ад Израиля, как-то все это там должно настраиваться, там должны настраиваться индексы, шаблоны и так далее. То есть нет такой простой системы, как в случае с каким-нибудь лог, который у нас уже сегодня есть на сегодняшний день. То есть это там все еще сделано как-то очень странно, потому что с Elastic'а один хочет быть одной системой для всего мира. То есть там и APM, и метрики всякие, и поисковые данные, и так далее. Прочерез, да. Мой опыт с Elastic'ом состоит в том, что я видел больше одной миграции с него. В разные стороны, но с него. Вот поэтому я много насмотрелся их докладов с конференций и прочего, где вот тоже рассказывают, как мы вот уехали с Exerge'а на Калифорнию, как мы выкроили с Elastic'а на S3, и так далее. И я вот начал сам задумываться, а может мне просто изначально избегать Elastic'а? И в итоге там, если где-то разворачивается кластер обычно, то он разворачивается просто для самого приложения. А для логов, я там вот помню, в 2020 году в одной из компаний я использовал сразу Локи. Локи это классная штука, кстати говоря. Его можно даже использовать в коде, в каком-то смысле, если вам... А он хранит Локи чуть ли не в том же Elastic'е, нет? Не-не-не, он хранит в S3 или на файловой системе. Там, как настроить. Ой, да, извините, перепутал. Локи, этот графан Локи, я говорю. Да, я понял, я просто перепутал. И в общем, это классная штука, это прям, короче, движение в правильном направлении, но беда Локи в том, что вот он, короче, я много забегаю вперед, но у него точно те же проблемы, что и про Mythos'а, часть индексирования, то вот он индексирует лейблы, например, вот однозначно такой вот маркер для Локи, это вот уровень как раз, или фасилити, то есть там название Локи, то есть, например, registration service, как бы там назывался в Java, то есть, сервис регистрации, там, не знаю, регистрация контроллеров и так далее, то есть, что-то, у чего кратное количество, ограниченное, то можно спокойно положить, индексировать память. Вообще, даже проблема не в этом Локи, проблема Локи в том, что он еще достаточно сырой. Когда я его, помню, ковырял прошлым летом, я хотел сделать большую статью на хабе с разбором всего этого дела, там, что лучше Локи, и Life's a Search, и Chaos, и так далее, Kafka, SQL, казалось, что Локи просто на каких-то таких запросах достаточно прозаичных, с группировкой там, еще чем-нибудь, может быть, в топ, например, 10 запросов от Nginx'а, которые занимали больше всего времени. Это все, он может просто потечь по памяти и сдохнуть. И я не находил причины этому, я только просто находил какие-то еще в гитхабе, и то, что мы поправим. Поправим. Может, уже поправили. Да, может, уже поправили. И это не значит, на самом деле, что Локи плохой, то есть, если его использовать просто как вот такой вот аналог просто Tail-F, потому что у него есть вариант, что очень читерская штука, вот этот режим Tail'инга, можно сказать, просто Локи, ну, у него на микрофоне можно смотреть так, нативно, а его еще можно и с консоли просто сделать Log-Kli, кажется, так его называют, команда, и там минус, то есть, минус Т, то есть, можно Т или Т логи, то есть, постоянно смотреть обновляющиеся данные по логам. Это очень удобно, но вот, то есть, если надо просто как-то греть, ну, это очень просто запрос сделать, то это окей. Но если использовать его как примитус, то уже начинаются звоночки. Как кто? М? Ну, ты говоришь, начинаются звоночки. Я прошу тебя развернуть мысль. Да, а, начинаются звоночки, ну, вот в виде того, что, например, запросы текут, что-то вот он не так делает, еще в связи с тем, что вот я не знаю, я его просто тогда тогда его тестировал, я его тестировал на жестком диске, и он мог очень медленно процессить данные по диску, да просто лопатись, там, лопатись, лопатись, потому что он он сжимает, он очень хорошо сжимает, то есть там можно писать хоть дебаги на Prod'е, и он там логи вектора централизованных, там с кучей кластеров могут заниматься, там, не знаю, гигабайт, двадцать, сорок, что-нибудь такое, куча сервисов.",
    "result": {
      "query": "Prometheus vs Graphite monitoring"
    }
  }
]