[
  {
    "segment_id": "97c75f26-aaa3-4895-a258-ef358fc0742b",
    "episode_id": "b06828fe-32f6-4ec7-85a8-5ce3f234588c",
    "episode_number": 442,
    "segment_number": 2,
    "text": "миллисекунд плюс-минус твои запросы отработают, и пользователь получит ответ. И на самом деле там дальше уже неважно, за 5 миллисекунд они отработают, за 3 это уже не имеет значения, потому что для пользователя это достаточно быстро. И намного важнее, чтобы у тебя не становилось хуже этого значения. Плюс это уже моя додумка по мотивам какого-то другого доклада, но вроде тоже было в VaccinationDatabaseTechTalks, тебе нужно, когда ты вот параметр крутишь, может случиться так, что ты 99% запросов ускорил, а 1% замедлил, и замедлил сильно. Ты в общем случае так делать не можешь, потому что вот этот 1% запросов, который стал медленнее, это возможно очень важный запрос, или может быть не очень важный, но на него смотрит очень важный человек, и он не хочет, там не знаю, раньше у него отчет генерировался за 3 минуты, теперь он генерируется 30 минут, это не годится. То есть замедлять нельзя в принципе вообще ничего. И вешенка на торте. Пользователи, пользователи альтернативного, то бишь, в среднем по больнице не хотят рестартить СУБД. То есть это больше половины пользователей, насколько я помню по докладу, они принципиально никогда не перезапускают СУБД, чтобы, ну, в целях оптимизации. Это означает, что некоторые параметры они эффективно недоступны. То есть, например, в подгрессе есть очень важный параметр Shared Buffers, он в принципе не может быть изменен без перезапуска СУБД. Получается, они оптимизируют систему, не изменяя Shared Buffers. В большинстве случаев. Ну, пользователи, которые готовы рестартовать СУБД, они являются исключением. Что с моей перспективы вообще ставят под сомнение всю затею. Да, Shared Buffers это аферистико важный параметр. При этом, как я понимаю, современный вот Артем, который не академический, он уже умеет оптимизировать не на стейджах, но может и на стейджах для тех, кто принципиально не хочет трогать прод. Дальше приводятся цифры, что в среднем они добиваются ускорения 30-50%. Это означает, что твои запросы, они становятся быстрее в 1.3-1.5 раз быстрее. Но это очень усредненное значение, потому что там на самом деле показываются графики, и на этих графиках огромный спред. То есть некоторые запросы в некоторых случаях вообще не становятся быстрее, в некоторых становятся быстрее в 2 раза, а не в 1.5. Но в целом разброс, он примерно, такой. Это, в принципе, все содержимое доклада. В нем очень мало говорится о том, как конкретно реализован от OtterTune, ну то есть уровня, если вам интересно, почитайте paper. Делается вывод, что ML работает как инструмент для оптимизации с OBD. И от меня вопрос такой, что я не очень понимаю, как они зарабатывают, как они делают свой бизнес, потому что, казалось бы, во многих сценариях, если ты такая компания, что у тебя нет отдельного человека, который достаточно хорошо шарит в Postgres, чтобы его затюнить, и ты пришел к OtterTune и дал им денег, ну казалось бы, ты понятно, не во всех случаях, но зачастую ты один раз Postgres затюнил, и тебе больше не нужно, но у тебя приложение больше, возможно, не развивается, или может быть развивается, но не сильно. То есть продают они подписки на год и надеются, что их будут продавать. Один раз затюнил? Ахахахахаха. Ну вот смотри, Devzen'у скоро будет 10 лет. Как часто, по-твоему, мы вычумили? Для Devzen'а можно запустить Postgres с дефолтами, конфигурациями, и ничего страшного не случится. Ты согласен, что если приложение не эволюционирует, то в принципе, и при условии того, что большинство клиентов, они даже Shared Wifers не трогают, можно настроить один раз и оставить как есть. Приложение... Смотри, Devzen' это не коммерческий проект. Во-первых, приложение всегда эволюционирует. Если они не эволюционируют, значит, вы, скорее всего, вообще не софтверная компания, вам вообще приложение один раз написали, и тогда тот же человек, который его писал, скорее всего, вам затюнил Postgres и больше ничего никого не делает. Большинство современного софтайта, software vs. service, software vs. service постоянно эволюционирует, нравится тебе это или нет. Это раз, с одной стороны. С другой стороны, у тебя, если ты современная компания, которая расти нужна в первую очередь, а потом все остальное, опять же, я не обязательно считаю это хорошим чем-то, но такова реальность, то у тебя в идеале клиентов все больше и больше и больше, нагрузка все больше и больше и больше, и настройки могут стать протухшими уже через полгода. Хорошо принимается. То есть ты считаешь, что если кто-то подписался, то он будет продлевать подписку на этот сервис? Ну, если бизнес у них хорошо идет, и действительно баз данных растет и все пухнет, то да, почему нет? Угу. Ну, тогда в этой истории меня смущает только один вопрос, что, мне кажется, это очень глупо не настраивать Shared Buffers, но и мне кажется... Просто их настраивают просто типа как-то, например, один раз или достаточно это как-то... Только если видят, что это реально нужно делать. То есть в случае с Shared Buffers это очень сложно. Многие существующие хостинги по сгрез уже его выставляют не в Саратов, а дальше... Я, по-моему, даже приносил это, чему мы научились за неделю. Прошлым летом где-то это было. У меня коллега прикидывал для... Делал Excel табличку, не Excel, Google спрячет, неважно, табличку, которая для характера данных в нашем индексе высчитывала, сколько нужно... По минимуму должно влезть в Shared Buffers, чтобы это не тормозило. То есть там идея такая, что все, кроме самого нижнего слоя индекса, обязано поместиться в Shared Buffers. Если этот артюн может посмотреть на твою систему и посмотреть на какие есть отношения, какие есть индексы и что из этого горячее, он может просто посмотреть на это, сделать real-size, опять же посчитать примерно сколько нужно, и если оно вылезает, то Shared Buffers не нужно трогать.",
    "result": {
      "query": "Postgres shared buffers optimization"
    }
  }
]