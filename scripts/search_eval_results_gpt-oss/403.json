[
  {
    "segment_id": "2ae6bc81-e181-4c09-820e-15fc8865e1d4",
    "episode_id": "bcf9cf96-7230-4a7e-b197-ae906cf7713e",
    "episode_number": 403,
    "segment_number": 10,
    "text": "И идеей этой системы то, что они хотели сделать сперва детектирование, этому, значит, посвящена часть самого пейпера. Второе – это как обходить эту проблему, как частично, как это, mitigation, как правильно перевести. Как говоришь, митигировать. Митигировать, да. Как правильно изолировать эту ноду, что с ней можно сделать. И третье – это решение самой проблемы. И они хотели сделать это так, чтобы у них не было влияния на систему, то есть как бы вообще ноль влияния на систему, на сам классик, на сам продакшн. И плюс они как следствие предыдущего, это значит, что ты должен брать только те данные, те метрики, которые уже есть в системе. Соответственно, если у тебя куча нод и какая-то из них сломана, то она сама про себя мало что может сказать. Значит, данные надо брать на основе того, что видят соседи этой ноды. Соответственно, это показатели и метрики, которые мы собираем со всех нод про их соседей. Значит, как это работает? Во-первых, они решили взять… они много разных методик пытались использовать, но самое полезное – они поняли, что не нужно придумывать ничего нового, нужно использовать максимально встроенное. И вот у них было две системы, в которых они больше всего были заинтересованы – это Cassandra и Zocuper, и они увидели, что в обеих системах есть такое понятие, как тайм-аут, то есть кто-то послал запрос, и кто-то не смог ответить на этот запрос в определенный промежуток времени определенной самой системы, и получился тайм-аут. И вот это вот определение, вот эта метрика количества тайм-аутов они использовали. Они сначала пробовали что-то свое, но поняли, что это не настолько же эффективно. Значит, на основе этих тайм-аутов они создают такое понимание, как очки каждой ноды, или баллы каждой ноды. Соответственно, если у нас есть кластер из n нод, каждая нода видит n-1 соседей, и, соответственно, каждая из нод считает эти метрики всех соседей, ну, тех, которых она видит, и она может, соответственно, послать вот этой анализирующей системе сколько-то баллов каждому из соседей. И самая главная проблема – это как превратить вот эти тайм-ауты в такие очки, которые будут реально что-то показывать. Здесь они тоже делали несколько отступлений вида «мы попробовали то», «мы попробовали это», но им нужно было какой-то стабильный и точный детектор того, чтобы нода сломана или не сломана. И, соответственно, для того, чтобы это правильно анализировать и иметь какие-то исторические данные, они завели собственную базу данных для этих метрик. Получается, если у вас есть n нод, то для каждой из n нод мы собираем n-1 метрик по каждой систем, которые у них есть. Соответственно, у них были лузуки пер-кассандры, значит с каждой ноды посылается метрик для двух систем. И это все за какой-то большой промежуток времени в прошлом, на основе которого они производили анализ и разрабатывали алгоритм и так далее. Значит, они пришли к идее, что базовое понятие, например, количество тайм-аутов за какой-то промежуток времени или количество тайм-аутов поделенное на количество входящих запросов, оно не работает. То есть, какие только они попытки не делали использовать эти числа, оно не срабатывало. И они придумали, что намного лучше работает, и это как бы они с точностью коэффициентов, они там делают отдельную ремарку, что эти коэффициенты мы подбирали для нашей системы, поэтому не факт, что они для вас сработают, но вот у нас как бы вот этот алгоритм вот с такими коэффициентами сработал. И так они вводят баллы и вводят кучу понятий вокруг этих баллов, то есть они вводят понятие «эпоха». Эпоха – это или поколение, это когда у тебя приходят тайм-ауты, и там накопилось сколько тайм-аутов за эпоху, и вот как бы в эту эпоху мы начисляем эти баллы. В следующую эпоху мы начисляем следующие баллы в зависимости от предыдущих баллов, то есть это система, в которой используется предыдущее состояние для того, чтобы вычислить текущее состояние на основе каких-то метрик. И соответственно они ввели там кучу всяких, целая прям несколько страниц объяснения их формулы, как они это придумали и так далее, но идея в том, что они ввели систему с небольшим запаздыванием, которая умеет очень быстро расти и растет она в зависимости от… растет она с ускорением. Давайте так, то есть если у нас было сколько-то тайм-аутов, в следующий раз будет снова сколько-то тайм-аутов, то на следующий раз, в следующую эпоху вырастет она быстрее, чем в предыдущую, потому что если мы растем от нуля, у нас пришло 100 тайм-аутов, мы вырастим на балл n. Если в следующую эпоху после этого пришло еще 100, то мы вырастим уже не на n, а на быстрее, чем n, больше, чем n. Они это вводят с помощью такого показателя, как предыдущее значение плюс предыдущее значение умножить на коэффициент. Этот коэффициент тоже отдельно рассчитывается. Они это делают для того, чтобы рост количества, то есть как бы постоянное состояние тайм-аутов, что у нас одна нода показывает какое-то количество тайм-аутов, приводило к тому, что мы могли ее добавлять в выборку, в выборке возможных кандидатов на то, что там проблема. Соответственно, сбрасывание вниз происходит просто большими кусками, скачками. Я не помню, за сколько, но там есть какой-то коэффициент, который вы можете определить, что за 10 скачков вы можете сбросить эти очки в 0, если тайм-аутов 0 на этой ноде. И соответственно, вы тоже можете определить за 5, за 10, за 100 шагов вы сбрасываете это до нуля. Соответственно, чем больше баллов накопила нода, тем выше шанс, что мы скажем, что есть какая-то проблема на этой ноде. Итого мы посчитали, скажем, вот у нас есть несколько нод, и на одной из нод мы посчитали баллы для всех нод. И затем, соответственно, эта база данных, которая у них есть, она берет 30-ый персентиль от всех очков всех остальных нод, то есть у нас 100 нод в системе, и мы говорим, давайте анализировать ноду номер 1. Что остальные 99 нод думают про эту систему, строим 30-ый персентиль и берем это число и говорим, вот это число у нас соответственно характеристика той ноды номер 1. Они тоже пробовали разные, взяли 30-ый, потому что это будет обозначать, что для 70 остальных нод у них есть проблема, эти ноды видят проблему в этой ноде, в соседей, для того, чтобы мы заметили эту проблему и возможно поставили ее в кандидаты на отключение от сети. После того, как мы сначала задетектировали, на всех нодах мы посчитали баллы для всех остальных нод, потом мы берем 30-ый персентиль, и таким образом мы для каждой ноды находим нужное число, а потом мы среди всех нод проводим анализ, фактически группировка по похожести, то есть они говорят таким образом, что если у нас в сети какие-то проблемы, но мы работаем в AWS, например, и у нас весь AWS боит, то получится, что у нас у всех нод, скорее всего, будут проблемы, ну или у нас получится несколько кластеров в зависимости от зоны амазоновской.",
    "result": {
      "query": "node timeout score detection system"
    }
  }
]