[
  {
    "segment_id": "c83b4b59-27ec-4646-8cf2-33c988674695",
    "episode_id": "b67a00a1-bf07-4428-bcd9-67572eb7a06d",
    "episode_number": 70,
    "segment_number": 6,
    "text": "разумная идея, чем хранить битсет Записей-то не будет очень много, потому что одно из самых существенных ограничений Chronicle Map В том, что она хорошо работает только когда она заранее сконфигурирована на примерно то количество записей, которые в ней будут находиться То есть, если попытаться сказать, я хочу Chronicle Map, но я вообще не знаю, сколько там будет записей Может быть 10, может быть миллион, а может быть миллиард Вот так она не будет работать Она не... это в каком-то смысле хеш-таблица, ну не одна, там она локс, ещё пострайплена по сегментам Но она не рехеширует, потому что она не имеет права двигать записи В том числе потому, что есть 3D, которые занимаются репликацией, они предполагают то, что если запись находится в каком-то месте, она не будет двигаться И по другим причинам, таким как если вообще всё хранилище, вся память шареное хранилище мапится на диск Если пытаться сделать какое-то рехеширование, то нужно создавать видимо новый файл А такое эргономическое решение есть, что если QWALY-хранилище мапится на диск, то создаётся просто один единственный файл И вообще весь стейт, вся конфигурация и всё, что относится к этому инстанцу базы, оно находится просто в данных этого файла, единственного И даже не в метаданных, то есть этот файл грубо говоря можно скопировать, просто перенести на другую машину с другой операционной системой С другим размером страниц, с другой, как называется, количество, нативный ворд на системе 64 бита, 32 бита С другим размером машинного слова Это не предполагаемый юзкейс, потому что это серверная база данных, она не предполагает, что она будет работать на каких-то мобилках 32 битных Но всё-таки, можно просто сказать, что QWALY-хранилище, которое работает через интерфейс мапа, оно персистится в какой-то файл Потом, когда все контексты закрываются, JVM завершает работу, этот файл можно скопировать куда угодно и открыть на другой машине, и оно будет работать и предоставлять те же самые данные А если делать какое-то рехеширование хэштаблиц, то либо файл должен очень сильно вырасти, потому что нужно создать новую таблицу, либо создать новый файл В общем, принято такое решение, что размер базы данных должен быть в каком-то виде задан изначально Если у нас будет примерно миллион или два миллиона записей, нужно так конфигурировать, и если потом попытаться вставить 10 миллионов записей, оно будет работать, потому что оно умеет расти, но не с помощью рехеширования, а с помощью добавления новых слоев в конец файла и в конец базы И это будет работать хуже, чем если изначально создать базу и сказать, что я хочу хроникомап на 10 миллионов записей и ставить 10 миллионов записей Мне кажется, пора переходить к следующей теме Подождите, сейчас я еще раз спрашиваю, то есть получается, я как пользователь, если я изначально сильно ошиблась с количеством записей, то у меня получается будет сильно падать перформанс, правильно? Относительно сильно А насколько сильно? Если брать по цифрам, можешь сказать что-нибудь? Я могу сказать, что это будет, ну допустим, среднее ожидаемое время работы, если, грубо говоря, создать базу на 10 миллионов записей и база будет размером нескольких гигабайт, то есть каждая запись, не знаю, несколько десятков или сотен байт, то время доступа к записи будет примерно 500 наносекунд А если изначально создать базу размером, допустим, на миллион записей и потом она вырастет до 10 миллионов, то время будет, я думаю, 3-4 микросекунды Время доступа вырастет примерно линейно, где фактор линейности это количество записей, которое реально там будет находиться поделенное на количество записей, которое было сконфигурировано Но, как ты понимаешь, эти цифры все равно, то есть когда заходит речь о том, быстро не быстро, ну я не знаю, Reddit считается очень быстрой базой данных, хотя там еще в десятки раз больше latency, это тем не менее очень много Мне скорее были интересны именно разницы, когда у тебя все нормально сконфигурировано и когда ты вырез уже за ту границу Господа, я должен вмешаться, я понимаю, что это исключительно захватывающее обсуждение для вас двоих У нас здесь есть еще другие люди, в том числе слушатели, давайте если время останется, мы вернемся к этому вопросу Ну просто надо и другие темы обсуждать тоже Хорошо Я",
    "result": {
      "query": "Chronicle Map record count impact"
    }
  }
]