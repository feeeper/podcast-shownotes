[
  {
    "segment_id": "191d96d0-102d-4bad-9615-75c70935bfc3",
    "episode_id": "07abb200-344a-4f3c-9c72-62a6a62b8a60",
    "episode_number": 336,
    "segment_number": 17,
    "text": "можно было спот инстанции использовать, ну, то есть они постепенно-постепенно все это добавили, и в общем-то сейчас уже есть смысл перейти на их node группы, вот, ну, только в том случае, если у вас нет каких-то требований, чтобы, допустим, доступ на ваши инстанции, у вас должен сохраняться, вот, какие-то там определенные операционные системы, допустим, стоять, или какие-то приложения, допустим, host-based intrusion detection системы, и так далее, вот, ну, в базовых случаях лучше использовать их node группы, потому что это устраняет необходимость устанавливать внутрь кластера кластер авто скеллер, он там автоматически уже Amazon-ом скелятся ноды, и termination handler небольшой демон, который отслеживает ресурсы точнее, ивенты Амазона, допустим, на термины инстанции, на то, что спот инстанции заберут, вот, на реболусировку там auto availability zone, и так далее, то есть он дает сигнал задренить ноду, мигрировать поезд этой ноды на другие, допустим, или заскелить еще одну ноду, и, соответственно, помогает уменьшить время простое, если в одной копии запущено, допустим, какой-то дипломент, как минимум сократить, то и, в принципе, свести к нулю время простое какого-то из приложений, и, соответственно, помимо этого мы еще целую пачку сервисов дипломент, тоже Terraform, внутрь кластера, вначале, в принципе, обсуждали, что это такой, ну, как правильно, заметили такой, скажем так, система инвентаризации ресурсов, допустим, в данном случае облачных ресурсов, ну Terraform, вот, и тут, с какого тут перепугу, допустим, мы это используем в качестве поставки в кластер, вот, но мы решили, что все, что не девелоперские приложения, и что в той длине в определенной степени обслуживает нашу инфраструктуру, мы записали тоже в ресурсы этой самой инфраструктуры, вот, и решили использовать метод именно Applying с помощью, то есть описание и Applying с помощью Terraform, вот, для поставки внутрь Kubernetes мы используем Helmcharts, ну, некоторые там написаны сами, написали сами, большинство своим используем общедоступные, вот, и для самой, для самого Applying, для своей поставки используем ресурс Helmrelease Terraform, вот, с ним, конечно, пришлось достаточно много повозиться, потому что были проблемы, допустим, во времена второго Helm'а, он использовал, ему необходим был в кластере, необходим был установлен сервер Tiller, в принципе, через который он общался и через который он теплоил внутри кластера эти самые чарты, вот, ну, и это, в принципе, был bottleneck, и, соответственно, здесь получается Helm, ну, через Helmrelease и через Tiller обращается к кластеру, собирает данные, собирает там историю релизов, собирает статус релизов и так далее, вот, ну, и, соответственно, еще сверху накладывается план Terraform, вот, и это все благополучно отваливалось по тайм-ауту, вот, и в какой-то момент мы перешли на Helm File, это такой, ну, если грубо сказать, совсем такой примитивный, это Docker Compose для Helm чартов, то есть мы можем описать такую пачку Helm релизов, то есть еще их сверху тоже затемплейтить и для нескольких окружений создать там различные интеграции, ну, и это все благополучно деплоить, вот, отсюда у нас поэтому вышло вот это разбиение на два слоя, где в первом мы описываем инфраструктурные какие-то ресурсы и во втором новые сервисы Kubernetes, вот, но вернулись обратно в Terraform, когда появилась поддержка третьего Helm, вот, и сейчас они добавили экспериментальную фичу, что можно, то есть у Terraform достаточно сложно, ну, с помощью Terraform ввести какую-то отладку и теплейтов вот этих вот Helm чартов и их значений, которые мы передаем там через ямл файлы, вот, и если ты что-то меняешь, то есть раньше он выкладывал, то есть в Valq под Terraform выходило, допустим, что было и что будет, и в принципе это такие рулоны в консоли, ничего не говорящих, ну, ямл, хотя бы, ну, то есть без указания там что изменилось и где изменилось, сейчас появилась экспериментальная фича, которая позволяет, в общем-то, в конкретном месте манифеста отобразить изменения, вот, без всего содержимого, в общем-то, стало поюзабельней, вот, ну, и также есть проблемы до сих пор, это история, то есть 3 Helm хранит историю релизов в секретах, ну, то есть для каждого релиза, для каждого там за диплейного чарта история в отдельном статус, допустим, и все содержимое хранится в отдельном секрете, и соответственно при активном apply-диплое в какой-то момент сам Helm перестает успевать за 60 секунд дайм-аут, который у них с Hard Cogen, в принципе, все это получать и рендерить и выводить там какие-то изменения, ну, и соответственно заваливается сверху тироформ, вот, поэтому, ну, нужно помнить об этом и ограничивать историю,",
    "result": {
      "query": "Terraform Helm integration issues"
    }
  }
]