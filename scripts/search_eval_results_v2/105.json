[
  {
    "segment_id": "638952a1-6e19-4e39-8b4e-c456d2e94cad",
    "episode_id": "1f6e3a6e-eb12-4b7a-8f99-99892c5874b4",
    "episode_number": 105,
    "segment_number": 7,
    "text": "В общем, ну почему ещё фрибезди не очень умирает? Потому что её используют такие крупные ребята, как, например, Netflix. Ну у Netflix есть такая штука, Open Connect Appliances. Это, если я правильно понимаю, штуковина, которая стоит, ну можно сказать, как это, на edge XCDN, которая отдаёт гигабиты в секунду видосиков каждому из зрителей. И ну они на самом деле разродились в своём блоге прям каким-то невероятным количеством постов на этой неделе. Я как бы проглядел только один, потому что они на самом деле там ещё всякого разного другого писали про свои разные там, ну тоже про строительство CDN, про то, что тестировали девайсов. Просто разразились, я был не в состоянии их читать на этой неделе. Ну вот как бы да, там реально просто дофига всего. И про то, как тестируют, и про то, как они там CDN строят и так далее. Ну вот конкретно по теме FreeBSD, если не ошибаюсь, у них там был вот один пост. Они в какой-то момент заблокировались с тем, что они конечно API шифруют, они конечно там контент тоже может быть какой-нибудь DRM, но раньше они его раздавали просто по HTTP. Почему? Потому что ну раздавать контент, чтобы эффективно, ну что-то типа send файла делать, чтобы с файловой системы по возможности напрямую вставать в сокет и не заниматься лишней работой. Но как бы это при этом может, не странно, что само PsyVideo мало того, что оно может утечь. Ну ладно, допустим, оно может контент, если он DRM, там ключик может быть только отдаваться через приватный API и там расшифровываться на девайсе. Допустим, что-то такое можно даже придумать, это не от того, что за счет не расшифрованного трафика самого видео, это может выдать в общем привычки пользователя, что тоже не очень хорошо, потому что тоже в некоторой степени подрывает прайвеси пользователя. Вот, они подумали, что неплохо бы шифровать этот трафик. Они во-первых долго и мучительно выбирали шифры, чтобы они им хорошо подошли и чтобы они хорошо ускорялись на ЦПУ. В итоге остановились, если не ошибаюсь, на AES GCM, то есть Galois Counter Mode. Сравнивали они его с чем-то другим, AES, по-моему, CBC, что ли, или что-то таким. Вот этот режим, который они выбрали, он какой-то относительно новый. Ну в смысле, я вот про него первый раз слышал. И вообще-то такие настоящие хардкорные криптографы, они осуждают все новое. Они предпочитают что-то, что никем, типа, 20 лет не сломано. Извиняюсь, я перебил. Ну вот, при этом даже если у них будет хороший шифр с хорошей расшифровкой на ЦПУ, это не отменяет того, что им нужно было бы все равно каждый раз кусочек доставать в визерспейс, расшифровать, всювать обратно в сокет. В общем, они там делали тесты, и производительность при этом падает существенно. А у них там гигабитный трафик. В итоге они пропатчили ядров и BSD, и сделали какие-то хитрые совершенно вещи. В духе того, что сессия, сеттинг, хендшейк происходит, TLS, SSL, хендшейк происходит все еще в визерспейсе. Потом сессионный ключ передается в ядро. Дальше при открытии сокета можно ему сказать, что вот, короче, у тебя сессионный ключ, он в общем вон там в памяти. Ядро, в ядре есть своя система, занимающаяся шифрованием, расшифровкой, которая называется, сейчас я вот не помню, в пейпере было, почти нет, что-то Open Encryption Framework, так она называется, Open Crypto Framework, это, я пронимаю, в BSD и уже даже в Линуксе, по-моему, такая штука у меня есть, которая вот прямо в ядре умеет немножко шифрование. И она умеет только то шифрование, если я правильно понимаю, которое аппаратно ускорен, или что-то такое. Поправьте меня, если я не очень прав. Ну вот, в общем, если у вас есть что-то вот такое вот в ядре, оно дает вот просто сессионный ключ в ядро, и дальше Send File будет просто брать куски, прямо в ядре будут куски с файловой системы, будет при помощи этого сессионного ключа их зашифровывать, отдавать в сокет, и не трыгать User Space лишний раз, и User Space будет отвечать только за восстановление сессии, за хэдшейк. Вот, мне кажется, это очень крутое улучшение, и то есть это спасибо Netflix за то, что он делает наши CDN-ы, умеющими отдавать много контента, при этом все еще по HTTPS. То есть, если вспоминать ситуацию 2-3 года назад, HTTPS, вообще HTTPS, это был такой маленький кошмар, даже не 2-3 года назад, а лет 5 назад, наверное, это был такой маленький кошмар, тогда еще аппаратное ускорение было не на всех ЦПУ, вот это все, и там даже просто, чтобы нормально работал обычный Nginx с SSL, на хорошей нагрузке, там нужно было припрыгнуть, присесть, хотя, может быть, и больше, чем 5 лет назад, в общем, был какой-то момент времени, когда это было релевантно. Сейчас можно просто подсовывать сертификат Nginx, и аппаратное ускорение в Intel-овских ЦПУ сделает все за вас. Но все еще отдача большого количества шифрованного контента – это обычно проблема. И спасибо Netflix за то, что он за нас ее решил. Там, кроме статьи в блоге, есть еще paper, интересно, с большим количеством технического мяса. Я его мельком-мельком пролистал, ну, в общем-то, примерно то, что я описал, что они сессионный ключ передают просто в ядро, и если я правильно понимаю, они никак специально особо API для этого не расширяли, кроме того, что добавили новый параметр в открытие сокета. Это тоже довольно здорово, потому что довольно малыми силами удалось это сделать. Я тут начинаю кристально понимать, почему такие компании, они все-таки выбирают FreeBSD. Я вот сегодня узнал, и для меня было шоком. Вы знали, что ядро Linux нельзя собрать без флагов оптимизации? То есть вот с O0 оно не собирается вообще. Ну, просто оно падает с ошибками при компиляции. Вот почему всем не наплевать, потому что когда ты отладчиком хочешь подрубиться, если ты хочешь видеть нормальные значения переменных, не вот это вот, optimized out, а нормальные, то тебе нужно с O0 собирать. В Linux так нельзя. Как они отлаживают, я не знаю, но в смысле получается в ассемблерных кодах только так. Они в итоге таки включили отладчик, потому что долгое время, ну, по крайней мере, лет 8 назад его там не было, это я знаю точно, потому что Linux был против, типа, отладчики это для слабаков, мы там в уме сделаем правильную архитектуру, и поэтому все будет правильно работать. Вот, в итоге они все-таки включили отладчик, но вот отлаживать им непросто. Еще одна причина – это GPL. На этой неделе прошла замечательная новость о том, что… Кто там? VMware, если я не ошибаюсь? Да. Вот в ядре Linux там есть некие процедурки, да? Разработчики могут эти процедурки помечать как GPL only. То есть вот я написал кусок кода, я хочу, чтобы он использовался только с кодом на GPL. Если используешь, то код должен быть либо GPL, либо не использовать мой код. Что уже как бы какие-то копирасты так делают, но это не открытая операционная система, это бесплатная, но нифига не открытая. Ну вот, разработчики внимательно смотрят на это дело и говорят, ну хорошо, значит я не могу использовать этот код напрямую, но я сделаю вокруг него обертку GPL, вот, открою, выложу все как положено. А уже в эту обертку я буду ходить, ну не знаю, по Unix socket или не знаю, еще как-то. Ну то есть нормальное решение, согласен? Но тут некий разработчик ядра начал катить бочку на VMware, что вот вы так делали, вы не правы, вы не должны этого хотеть, вы нарушаете GPL и я на вас буду подавать в суд. И, ну, я не знаю, как ваше отношение, я считаю, что это жесть какая-то. Я пытаюсь это как-то без мата сформулировать, это какая-то жесть. Ну это просто как это, вот как есть агрессивные копирасты, которые пытаются все прикрыть при помощи, так скажем, хождения в суд. Так вот, видимо, есть агрессивные копиласты, как это, копилефты, которые пытаются все сделать насильственно свободным. Знаешь, мне как-то вспоминается, знаешь, когда вот пытаются насильственно кормить, там вставляют, ну там психбольных, например, вставляют ему как это вот, ну как называется, фану, ну блин, воронку в рот и, короче, насильственно кормят. Вот, короче, вы будете свободными, заразы. Понимаешь, вот с точки зрения компании у тебя, если ты даже возьмешь Microsoft и Windows, у тебя с ними будет меньше проблем, ты хотя бы понимаешь, что от него ждать, ну ты можешь обсудить с ними, что ты можешь использовать, что не можешь, там если используешь, то как, вот у тебя все предсказуемо. Здесь ты все сделал по лицензии, ты с ней ознакомился, вот честно сделал продукт и до тебя все равно докопались, внезапно, понимаешь, в чем проблема. То есть, тогда уж либо брать, ну нормальное закрытое проприетарное решение, где ты за него дал бабла, где, ну вы с чуваками и там, и там делаете бизнес, у вас все просто и понятно, вот, либо использовать, ну нормальную лицензию, то есть, ну BSD и MIT, вот это все. Ну, видишь, в чем дело, дело в том, что, насколько я понимаю, с Microsoft ты редко будешь работать, ты будешь работать с интегратором интегратора, из того, что я слышал, знаю, видел местами и там тоже не все так гладко, к сожалению. Ну и вот таких вот копилевт, как это сказать, любителей их встречает не так много все-таки. Ну я и говорю, поэтому MIT, BSD, этот анлиценз, вот это все. Еще интересная бага, просто, ну это уже как бы не совсем в тему, интересная бага в Ubuntu 16.04, на самом деле, которую многие заметили, но не все поняли, там в Unity его разработчики, ну в оконном менеджере в смысле, не предусмотрели, что вообще бывают люди, которые переключают раскладку. И когда ты ее переключаешь в Unity, у него, ну, блокировщик экрана, он так падает, перезапускается. Вот, но с моей точки зрения это выглядело просто такой неудобной вещь, потому что, ну что за фигня, я жму Alt Shift, у меня как бы экран мигнул, да, и раскладка не переключилась, приходится делать это мышкой. Вот, а чуваки расковыряли и нашли, как это использовать. Ну, смысл в том, что если ты так сделаешь очень много раз, то у тебя блокировщик экрана, он типа на секунду пропадает, и ты можешь там за это время успеть запустить консоль, что-нибудь в ней набрать, ну какой-нибудь скрипт скачать, например. Вот, ну это как бы еще одна причина лично моего ухода на FreeBSD, потому что здесь я сразу настроился как мне удобно, там типа i3, i3 log, ну который железобетонно работает последние лет 10, наверное, вот, и не возникает таких проблем. Ну в Linux тоже можно логин скрин, кого хочешь настроить, другое дело, что по дефолту, что есть, то есть. А вот понимаешь, там все не так-то просто, то есть ты в теории можешь себе настроить все что угодно, но потом, ну вот я пробовал, да, ты можешь на Ubuntu поставить i3, но он у тебя будет как-то очень странно отображаться на логин скрине, там типа без иконочки и так далее, у тебя возникнут проблемы, ну то есть оно как-то хреново друг с другом синтегрировано, тебе придется либо заменять этот логин скрин на что-то, у тебя могут шрифты, которые они так удобно, ну за тебя везде настроили шрифты, действительно классные в Ubuntu, проблема в том, что они вот потом в i3, который ты установил, они лягут там как-то кривенько, косенько, и тебе придется вот это все перенастраивать. Ну то есть там не так, что ты вот просто установил и просто заработал. А у меня стоит, извините, у меня вот стоит i3 на Ubuntu и все работает. А на логин скрине что? А на логин скрине у меня стоит i3 логин скрин. И все норм? Все норм. Я пользуюсь FreeBSD на десктопе, чувствую себя отлично, ты нервный, это из-за GPL. Я пойду по днам в суд на кого-нибудь. Вот да, bottom line, что если вы, ребята, не хотите ни с чем навозиться, ничего не настраивать, вы просто берете, вставите самокоси и ничего не настраивать, все само работает. У меня дома такая система на макоси, это все из GPL и mid лицензии, и без лицензии, короче. Кстати, если в тему испорченных рассуждений, которые на самом деле ничего не следует, если подумать, то у меня действительно все, что работает хорошо, работает на FreeBSD. Вот у меня телефон работает на FreeBSD, и всем известно, что лучшие в мире телефоны на фряхе. У меня игровая консоль, у которой 20 миллионов пользователей, она тоже работает на FreeBSD. Единственным логичным шагом для меня было поставить FreeBSD еще и на локтоп. На самом деле тут есть тонкость, что телефон на самом деле не на FreeBSD, а работает на юзерспейсе от FreeBSD, ядро там свое, там Mage же, kernel. Видишь, один только юзерспейс моментально делает телефон правильным и работает. А если туда ядро поставить, это вообще будет космос. Окей. Тут, кстати, недавно даже портировали Steam, там, на том же сайте, и там, кстати, есть такой сайт, где можно поставить, например, вот, на GitHub будет ссылка и на Reddit обсуждение. Вот, Вань, неужели кто-то на BSD играет в... Конечно, я в Chaos A играю каждый день. Интересно, а что там вообще на FreeBSD с этими графическими драйверами? Ну, это, кстати, я не знаю, что там вообще с этими графическими драйверами. Ну, я не знаю, что там вообще с этими графическими драйверами. Ну, я не использую какие-то навороченные карты, у меня тут встроены Intel GT graphics, там, не помню, 4000 или 4000. Нет, подожди, даже без навороченных карт бывает так, что Reddit с OpenGL просто, знаешь, какая-нибудь такая, которая, ну, не умеет OpenGL на самом деле, современный. Ну, вот я на этом лэптопе запускал свои эти демки, там, типа, с OpenGL 3.3 плюс. Окей, ну, все значит уже не так плохо, как я думал. Ну, да ладно. Как раз в 11 версии, я сейчас на 11 бета 4, кстати, сегодня, по-моему, буквально сегодня RC1 вышел, именно на него спортировали вот этот новый графический стек. Меня на самом деле поражает то, что чуваки, ну, большинство из них, они занимаются проектом забесплатно, они, там, типа, смотрят, как это сделано в Linux, и потом это переписывают на, ну, потому что нельзя скопипастить, потому что GPL. Они это переписывают так, чтобы это работало на фряге, то есть, представишь, насколько это специализированные, нет, не так, насколько это крутые специалисты, и вот они инвестируют свое свободное время в такие вещи. А не настолько они, там, что-то переписывают с Linux в Wayland, или что они пытаются портировать? Нет, ну, Intel, он, типа, сделал дрова для Linux, теперь вот ты смотришь на его код, тебе нужно писать такой же с нуля для фряги. Подожди, так это же графический стек или все-таки дрова? Дрова для графической карты. Просто графический стек, это еще, знаешь, типа, Wayland или XA, это еще и там, Mesa или какой-то там еще OpenGL, просто графический стек, мне кажется, это немножко шире штука, чем дрова для Intel. Ну, кстати, что мне еще нравится в FreeBSD, раз ты упомянул вот это все, тут люди особого энтузиазма по поводу Wayland или SystemD, или вот всего этого нового блестящего говна не испытывают. Ну, кстати, знаешь, Wayland это полезное блестящее говно. Просто оно еще нигде не работает, вот в чем проблема. Ну, может быть, да, но XA это на редкость говенное говно. То есть, знаешь, эта идея, давайте мы контроллы будем передавать по сети, она хороша для контролов, но она, к сожалению, не хороша для того, чтобы рендерить что-то современное интерфейсом. То есть, как бы ее придумали в век, когда у тебя контролл был прямоугольный квадратик с надписью, сейчас у нас в круглом картинке. У нас так много растр стало, что XA это такой бесконечный оверхад. Ну, мы это уже обсуждали, конечно, но с другой стороны, я последние сколько там, года три сижу под XA и мне вообще нормально. Ну, то есть, я не вижу проблемы объективно. Ну, с другой стороны, да, я не такой задрочный геймер, с другой стороны, может быть, нужно просто OpenGL-ный мой рендерить.",
    "result": {
      "query": "Netflix FreeBSD CDN encryption"
    }
  }
]