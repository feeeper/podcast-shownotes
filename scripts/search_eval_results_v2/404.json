[
  {
    "segment_id": "b079ddca-f38f-4f18-9eaa-dd2edb579f6a",
    "episode_id": "fce21ad7-a392-4b7e-8956-fea149114a86",
    "episode_number": 404,
    "segment_number": 12,
    "text": "предлагал патч, он куда-то исчез, или доработки нужны очень большие, и считается, что они не займут ни неделю, ни две, и поэтому, пожалуйста, присылайте новый патч, когда учтёте предыдущую обратную связь. Когда учтёте предыдущую обратную связь. Что нас ждёт в будущих версиях пасгрэса, это всё ещё не закомментировано с 2020 года. Это поиск N ближайших соседей, так называемый K-N-N на B-деревьях. Честно говоря, я этого не вполне понимаю, я не читал трет о чём это, то есть, казалось бы, если у тебя эти B-3, и тебе нужно найти ближайшее значение к числу 15, то ты делаешь просто select, limit и так далее. Возможно, речь идёт про поиск ближайших соседей для массивов или чего-то. Кто-то из присутствующих знает, что такое K-N-N на B-деревьях? Видимо, нет. Иван? Ты разобьёшься? Я как раз хотел сказать нет, а ты заменял и сказал, что нет. То есть понятно, что такое K-N-N, но непонятно, что такое на B-деревьях. Короче, придётся читать трет и разбираться. Ну типа найти 10 ближайших дат к заданной, ближайших в индексе. Но, казалось бы, это всё ещё select, order, by, limit. Я так понимаю, что… Смотри, ближайшие, они же у тебя в обе стороны. Представь, что есть значение, которое в середине дерева. Значит, два запроса с ориентированным датом. Да, два запроса, да. Ну типа идея в том, чтобы их сделать в одно обращение к индексу? Ну видимо, да. Ну может быть. Не знаю, в любом случае, может быть, это всё-таки не так. Не знаю, в любом случае мы спекулируем, нужно открыть трет и разобраться. В будущих версиях нас ждёт индекс skip scan. Про skip scan мы говорили в подкасте, по причине, что в timescale DB есть индекс skip scan. Но, насколько я припоминаю, в timescale он немножко не такой, каким его предлагается толкать в кору. Я всё это уже напрочь не помню, поэтому лучше не буду гнать в порку. И ещё нечто под названием retail index tuple deletion. Некая оптимизация, связанная с удалением то ли из индекса, то ли удалением самого индекса. Опять же, нужно читать трет и разобираться. Плюс из этого же доклада даётся отсылка на доклад Питера Гагегана, также сейчас в Neon. На самом деле, Питер, он драгоспец в бодибилдингах, конкретно в подгрессе. Он фактически мейнтейнит, он восседим всех бодибилдингов в подгрессе. У него есть доклад, называется MB3 and architectural perspective. 2019 года. Тоже то, что меня порадовало в этом докладе. Я не знал про доклад Питера и буду его смотреть теперь, возможно к следующему выпуску. Дайте-ка я быстренько посмотрю скриншоты, которые я сообщил, сохранил. Да, здесь даются отличия алгоритма в подгрессе от алгоритма Леймана и Яо. Я не буду это пересказывать. Кому интересно, откройте слайды, это на первых трёх слайдах. Там есть эти отличия. Если вам такие дебри интересны, вы их там найдёте. Что ещё? В оригинальном алгоритме используется указатель на правой узел того же уровня. То есть у тебя есть дерево, в нём есть узлы. Узлы бывают на одном уровне, и ты ссылаешься на тот, что справа. Это в оригинальном алгоритме. В подгрессе ещё используется ссылка на левой. Потому что ты можешь делать обратный скан по индексу, и тебе нужно иметь и правого сиблинга, и левого. В подгрессе, в отличие от Пейпера, ключи не обязаны быть уникальными. Хотя мы несколько минут назад выяснили, что на самом деле они уникальны. У них просто та паладина включается. В подгрессе, в отличие от оригинального Пейпера, ключи могут быть переменного размера. И опять же, в оригинальном Пейпере предполагается, что у тебя процесс, он имеет эксклюзивный доступ к деревьям. В оригинальном Пейпере предполагается, что доступ эксклюзивный. В подгрессе это не так. У тебя есть Shared Buffers, и твоя работа происходит через Shared Buffers, через страницы. Вот одно из отличий. Сообщаются некоторые тонкости использования Input. Ну, то есть у Covering Index, они же Input Index, там есть некоторые нюансы. Например... Да нет, в принципе мы всё... Ну, если вы сделаете Covering Accrued, той колонке, которую хотите часто апдейтить, то у вас сломается ход tuples оптимизации. Вот, да, спасибо. Это было на соседнем слайде, я до него ещё не дошёл. Да, действительно. Кстати, в докладе объясняется подробно ход, но про ход мы, кажется, говорили, поэтому я не стал даже это помечать. Вот, да, могут ломаться ход цепочек, ну в смысле переставать использоваться ход цепочки. А, и ещё вот хороший слайд я сохранил. Никогда не было на Коммитфесте, но когда-нибудь в подгрессе хотелось бы иметь Index Organized таблицы. Причину, почему их хочется иметь, что пользователи часто хотят Primary Key, но сейчас в подгрессе ты делаешь... ты отдельно сохраняешь таблицу и отдельно по ней строишь индекс по Primary Key. А можно было бы их хранить вместе в одной Index Organized таблице и этим сэкономить место, и доступ будет быстрее. И опять же у тебя будет... ну фактически сканирование по первичному ключу превращается в Index Only Scan, за тем отличием, что он True Only Scan, где ты точно ни к чему, кроме индекса не обратишься, потому что у тебя больше ничего и нет. Плюс индексы по партицированным таблицам. Я не знаю, мне кажется, этого не добавляли в подгресс, но это не точно. И вариант это сделать глобальный индекс, который индексирует всё. То есть все таблицы, которые к вот этой партицированной группе относятся. Либо, я вот не уверен, что такой Global Partitioned Indexes, может быть идея в том, чтобы партицировать индексы. Возможно, в некоторых случаях это действительно смысленно. Потому что, я кстати не знаю, мне кажется, в подгрессе ты можешь положить индекс на отдельный Table Space. То бишь положить его на отдельный диск. Мне кажется, может только весь Relation, по-моему нельзя индекс отдельно. Серьёзно? Тогда это довольно существенное ограничение. Как мне кажется. Вот. Доклад очень понравился. Понравился тем, что в отличие от MVCC для Memory System, он тоже интересный и архитектурный. Но здесь вот конкретно, что ещё надо допиливать, что конкретно было сделано в прошлом, какой конкретно Paper читать, и в чём конкретно его отличие от конкретных реализаций в подгрессе. У меня всё. Вопросы, возражения, комментарии. Опять стандартный вопрос. Это для кого? Все видео и Paper? Я так понимаю, начальные уровни. Я думаю, доклад стоит посмотреть, если вы интересуетесь подгрессом как пользователя, вы хотите узнать чуть больше про деревья, то, доклад, кстати, короткий, он минут 40 идёт. Посмотрите, мне кажется, вы интересно с пользой проведёте время. И если вы захотите, то по дополнительным ссылкам вы получите больше информации. Там ещё была ссылка на какие-то блокпосты, но я их забил читать. Хотел, но забил. Но очень хотел. Но очень забил. Отлично. Тогда идём дальше. А дальше? Что у нас дальше? Помните, мы слушали дальше? Нет. Да, наброс на темы. Короче, принёс её Саша. Давай я расскажу эту тему. Тема называется «Позгресс – более лучшая очередь сообщений, чем Кавка». В статье убедительно показывается, что позгресс – это более лучший… На позгрессе можно сделать. Нет-нет, подожди, Валера. В статье убедительно показывается, что позгресс – это более лучшая очередь сообщений, чем Кавка. У меня всё по этой теме. Вопросы, возражения, комментарии. Короче, комментарии, да. Её пошарили у нас ещё со мной паре мест. Не знаю, почему она так понравилась человекам, но, в общем… Во-первых, в статье на самом деле никто не делает ничего на Кавке, просто такие «А может быть не будем на Кавке?» То есть статья с этого начинается. И дальше делают на позгрессе. То есть с Кавкой, во-первых, никто не сравнивал. Во-вторых, Кавка – это в принципе не message queue, это лог распределённый. И он в первую очередь для этого и нужен. Её делали для того, чтобы большие потоки данных между одной и другой системой гонять, и они не терялись. А то, что… Ну, в справедливости ради они используют… У них задача – это писать лог. Просто они его называют message queue. Ну нет, у них там всё-таки job queue. Если я правильно понял. Я не понял, что конкретно они делают. У них вот эта система Duckster Startup. Я не особо разбирался, что они делают, но, судя по статье, они именно пишут лог, и в каком-то мониторинге смотрят на этот лог. Они его как-то особенно рендерят, но по сути это лог. Anyway, в общем, Кавка – это штука для того, чтобы в первую очередь, для того, чтобы большие потоки данных перебрасывать. Если у вас не очень большой поток данных, или если у вас поток данных, с которым нужно как-то интерактивно взаимодействовать… Ну, ладно, сейчас интерактивное взаимодействие слишком вообще прозвучало. Кавка для этого тоже, в принципе, подходит. Если вам нужно не что-то на основе этого потока данных посчитать, а брать строчку из этого потока данных, блокировать ее и говорить, «Я над ней сейчас работаю, я с ней что-то делаю, ой, я ее отпустил, ой, не получилось, нужно ее переобработать». Вот такого рода вещи Кавка для этого не очень приспособлена, потому что из нее нужно выбирать данные большими кусками, если вам нужно что-то делать с одной строкой, а не сразу. То есть если у вас нет варианта сказать, «А вы знаете, я вот эти 10 тысяч айтемов не смог обработать, я их переобработаю позже», если у вас нет возможности вот так сделать, то Кавка, скорее всего, не то, что вы хотите. Угу. То есть я понял, я понял, что чтобы получился какой-то диалог, а не монолог про базу данных, то надо набрасывать. Это первое, что я понял. Да, Саша, набрасывай, хватит просто доклады смотреть, нужно посмотреть доклад и набросить. Так смачно. Вот. Второе, что я понял на самом деле, вот как бы на полном серьёзе, в заголовке написано, «Постгресс это более лучше Message Queue или лог, чем Кавка». И авторы, они не соврали, они вот это утверждение, оно абсолютно верно. Есть один нюанс, что такое вот эта лучшесть, что такое лучшее. Это очень сильно зависит от контекста, от компании конкретных людей. И что мне понравилось в этой статье, у меня реально сложилось впечатление, что разработчики стартапа, они переслушали Devzen и решили вот наши советы про то, что Postgres одинаково плохо подходит для всех задач, но зато подходит для всех. Они вот эту идею использовали на практике, потому что они пишут прямо, что да, мы знаем, что Кавка это специализированная система для Message Queue или для логов, но мы прикинули, что мы в ней не разбираемся, мы разбираемся хорошо в Postgres. И вместо того, чтобы изучать новую систему, её подводные грабли, инфраструктуру вокруг неё, там, best practices и так далее и тому подобное, мы подумали, что вот у нас есть задача, к ней есть требования. Ну, нужно удовлетворить некоторые требования. Мы попробуем это сделать на Postgres, потому что мы его знаем и умеем, поскольку Postgres универсальный. И посмотрим, удовлетворяем ли мы нашим критериям. Они попробовали, они сделали, сначала не получилось. Они же давно слушали Devzen и подумали, что ну сейчас же эпоха облаков, и мы молодой стартап, давайте мы просто сделаем инстанс пожирнее, чтобы в нём памяти было побольше, сейчас же можно терабайт купить за недорого, терабайт оператива. Вот, и они купили инстанс подороже, потестировали на нём, стало лучше. Вот, мы смотрели на своё приложение, на свои запросы, у них было 3 проблемных запроса, которые не укладывались в их критерии. Они поняли, что один запрос им просто не нужен, они его выкинули. А два других запроса, как я помню, они переписали. И после этого у них получилась норма. По-моему, что-то ещё у них. У них была проблема то ли с драйвером, у них какой-то драйвер для питона, который в каких-то случаях не мог с их задачей справиться, поэтому у них где-то сбоку немножко редиса появилась. Но вроде как он не как основная месседж-кью на проекте. Но смысл в том, что у них уже был пасгрэс, они уже вымели пасгрэс, они попробовали, не получилось, они потюнили, у них получилось, и они решили свою задачу. И я считаю, это очень правильно для молодого стартапа, ну или не очень молодого, я не знаю, на каком они раунде. Но это вот прям как мы последние полгода как минимум в этом подкасте и твердим. Я тебе ещё раз повторяю, я тебе ездим статья и парад был. Confirmation bias. Вопросы, возражения, комментарии, всё ещё? Вань, ты бы кавку взял или пасгрэс? Даже не знаю. Лучше бы ничего не брал. Я бы лучше сделал сервис без состояния и без данных. Вот такой вот классный сервис. Я бы просто показывал 404, правда, Ваня? 404 – это всегда в тему, особенно сегодня. Прелестно. Что, наконец к теме слушателей? По темам слушателей, наконец-то, да. Ой, боже мой. Во-первых, про голосование за темы. Ребят, расскажите, я не очень понял вот это предложение, которое… Да, короче, спасибо, что поднял эту тему. В общем, я такая, кто-то из слушателей, я уже не помню сейчас, извините, я правда не помню, кто из вас это сделал, но это очень клевое предложение, потому что мы все думали, блин, как бы так вот сделать? Было бы удобно, в принципе, собирать темы в Division Live, но вот как-то чтобы их отделить, мы же будем терять. Кто-то из слушателей даже сделал бота, написал прям огромное спасибо, но мы не начали им пользоваться, потому что они, не знаю, почему, как бы он в принципе… А, по-моему, мне там что-то неудобно показалось, я что-то потом забил это доделывать, и как-то все… В общем, мы спустили это на тормозах, будем честны. А тут предложили просто максимально low-tech способ просто использовать обычный Division Live канал и не терять темы. Оказывается, в Telegram есть теги. Если ты поставишь решеточка темы в сообщение, а потом перед выпуском нажмешь, поищешь по тегу темы, то ты найдешь предложенные темы. И чтобы, не знаю, самим было удобнее, можно просто периодически объявлять набор тем. Ну, это можно либо ботом делать, или просто руками писать. Можно еще раз подождать, у меня уже глубокая ночь, можно повторить. На какой тег нужно куда-то нажимать? В смысле, не нажимать… Ну, во-первых, если у тебя в сообщении есть решеточка темы, ну, я уже не вижу это сообщение. Если ты так сделаешь, нажмешь внутри сообщения на тег, то он найдет все сообщения с таким тегом. В смысле, Telegram. Вот, да, Саша, ты сейчас запостил, и видишь, он нашел сообщение по этому тегу, если на него нажмешь. Вот, если мы просто договоримся о таких тегах, ну, типа, например, после каждого выпуска будем говорить, ну, собираем темы, и дальше вот по такому тегу. И просто потом, когда выпуск ведем, мы нажимаем на тег, и, пожалуйста, у нас есть темы слушателя. Единственный минус, который с этим может быть, их нужно понять, как Юра реально это генерировать. Но, по-моему, его можно сгенерировать. И даже если нельзя, ну, это не такая уж и большая беда, на самом деле. Я думаю, что в теге должен быть и номер выпуска. Да-да-да-да-да-да-да. Вот я говорю, как ты предложил, например. Вот, ну, потому что мы иначе будем каждый раз пытаться отличать это от этого, к нашему выпуску. Вот, голосовать понятно как, плюс-минус. А напоминать, мы можем либо не напоминать, если как бы все подписчики в теме ха. Нет, слушай, чтобы теги, удобно все равно, чтобы иметь тег. А, я понял, типа так, сейчас мы набираем темы 405. Как-то так, да? Да, вот так вот, короче, будем делать. Вы, значит, слушатели, уважаемые, ставите тег 405, ставите темы 405, приносите вашу тему с этим тегом, и они все будут просто в телеграм-канале. Я думаю, что мы пока можем не выключать темы на сайте, но там уже и так очень маленькая активность. И, в принципе, наверное, рано или поздно мы заморозим и очистим дискасс. Я лично перестал им пользоваться давно. Дискуссу можно войти? Давай, да. Я не могу в него войти, он мне не дает. Ну, там, я тоже часто разлогиниваю, это полбеды. Второе полбеды, что там дохера спама, говна, безнаказанная анонимность всякой. В итоге, ну, это не стимулирует продуктивную дискуссию давно. А у нас в чате собрались, в принципе, активные, адекватные ребята. И как бы... Там все активные люди сейчас там. И там, как минимум, 500 человек. Я предлагаю на сайте какое-то время продолжить постить вот эти темы и вопросы, но с закрытыми комментариями и с пояснением, что делать. Вот. То есть, ну, важный момент, чтобы комментарии были закрыты. Я не умею, кстати, это делать. Руками закрывать, что ли? Сейчас объясню. Научимся его в оффлайне. Слушай, мне кажется, можно просто глобально закрыть комментарии на сайте и всё. А, кстати, странное дерьмо. А, вот. Да у нас запись идёт. Пошли потом это всё найдём. Ну, блин, Ваня, это самое интересное в записи. Всем же интересно, как... Нет, самое интересное — это слушать всё в онлайне. Это называется закрыть ветку. Закрыть ветку. Видишь, Валер, в чатике? Ну да, но это нужно, короче, в каждом выпуске нажимать. Я предлагаю просто глобально их закрыть, потому что, ну, когда у нас в последний раз были нормальные комментарии, всё равно половина пользователей сейчас это пишут уже в чат, а кто не пишет в чат, пишут редко. И смогут написать в чат. Я понял. Ну, тогда их нужно не отключать, а просто убрать с сайта и всё. Нет, я бы предложил, пока их не убирают с сайта, потому что у нас огромный бэк-каталог в выпусках, у нас в каждом выпуске ссылка на страницу с темами, и сейчас это будет выглядеть так, что у тебя есть ссылка на страницу с темами, где пусто. Я понял. Ну, то есть какое-то время ещё пожить, да? Ну, я бы предложил их как-то материализовать, наверное. Слушай, наверное, можно оставить комментарии, но просто забивать на них. А потом в какой-то момент выключить это самое простое. Я бы, на самом деле, сделал выгрузку из дискасса и просто поребил бы их гвоздями к темам. Вперёд, выгружай, прибивай. Да, я понимаю, да, альтернатива инициатива и инициатора. Нет, ну генерировать идеи — это все мастаки. Да, я знаю. Я не возражаю, займись. Где там наш статический сайт? Мы сейчас кус выпьем, и там и до статического сайта. Сегодня же 28 ноября, знаешь, что это означает? Что у нас сегодня перестанет работать генерировка тем. Да. Скорее всего, она сейчас на последнем издыхании, если ты нажимал сегодня галочку, она вот сегодня на последнем издыхании отработает, а возможно больше не сработает. Ваня, тебе лучше поторопиться с нажатием, не разветь им. Быстрее заканчиваем запись, быстрее. Мне кажется, там уже просто всё, короче. Нет, 29 ноября же она продолжит работать, у нас же не февраль. Да, слушайте, мы же в… нет, они то ли 28, то ли 29 грозились выключить, и если не ошибаюсь, поскольку это штатовское время, у нас ещё есть немножко времени. Окей. Ну у нас консенсус, что мы темы начинаем переносить в Телеграм, а потом мы все комментарии в Телеграм, а дискуссию выпиливаем. Угу. Во всяком случае, я не знаю, очистим ли мы его, но заморозить точно стоит. Так, да, темы и вопросы, слушатели. Первая тема… вообще, Ваня, а что я за тебя рассказываю, давай, работай, Ваня. Простите, друзья, у нас есть темы и вопросы. Сейчас, подождите, я не умею так быстро, как ты делаешь. А где у нас темы и вопросы? Вот они. Первая тема – это про… ой, Маск раскрыл детали Twitter 2.0. И вообще вся эта эпопея с Твиттером и Маском меня очень сильно напрягает. Я нежно люблю Твиттер, и я очень за него боюсь. Да, аналогично. Собственно, Вани в прошлый раз не было, я как раз рассказывал, что на всякий случай завелся мастодон. На земле, которая прямо сейчас лежит. Вот. Я помню, как ты, как Саша, услышал название сервера, поэтому это, наверное, все-таки… я был. А ты, в смысле, свой поднял? Нет, в смысле, я… нет-нет-нет, вот тот, который… его подняли, кстати. Видимо, на моей интенсивности был. В статье рассказывается про то, что, оказывается, у Маска есть огромные планы на развитие Твиттера, что там можно и большие тексты, и сквозное шифрование для сообщений, для этих прямых сообщений и так далее, и так далее. Я не знаю, к чему все приведет. Что я знаю, это то, что уже кучу народа оттуда уволили. Маск лично делал какую-то ревью, я так понимаю, архитектуры, как оно все работает, с какими-то фотографиями доски, на которой они все это рисовали. Мне это очень сильно напоминает микроменеджмент, и чаще всего после этого очень всем плохо. Давай я буду адвокатом дела. Давай. Смотрим, в процентах сколько сейчас сотрудников Твиттера уволили? Мне кажется, типа 80. 80%? Ну, то есть как бы уволили не 80, там гораздо более сложная история на самом деле, да. Ну, в общем, они суммарно потеряли под 80% сотрудников. Уволили они меньше, но много ушли просто. Что? А еще часть в непонятном легальном статусе, потому что их как бы попытались, извините за слово, выпиздить, но поскольку они в Европе наняты, это вообще-то нелегально. И поэтому их непонятно, что с ними теперь делать, хотя все уже знают, и руководство, и они сами, что их хотят уволить. Хорошо, возьмем 80%, да? Да. 80% сотрудников. Твиттер работает? Пока, да. Ну, то есть получается это были 80% не очень нужных сотрудников.",
    "result": {
      "query": "Postgres vs Kafka message queue"
    }
  }
]