[
  {
    "segment_id": "d3893c19-54bf-4271-88cd-ccb9ff07d21b",
    "episode_id": "db3a3c72-e77e-42c0-afff-9989dc4d5106",
    "episode_number": 144,
    "segment_number": 6,
    "text": "Вы можете просто всегда использовать TCD, потому что теперь, ну это не совсем официальная поставка за TCD еще, но в общем, разработчики TCD выкатили, так скажем, прокси, который успешно притворяется Zookeeper. Слушай, но это успешно притворяться не то же самое, что быть. Да, поэтому, собственно, для начала давайте вспомним, если вдруг кто не знает, что такое Zookeeper. Большинство распределенных систем, ладно, ну окей, некоторые распределенные системы, особенно в Java мире, любят координироваться через какую-то центральную точку. Ну потому что это достаточно удобно и можно сложный координационный код написать один раз и больше его не писать. Отдать тем умным ребятам, которые написали самую сложную часть, а самим продолжить писать по делу. У этого есть совершенно потрясающие последствия, то есть, например, у нас есть Zookeeper, и потому что он есть, у нас не нужно было переимплементировать Flinky, Sparky, Stormy, Yarny, в общем, тысячи всех этих компонентов. Там тот же самый Mesos тоже на это использует. Аналогично в случае с etcd у нас есть Kubernetes, у нас есть Docker Network, еще там тот же Weaver. В общем, практически вся гошная экосистема и докерская экосистема, она для координации использует etcd. А почему вам вообще может хотеться etcd вместо Zookeeper? Ну во-первых, etcd в чистом виде чуть ли даже не побыстрее, но дело даже не просто в скорости, а в том, что он, по слухам, я лично Zookeeper не отменял. По слухам, etcd проще ворочать большим стейтом, может быть Zookeeper в этом плане поправили. Что еще более важно, Zookeeper, я не знаю, наверное, может быть уже завезли, потому что года полтора назад, или даже два теперь уже, я видел новость, что вроде доделали. Но последний раз, когда я открыто об этом слышал, Zookeeper было тяжело добавить ноду без включения всего кластера, что тоже привет. Ну вообще, Zookeeper настолько сложно отменить, что вокруг него есть куратор, нет, во-первых, его сложно использовать с точки зрения API, потому что там с одной стороны есть куратор, ну здесь ничем не помочь. А с другой стороны, там был, я уже не помню, как он назывался, то ли экзибитор, то ли еще какая-то тула для того, чтобы именно менеджить Zookeeper. То есть это такая штука, которая... Это такой UI больше экзибитора совершенно, наверное, но их на самом деле много, таких тулов, которые визуализируют содержимое нод Zookeeper. А я не знаю, может быть я путаю, там была тула не только для визуализации, а для того, чтобы автоматизировать добавление ноды в кластер, потому что она была замороченная. Вот такого рода вещи. Да, собственно, ну и третья причина, почему вы, может, не хотите Zookeeper, я не знаю, вы, например, уже, у вас, не знаю, есть кластер Kubernetes, или у вас консол в продакшене, ну хотя консол он... У вас уже просто в продакшене где-то есть etcd. Вы не хотите, даже если вы не против запустить еще один инстанс etcd, вам не хочется писать там ChefRecept или что-то еще под еще один кусок кластера, который... Еще один кусок софта, который нужно обменить, с которым нужно развернуться. Если у вас в компании всем уже комфортно с etcd, то хотелось бы просто... Блин, это что-то в консенсусе, давайте просто везде его используем. Ну и, наконец, etcd, не знаю, мне просто... Да, это, наверное, тот же самый пункт, с ним приятнее работать, приятнее обменить, пофиг. Я Zookeeper особо не трогал, сложно сказать. Ладно, собственно, вернемся к тому, о чем, собственно, новость. Ребята написали про Xeo, я уже сказал. Про Xeo, поскольку у двух тулов довольно разные модели данных, у Zookeeper это такая иерархическая штука, похожая на файловую систему, где отдельные ноды можно мониторить. Ну и там своеобразная гарантия консистентности. В то время как у etcd у них плоское пространство ключей, и начиная с третьей версии можно делать транзакции просто на много ключей. Именно поэтому стало возможно эмулировать Zookeeper-овскую штуку. Ну и, собственно, они эмулируют в директории через транзакционное обновление сразу просто многих ключей. Притом у Zookeeper еще много всяких метаданных, которые приходится дополнительно писать, поэтому, собственно, оно немного медленнее. Но они там померили latency, и оно приемлемо медленнее. То есть на маленьких нагрузках вы, скорее всего, вообще ничего не заметите, на больших нагрузках вы, скорее всего, не рискнете менять пока что. Они обещают, что будут еще улучшать. Это версия 0.0.1, поэтому они не говорят, что она уже production-ready. Знаю, как это... точнее, по слухам слышал, я сам не сталкивался, опять-таки, я слышал, что эти CD, между тем, как они сказали, что он production-ready, и тем, как он стал production-ready, прошло некоторое время. Я думаю, здесь такая же история. Но в целом это очень позитивная такая вещь, потому что я этого, что называется, ждал джива года. Ваня, я знаю, тебе есть что сказать. А что там по скорости? Я смотрел графики, но я так и не понял, почему на графиках из ZTCD выигрывают у ETCD. В смысле выигрывают? ZETCD, он нет, он не выигрывает. У тебя latency из ZETCD постоянно больше. То есть у тебя ETCD в чистом виде, он имеет самую маленькую latency, дальше Zookeeper, а дальше с большим отрывом вверх, то есть сильно медленнее, ZETCD. А по чтениям примерно одинаково. Я хочу добавить, что у меня есть многих знакомых, которые выбирают Zookeeper, когда есть возможность выбирать, только потому что, во-первых, они эту систему более-менее знают, во-вторых, они просто в эту систему более верят. Типа она давнее на рынке, в ней меньше багов, и у нее есть проблемы, но мы знаем, как с ними бороться. Еще ни одного админа не уволили за выбор Zookeeper. Поэтому вот эта поделка ZETCD, я вообще не в контексте, я имею в виду, может быть она кому-то и понадобится, но вот зная этих знакомых, они посмеются и покрутят пальцем у виска, скажут, ну как бы, у вас можно выбрать Zookeeper, а можно выбрать Zookeeper на ETCD, вы что, с ума сошли? Конечно, выбирай Zookeeper. То есть я не очень понимаю, для кого это может быть сильно нужно. А для вот этих всех предложений, вот эти вот дополнительные увеличения лейтенанса, фактически больше, чем в два раза, оно может и сыграть какую-нибудь злую шутку. У тебя же есть и обратная история совершенно, когда у тебя есть уже хипстеры, у которых ETCD в продакшене, а Zookeeper нет, и они его на самом деле не очень хотят. Или, например, у тебя могут быть админы, которые терпеть не могут джаву, такое тоже бывает. И вместо того, чтобы тащить джаву, кусок куда-то, и они, может быть, не куда деваться, потому что там, не знаю, флинг на джаве скале, но вот там, где его можно не тащить, они могут его не хотеть тащить. Вот такие вот истории. Ну то есть, не знаю, я бы лично для какого-нибудь домашнего проекта, который не сильно продакшен, точно бы попробовал. А можешь еще раз описать, почему там транзакции нужны для того, чтобы Zookeeper эмулировать? Потому что у ETCD плоский namespace, а у Zookeeper аэрологический. А, поэтому сразу несколько ключей и это все. Да, да, да. Плюс метаданные. А тут, тем не менее, у нас гость хочет от нас сбежать, но поскольку у нас есть традиция, гостям давать непременно сказать что-нибудь напоследок, я передаю слово Косте обратно. Спасибо. Я просто хотел сказать, что я вас сейчас покину. Собственно, никто этого сегодня не заметит, потому что я просто молчу. Хотел сказать большое спасибо вам за то, что меня пригласили в подкаст. Это для меня, честно говоря, огромная честь и я совершенно по щам тронут. Надеюсь, что что-то смог рассказать интересно и не сильно вам подпортил репутацию по подкасту. От вас не сбегут люди теперь, потому что типа фу, гуманитария, к тебе начали звать. И всем-всем хорошего вечера. А что-нибудь порекламировать? Я не знаю, присоединиться к тебе, писать над ними, вот это все? Якобы ясен красен пишите над ними, не слушайте людей, которые смеются над ним. Ним вообще замечательно. И если хотите работать как писателем в Ульяновске или в Москве, то обязательно приходите работать в рестрим. У нас отличные условия, мы набираем всех писателей и редакторов. Если к нам придете, мы вас расцелуем, обнимем и дадим вам MacBook и хорошую зарплату. Пожалуйста, приходите к нам скорее. Спасибо. Да, спасибо большое, что пришел. Покинул, надо. Было интересно тебя послушать. Тем временем, что еще интересно послушать, это то, почему ROX.DB не готовит для продакшна. Мне вообще интересно, тема Сашина. Мне прям дико интересно, Саша, ты когда ROX.DB-то потрогать успел? Ну, я, знаешь ли, базюльками интересуюсь, я и время от времени трогаю всякое, но всегда в моем руке. На самом деле я трогал разные, ну, пытался попробовать тут разные стэки с C++ на Facebook. У них на самом деле очень интересный GitHub, про который я что-то мало слышал.",
    "result": {
      "query": "etcd vs zookeeper comparison"
    }
  }
]